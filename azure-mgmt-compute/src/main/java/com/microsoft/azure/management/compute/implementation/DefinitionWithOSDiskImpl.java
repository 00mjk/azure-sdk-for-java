package com.microsoft.azure.management.compute.implementation;

import com.microsoft.azure.management.compute.VirtualMachine;
import com.microsoft.azure.management.compute.implementation.api.DiskCreateOptionTypes;
import com.microsoft.azure.management.compute.implementation.api.OperatingSystemTypes;

final class DefinitionWithOSDiskImpl extends DefinitionWithOSDiskBaseImpl
        implements
        VirtualMachine.DefinitionWithOSDisk,
        VirtualMachine.OSDiskFromImage {
    public DefinitionWithOSDiskImpl(VirtualMachine.DefinitionWithDataDisk definitionWithDataDisk, String resourceNamePrefix) {
        super(definitionWithDataDisk, resourceNamePrefix);
    }

    @Override
    public VirtualMachine.OSDiskFromImage defineOSDisk(String name) {
        this.storageProfile.osDisk().setName(name);
        return this;
    }

    @Override
    public VirtualMachine.DefinitionWithDataDisk withUserImage(String containerName, String vhdName, OperatingSystemTypes osType) {
        // User images are the VHDs those are generated by applying CAPTURE operation on a GENERALIZED VM.
        this.storageProfile.osDisk().setCreateOption(DiskCreateOptionTypes.FROM_IMAGE);
        this.storageProfile.osDisk().setImage(toVhd(containerName, vhdName));
        this.storageProfile.osDisk().setOsType(osType);
        return definitionWithDataDisk;
    }

    @Override
    public VirtualMachine.DefinitionWithDataDisk attachOSDisk(String containerName, String vhdName, OperatingSystemTypes osType) {
        this.storageProfile.osDisk().setCreateOption(DiskCreateOptionTypes.ATTACH);
        this.storageProfile.osDisk().setVhd(toVhd(containerName, vhdName));
        this.storageProfile.osDisk().setOsType(osType);
        return definitionWithDataDisk;
    }

    @Override
    public VirtualMachine.DefinitionWithOSDiskConfiguration fromUserImage(String containerName, String vhdName, OperatingSystemTypes osType) {
        // User images are the VHDs those are generated by applying CAPTURE operation on a GENERALIZED VM.
        this.storageProfile.osDisk().setCreateOption(DiskCreateOptionTypes.FROM_IMAGE);
        this.storageProfile.osDisk().setImage(toVhd(containerName, vhdName));
        this.storageProfile.osDisk().setOsType(osType);
        return this;
    }

    public VirtualMachine.DefinitionWithCommonOSDiskConfiguration useDisk(String containerName, String vhdName, OperatingSystemTypes osType) {
        this.storageProfile.osDisk().setCreateOption(DiskCreateOptionTypes.FROM_IMAGE);
        this.storageProfile.osDisk().setImage(toVhd(containerName, vhdName));
        this.storageProfile.osDisk().setOsType(osType);
        return this;
    }
}
