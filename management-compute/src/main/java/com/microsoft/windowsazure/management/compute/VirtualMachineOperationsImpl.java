/**
 * 
 * Copyright (c) Microsoft and contributors.  All rights reserved.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *   http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * 
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * 
 */

// Warning: This code was generated by a tool.
// 
// Changes to this file may cause incorrect behavior and will be lost if the
// code is regenerated.

package com.microsoft.windowsazure.management.compute;

import com.microsoft.windowsazure.core.OperationResponse;
import com.microsoft.windowsazure.core.ServiceOperations;
import com.microsoft.windowsazure.core.pipeline.apache.CustomHttpDelete;
import com.microsoft.windowsazure.core.utils.StreamUtils;
import com.microsoft.windowsazure.core.utils.XmlUtility;
import com.microsoft.windowsazure.exception.ServiceException;
import com.microsoft.windowsazure.management.compute.models.AccessControlListRule;
import com.microsoft.windowsazure.management.compute.models.ComputeOperationStatusResponse;
import com.microsoft.windowsazure.management.compute.models.ConfigurationSet;
import com.microsoft.windowsazure.management.compute.models.DataVirtualHardDisk;
import com.microsoft.windowsazure.management.compute.models.DnsServer;
import com.microsoft.windowsazure.management.compute.models.DomainJoinCredentials;
import com.microsoft.windowsazure.management.compute.models.DomainJoinProvisioning;
import com.microsoft.windowsazure.management.compute.models.DomainJoinSettings;
import com.microsoft.windowsazure.management.compute.models.EndpointAcl;
import com.microsoft.windowsazure.management.compute.models.InputEndpoint;
import com.microsoft.windowsazure.management.compute.models.LoadBalancerProbe;
import com.microsoft.windowsazure.management.compute.models.LoadBalancerProbeTransportProtocol;
import com.microsoft.windowsazure.management.compute.models.OSVirtualHardDisk;
import com.microsoft.windowsazure.management.compute.models.OperationStatus;
import com.microsoft.windowsazure.management.compute.models.ResourceExtensionParameterValue;
import com.microsoft.windowsazure.management.compute.models.ResourceExtensionReference;
import com.microsoft.windowsazure.management.compute.models.Role;
import com.microsoft.windowsazure.management.compute.models.SshSettingKeyPair;
import com.microsoft.windowsazure.management.compute.models.SshSettingPublicKey;
import com.microsoft.windowsazure.management.compute.models.SshSettings;
import com.microsoft.windowsazure.management.compute.models.StoredCertificateSettings;
import com.microsoft.windowsazure.management.compute.models.VirtualHardDiskHostCaching;
import com.microsoft.windowsazure.management.compute.models.VirtualMachineCaptureParameters;
import com.microsoft.windowsazure.management.compute.models.VirtualMachineCreateDeploymentParameters;
import com.microsoft.windowsazure.management.compute.models.VirtualMachineCreateParameters;
import com.microsoft.windowsazure.management.compute.models.VirtualMachineGetRemoteDesktopFileResponse;
import com.microsoft.windowsazure.management.compute.models.VirtualMachineGetResponse;
import com.microsoft.windowsazure.management.compute.models.VirtualMachineRoleType;
import com.microsoft.windowsazure.management.compute.models.VirtualMachineShutdownParameters;
import com.microsoft.windowsazure.management.compute.models.VirtualMachineShutdownRolesParameters;
import com.microsoft.windowsazure.management.compute.models.VirtualMachineStartRolesParameters;
import com.microsoft.windowsazure.management.compute.models.VirtualMachineUpdateLoadBalancedSetParameters;
import com.microsoft.windowsazure.management.compute.models.VirtualMachineUpdateParameters;
import com.microsoft.windowsazure.management.compute.models.VirtualMachineWindowsRemoteManagementListenerType;
import com.microsoft.windowsazure.management.compute.models.WindowsRemoteManagementListener;
import com.microsoft.windowsazure.management.compute.models.WindowsRemoteManagementSettings;
import com.microsoft.windowsazure.tracing.ClientRequestTrackingHandler;
import com.microsoft.windowsazure.tracing.CloudTracing;
import java.io.IOException;
import java.io.InputStream;
import java.io.StringWriter;
import java.net.InetAddress;
import java.net.URI;
import java.net.URISyntaxException;
import java.util.HashMap;
import java.util.concurrent.Callable;
import java.util.concurrent.ExecutionException;
import java.util.concurrent.Future;
import javax.xml.bind.DatatypeConverter;
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
import javax.xml.transform.Transformer;
import javax.xml.transform.TransformerException;
import javax.xml.transform.TransformerFactory;
import javax.xml.transform.dom.DOMSource;
import javax.xml.transform.stream.StreamResult;
import org.apache.commons.codec.binary.Base64;
import org.apache.http.HttpResponse;
import org.apache.http.HttpStatus;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.client.methods.HttpPut;
import org.apache.http.entity.StringEntity;
import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.NodeList;
import org.xml.sax.SAXException;

/**
* The Service Management API includes operations for managing the virtual
* machines in your subscription.  (see
* http://msdn.microsoft.com/en-us/library/windowsazure/jj157206.aspx for more
* information)
*/
public class VirtualMachineOperationsImpl implements ServiceOperations<ComputeManagementClientImpl>, VirtualMachineOperations {
    /**
    * Initializes a new instance of the VirtualMachineOperationsImpl class.
    *
    * @param client Reference to the service client.
    */
    VirtualMachineOperationsImpl(ComputeManagementClientImpl client) {
        this.client = client;
    }
    
    private ComputeManagementClientImpl client;
    
    /**
    * Gets a reference to the
    * microsoft.windowsazure.management.compute.ComputeManagementClientImpl.
    * @return The Client value.
    */
    public ComputeManagementClientImpl getClient() {
        return this.client;
    }
    
    /**
    * The Capture Role operation creates a copy of the operating system virtual
    * hard disk (VHD) that is deployed in the virtual machine, saves the VHD
    * copy in the same storage location as the operating system VHD, and
    * registers the copy as an image in your image gallery. From the captured
    * image, you can create additional customized virtual machines. For more
    * information about images and disks, see Manage Disks and Images. For
    * more information about capturing images, see How to Capture an Image of
    * a Virtual Machine Running Windows Server 2008 R2 or How to Capture an
    * Image of a Virtual Machine Running Linux.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157201.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine to restart.
    * @param parameters Parameters supplied to the Capture Virtual Machine
    * operation.
    * @return A standard service response including an HTTP status code and
    * request ID.
    */
    @Override
    public Future<OperationResponse> beginCapturingAsync(final String serviceName, final String deploymentName, final String virtualMachineName, final VirtualMachineCaptureParameters parameters) {
        return this.getClient().getExecutorService().submit(new Callable<OperationResponse>() { 
            @Override
            public OperationResponse call() throws Exception {
                return beginCapturing(serviceName, deploymentName, virtualMachineName, parameters);
            }
         });
    }
    
    /**
    * The Capture Role operation creates a copy of the operating system virtual
    * hard disk (VHD) that is deployed in the virtual machine, saves the VHD
    * copy in the same storage location as the operating system VHD, and
    * registers the copy as an image in your image gallery. From the captured
    * image, you can create additional customized virtual machines. For more
    * information about images and disks, see Manage Disks and Images. For
    * more information about capturing images, see How to Capture an Image of
    * a Virtual Machine Running Windows Server 2008 R2 or How to Capture an
    * Image of a Virtual Machine Running Linux.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157201.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine to restart.
    * @param parameters Parameters supplied to the Capture Virtual Machine
    * operation.
    * @throws ParserConfigurationException Thrown if there was an error
    * configuring the parser for the response body.
    * @throws SAXException Thrown if there was an error parsing the response
    * body.
    * @throws TransformerException Thrown if there was an error creating the
    * DOM transformer.
    * @throws IOException Signals that an I/O exception of some sort has
    * occurred. This class is the general class of exceptions produced by
    * failed or interrupted I/O operations.
    * @throws ServiceException Thrown if an unexpected response is found.
    * @return A standard service response including an HTTP status code and
    * request ID.
    */
    @Override
    public OperationResponse beginCapturing(String serviceName, String deploymentName, String virtualMachineName, VirtualMachineCaptureParameters parameters) throws ParserConfigurationException, SAXException, TransformerException, IOException, ServiceException {
        // Validate
        if (serviceName == null) {
            throw new NullPointerException("serviceName");
        }
        if (deploymentName == null) {
            throw new NullPointerException("deploymentName");
        }
        if (virtualMachineName == null) {
            throw new NullPointerException("virtualMachineName");
        }
        if (parameters == null) {
            throw new NullPointerException("parameters");
        }
        if (parameters.getProvisioningConfiguration() != null) {
            if (parameters.getProvisioningConfiguration().getDomainJoin() != null) {
                if (parameters.getProvisioningConfiguration().getDomainJoin().getCredentials() != null) {
                    if (parameters.getProvisioningConfiguration().getDomainJoin().getCredentials().getPassword() == null) {
                        throw new NullPointerException("parameters.ProvisioningConfiguration.DomainJoin.Credentials.Password");
                    }
                    if (parameters.getProvisioningConfiguration().getDomainJoin().getCredentials().getUserName() == null) {
                        throw new NullPointerException("parameters.ProvisioningConfiguration.DomainJoin.Credentials.UserName");
                    }
                }
            }
            if (parameters.getProvisioningConfiguration().getHostName() != null && parameters.getProvisioningConfiguration().getHostName().length() < 1) {
                throw new IllegalArgumentException("parameters.ProvisioningConfiguration.HostName");
            }
            if (parameters.getProvisioningConfiguration().getHostName() != null && parameters.getProvisioningConfiguration().getHostName().length() > 64) {
                throw new IllegalArgumentException("parameters.ProvisioningConfiguration.HostName");
            }
            if (parameters.getProvisioningConfiguration().getSshSettings() != null) {
                if (parameters.getProvisioningConfiguration().getSshSettings().getKeyPairs() != null) {
                    for (SshSettingKeyPair keyPairsParameterItem : parameters.getProvisioningConfiguration().getSshSettings().getKeyPairs()) {
                        if (keyPairsParameterItem.getFingerprint() == null) {
                            throw new NullPointerException("parameters.ProvisioningConfiguration.SshSettings.KeyPairs.Fingerprint");
                        }
                        if (keyPairsParameterItem.getPath() == null) {
                            throw new NullPointerException("parameters.ProvisioningConfiguration.SshSettings.KeyPairs.Path");
                        }
                    }
                }
                if (parameters.getProvisioningConfiguration().getSshSettings().getPublicKeys() != null) {
                    for (SshSettingPublicKey publicKeysParameterItem : parameters.getProvisioningConfiguration().getSshSettings().getPublicKeys()) {
                        if (publicKeysParameterItem.getFingerprint() == null) {
                            throw new NullPointerException("parameters.ProvisioningConfiguration.SshSettings.PublicKeys.Fingerprint");
                        }
                        if (publicKeysParameterItem.getPath() == null) {
                            throw new NullPointerException("parameters.ProvisioningConfiguration.SshSettings.PublicKeys.Path");
                        }
                    }
                }
            }
            if (parameters.getProvisioningConfiguration().getStoredCertificateSettings() != null) {
                for (StoredCertificateSettings storedCertificateSettingsParameterItem : parameters.getProvisioningConfiguration().getStoredCertificateSettings()) {
                    if (storedCertificateSettingsParameterItem.getStoreName() == null) {
                        throw new NullPointerException("parameters.ProvisioningConfiguration.StoredCertificateSettings.StoreName");
                    }
                    if (storedCertificateSettingsParameterItem.getThumbprint() == null) {
                        throw new NullPointerException("parameters.ProvisioningConfiguration.StoredCertificateSettings.Thumbprint");
                    }
                }
            }
            if (parameters.getProvisioningConfiguration().getUserName() != null && parameters.getProvisioningConfiguration().getUserName().length() < 1) {
                throw new IllegalArgumentException("parameters.ProvisioningConfiguration.UserName");
            }
            if (parameters.getProvisioningConfiguration().getUserName() != null && parameters.getProvisioningConfiguration().getUserName().length() > 32) {
                throw new IllegalArgumentException("parameters.ProvisioningConfiguration.UserName");
            }
            if (parameters.getProvisioningConfiguration().getUserPassword() != null && parameters.getProvisioningConfiguration().getUserPassword().length() < 6 && (parameters.getProvisioningConfiguration().isDisableSshPasswordAuthentication() == false || parameters.getProvisioningConfiguration().getUserPassword().length() != 0)) {
                throw new IllegalArgumentException("parameters.ProvisioningConfiguration.UserPassword");
            }
            if (parameters.getProvisioningConfiguration().getUserPassword() != null && parameters.getProvisioningConfiguration().getUserPassword().length() > 72) {
                throw new IllegalArgumentException("parameters.ProvisioningConfiguration.UserPassword");
            }
        }
        if (parameters.getTargetImageLabel() == null) {
            throw new NullPointerException("parameters.TargetImageLabel");
        }
        if (parameters.getTargetImageName() == null) {
            throw new NullPointerException("parameters.TargetImageName");
        }
        
        // Tracing
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("deploymentName", deploymentName);
            tracingParameters.put("virtualMachineName", virtualMachineName);
            tracingParameters.put("parameters", parameters);
            CloudTracing.enter(invocationId, this, "beginCapturingAsync", tracingParameters);
        }
        
        // Construct URL
        String url = this.getClient().getBaseUri() + "/" + this.getClient().getCredentials().getSubscriptionId() + "/services/hostedservices/" + serviceName + "/deployments/" + deploymentName + "/roleinstances/" + virtualMachineName + "/Operations";
        
        // Create HTTP transport objects
        HttpPost httpRequest = new HttpPost(url);
        
        // Set Headers
        httpRequest.setHeader("Content-Type", "application/xml");
        httpRequest.setHeader("x-ms-version", "2013-11-01");
        
        // Serialize Request
        String requestContent = null;
        DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();
        DocumentBuilder documentBuilder = documentBuilderFactory.newDocumentBuilder();
        Document requestDoc = documentBuilder.newDocument();
        
        Element captureRoleOperationElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "CaptureRoleOperation");
        requestDoc.appendChild(captureRoleOperationElement);
        
        Element operationTypeElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "OperationType");
        operationTypeElement.appendChild(requestDoc.createTextNode("CaptureRoleOperation"));
        captureRoleOperationElement.appendChild(operationTypeElement);
        
        Element postCaptureActionElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "PostCaptureAction");
        postCaptureActionElement.appendChild(requestDoc.createTextNode(parameters.getPostCaptureAction().toString()));
        captureRoleOperationElement.appendChild(postCaptureActionElement);
        
        if (parameters.getProvisioningConfiguration() != null) {
            Element provisioningConfigurationElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ProvisioningConfiguration");
            captureRoleOperationElement.appendChild(provisioningConfigurationElement);
            
            if (parameters.getProvisioningConfiguration().getConfigurationSetType() != null) {
                Element configurationSetTypeElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ConfigurationSetType");
                configurationSetTypeElement.appendChild(requestDoc.createTextNode(parameters.getProvisioningConfiguration().getConfigurationSetType()));
                provisioningConfigurationElement.appendChild(configurationSetTypeElement);
            }
            
            if (parameters.getProvisioningConfiguration().getInputEndpoints() != null) {
                Element inputEndpointsSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "InputEndpoints");
                for (InputEndpoint inputEndpointsItem : parameters.getProvisioningConfiguration().getInputEndpoints()) {
                    Element inputEndpointElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "InputEndpoint");
                    inputEndpointsSequenceElement.appendChild(inputEndpointElement);
                    
                    if (inputEndpointsItem.getLoadBalancedEndpointSetName() != null) {
                        Element loadBalancedEndpointSetNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "LoadBalancedEndpointSetName");
                        loadBalancedEndpointSetNameElement.appendChild(requestDoc.createTextNode(inputEndpointsItem.getLoadBalancedEndpointSetName()));
                        inputEndpointElement.appendChild(loadBalancedEndpointSetNameElement);
                    }
                    
                    if (inputEndpointsItem.getLocalPort() != null) {
                        Element localPortElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "LocalPort");
                        localPortElement.appendChild(requestDoc.createTextNode(Integer.toString(inputEndpointsItem.getLocalPort())));
                        inputEndpointElement.appendChild(localPortElement);
                    }
                    
                    if (inputEndpointsItem.getName() != null) {
                        Element nameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Name");
                        nameElement.appendChild(requestDoc.createTextNode(inputEndpointsItem.getName()));
                        inputEndpointElement.appendChild(nameElement);
                    }
                    
                    if (inputEndpointsItem.getPort() != null) {
                        Element portElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Port");
                        portElement.appendChild(requestDoc.createTextNode(Integer.toString(inputEndpointsItem.getPort())));
                        inputEndpointElement.appendChild(portElement);
                    }
                    
                    if (inputEndpointsItem.getLoadBalancerProbe() != null) {
                        Element loadBalancerProbeElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "LoadBalancerProbe");
                        inputEndpointElement.appendChild(loadBalancerProbeElement);
                        
                        if (inputEndpointsItem.getLoadBalancerProbe().getPath() != null) {
                            Element pathElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Path");
                            pathElement.appendChild(requestDoc.createTextNode(inputEndpointsItem.getLoadBalancerProbe().getPath()));
                            loadBalancerProbeElement.appendChild(pathElement);
                        }
                        
                        Element portElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Port");
                        portElement2.appendChild(requestDoc.createTextNode(Integer.toString(inputEndpointsItem.getLoadBalancerProbe().getPort())));
                        loadBalancerProbeElement.appendChild(portElement2);
                        
                        Element protocolElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Protocol");
                        protocolElement.appendChild(requestDoc.createTextNode(ComputeManagementClientImpl.loadBalancerProbeTransportProtocolToString(inputEndpointsItem.getLoadBalancerProbe().getProtocol())));
                        loadBalancerProbeElement.appendChild(protocolElement);
                        
                        if (inputEndpointsItem.getLoadBalancerProbe().getIntervalInSeconds() != null) {
                            Element intervalInSecondsElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "IntervalInSeconds");
                            intervalInSecondsElement.appendChild(requestDoc.createTextNode(Integer.toString(inputEndpointsItem.getLoadBalancerProbe().getIntervalInSeconds())));
                            loadBalancerProbeElement.appendChild(intervalInSecondsElement);
                        }
                        
                        if (inputEndpointsItem.getLoadBalancerProbe().getTimeoutInSeconds() != null) {
                            Element timeoutInSecondsElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "TimeoutInSeconds");
                            timeoutInSecondsElement.appendChild(requestDoc.createTextNode(Integer.toString(inputEndpointsItem.getLoadBalancerProbe().getTimeoutInSeconds())));
                            loadBalancerProbeElement.appendChild(timeoutInSecondsElement);
                        }
                    }
                    
                    if (inputEndpointsItem.getProtocol() != null) {
                        Element protocolElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Protocol");
                        protocolElement2.appendChild(requestDoc.createTextNode(inputEndpointsItem.getProtocol()));
                        inputEndpointElement.appendChild(protocolElement2);
                    }
                    
                    if (inputEndpointsItem.getVirtualIPAddress() != null) {
                        Element vipElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Vip");
                        vipElement.appendChild(requestDoc.createTextNode(inputEndpointsItem.getVirtualIPAddress().getHostAddress()));
                        inputEndpointElement.appendChild(vipElement);
                    }
                    
                    if (inputEndpointsItem.isEnableDirectServerReturn() != null) {
                        Element enableDirectServerReturnElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "EnableDirectServerReturn");
                        enableDirectServerReturnElement.appendChild(requestDoc.createTextNode(Boolean.toString(inputEndpointsItem.isEnableDirectServerReturn()).toLowerCase()));
                        inputEndpointElement.appendChild(enableDirectServerReturnElement);
                    }
                    
                    if (inputEndpointsItem.getEndpointAcl() != null) {
                        Element endpointAclElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "EndpointAcl");
                        inputEndpointElement.appendChild(endpointAclElement);
                        
                        if (inputEndpointsItem.getEndpointAcl().getRules() != null) {
                            Element rulesSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Rules");
                            for (AccessControlListRule rulesItem : inputEndpointsItem.getEndpointAcl().getRules()) {
                                Element ruleElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Rule");
                                rulesSequenceElement.appendChild(ruleElement);
                                
                                if (rulesItem.getOrder() != null) {
                                    Element orderElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Order");
                                    orderElement.appendChild(requestDoc.createTextNode(Integer.toString(rulesItem.getOrder())));
                                    ruleElement.appendChild(orderElement);
                                }
                                
                                if (rulesItem.getAction() != null) {
                                    Element actionElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Action");
                                    actionElement.appendChild(requestDoc.createTextNode(rulesItem.getAction()));
                                    ruleElement.appendChild(actionElement);
                                }
                                
                                if (rulesItem.getRemoteSubnet() != null) {
                                    Element remoteSubnetElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "RemoteSubnet");
                                    remoteSubnetElement.appendChild(requestDoc.createTextNode(rulesItem.getRemoteSubnet()));
                                    ruleElement.appendChild(remoteSubnetElement);
                                }
                                
                                if (rulesItem.getDescription() != null) {
                                    Element descriptionElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Description");
                                    descriptionElement.appendChild(requestDoc.createTextNode(rulesItem.getDescription()));
                                    ruleElement.appendChild(descriptionElement);
                                }
                            }
                            endpointAclElement.appendChild(rulesSequenceElement);
                        }
                    }
                }
                provisioningConfigurationElement.appendChild(inputEndpointsSequenceElement);
            }
            
            if (parameters.getProvisioningConfiguration().getSubnetNames() != null) {
                Element subnetNamesSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "SubnetNames");
                for (String subnetNamesItem : parameters.getProvisioningConfiguration().getSubnetNames()) {
                    Element subnetNamesItemElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "SubnetName");
                    subnetNamesItemElement.appendChild(requestDoc.createTextNode(subnetNamesItem));
                    subnetNamesSequenceElement.appendChild(subnetNamesItemElement);
                }
                provisioningConfigurationElement.appendChild(subnetNamesSequenceElement);
            }
            
            if (parameters.getProvisioningConfiguration().getStaticVirtualNetworkIPAddress() != null) {
                Element staticVirtualNetworkIPAddressElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "StaticVirtualNetworkIPAddress");
                staticVirtualNetworkIPAddressElement.appendChild(requestDoc.createTextNode(parameters.getProvisioningConfiguration().getStaticVirtualNetworkIPAddress()));
                provisioningConfigurationElement.appendChild(staticVirtualNetworkIPAddressElement);
            }
            
            if (parameters.getProvisioningConfiguration().getComputerName() != null) {
                Element computerNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ComputerName");
                computerNameElement.appendChild(requestDoc.createTextNode(parameters.getProvisioningConfiguration().getComputerName()));
                provisioningConfigurationElement.appendChild(computerNameElement);
            }
            
            if (parameters.getProvisioningConfiguration().getAdminPassword() != null) {
                Element adminPasswordElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "AdminPassword");
                adminPasswordElement.appendChild(requestDoc.createTextNode(parameters.getProvisioningConfiguration().getAdminPassword()));
                provisioningConfigurationElement.appendChild(adminPasswordElement);
            }
            
            if (parameters.getProvisioningConfiguration().isResetPasswordOnFirstLogon() != null) {
                Element resetPasswordOnFirstLogonElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ResetPasswordOnFirstLogon");
                resetPasswordOnFirstLogonElement.appendChild(requestDoc.createTextNode(Boolean.toString(parameters.getProvisioningConfiguration().isResetPasswordOnFirstLogon()).toLowerCase()));
                provisioningConfigurationElement.appendChild(resetPasswordOnFirstLogonElement);
            }
            
            if (parameters.getProvisioningConfiguration().isEnableAutomaticUpdates() != null) {
                Element enableAutomaticUpdatesElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "EnableAutomaticUpdates");
                enableAutomaticUpdatesElement.appendChild(requestDoc.createTextNode(Boolean.toString(parameters.getProvisioningConfiguration().isEnableAutomaticUpdates()).toLowerCase()));
                provisioningConfigurationElement.appendChild(enableAutomaticUpdatesElement);
            }
            
            if (parameters.getProvisioningConfiguration().getTimeZone() != null) {
                Element timeZoneElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "TimeZone");
                timeZoneElement.appendChild(requestDoc.createTextNode(parameters.getProvisioningConfiguration().getTimeZone()));
                provisioningConfigurationElement.appendChild(timeZoneElement);
            }
            
            if (parameters.getProvisioningConfiguration().getDomainJoin() != null) {
                Element domainJoinElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DomainJoin");
                provisioningConfigurationElement.appendChild(domainJoinElement);
                
                if (parameters.getProvisioningConfiguration().getDomainJoin().getCredentials() != null) {
                    Element credentialsElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Credentials");
                    domainJoinElement.appendChild(credentialsElement);
                    
                    if (parameters.getProvisioningConfiguration().getDomainJoin().getCredentials().getDomain() != null) {
                        Element domainElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Domain");
                        domainElement.appendChild(requestDoc.createTextNode(parameters.getProvisioningConfiguration().getDomainJoin().getCredentials().getDomain()));
                        credentialsElement.appendChild(domainElement);
                    }
                    
                    Element usernameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Username");
                    usernameElement.appendChild(requestDoc.createTextNode(parameters.getProvisioningConfiguration().getDomainJoin().getCredentials().getUserName()));
                    credentialsElement.appendChild(usernameElement);
                    
                    Element passwordElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Password");
                    passwordElement.appendChild(requestDoc.createTextNode(parameters.getProvisioningConfiguration().getDomainJoin().getCredentials().getPassword()));
                    credentialsElement.appendChild(passwordElement);
                }
                
                if (parameters.getProvisioningConfiguration().getDomainJoin().getDomainToJoin() != null) {
                    Element joinDomainElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "JoinDomain");
                    joinDomainElement.appendChild(requestDoc.createTextNode(parameters.getProvisioningConfiguration().getDomainJoin().getDomainToJoin()));
                    domainJoinElement.appendChild(joinDomainElement);
                }
                
                if (parameters.getProvisioningConfiguration().getDomainJoin().getLdapMachineObjectOU() != null) {
                    Element machineObjectOUElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "MachineObjectOU");
                    machineObjectOUElement.appendChild(requestDoc.createTextNode(parameters.getProvisioningConfiguration().getDomainJoin().getLdapMachineObjectOU()));
                    domainJoinElement.appendChild(machineObjectOUElement);
                }
                
                if (parameters.getProvisioningConfiguration().getDomainJoin().getProvisioning() != null) {
                    Element provisioningElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Provisioning");
                    domainJoinElement.appendChild(provisioningElement);
                    
                    if (parameters.getProvisioningConfiguration().getDomainJoin().getProvisioning().getAccountData() != null) {
                        Element accountDataElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "AccountData");
                        accountDataElement.appendChild(requestDoc.createTextNode(parameters.getProvisioningConfiguration().getDomainJoin().getProvisioning().getAccountData()));
                        provisioningElement.appendChild(accountDataElement);
                    }
                }
            }
            
            if (parameters.getProvisioningConfiguration().getStoredCertificateSettings() != null) {
                Element storedCertificateSettingsSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "StoredCertificateSettings");
                for (StoredCertificateSettings storedCertificateSettingsItem : parameters.getProvisioningConfiguration().getStoredCertificateSettings()) {
                    Element certificateSettingElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "CertificateSetting");
                    storedCertificateSettingsSequenceElement.appendChild(certificateSettingElement);
                    
                    Element storeLocationElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "StoreLocation");
                    storeLocationElement.appendChild(requestDoc.createTextNode("LocalMachine"));
                    certificateSettingElement.appendChild(storeLocationElement);
                    
                    Element storeNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "StoreName");
                    storeNameElement.appendChild(requestDoc.createTextNode(storedCertificateSettingsItem.getStoreName()));
                    certificateSettingElement.appendChild(storeNameElement);
                    
                    Element thumbprintElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Thumbprint");
                    thumbprintElement.appendChild(requestDoc.createTextNode(storedCertificateSettingsItem.getThumbprint()));
                    certificateSettingElement.appendChild(thumbprintElement);
                }
                provisioningConfigurationElement.appendChild(storedCertificateSettingsSequenceElement);
            }
            
            if (parameters.getProvisioningConfiguration().getWindowsRemoteManagement() != null) {
                Element winRMElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "WinRM");
                provisioningConfigurationElement.appendChild(winRMElement);
                
                if (parameters.getProvisioningConfiguration().getWindowsRemoteManagement().getListeners() != null) {
                    Element listenersSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Listeners");
                    for (WindowsRemoteManagementListener listenersItem : parameters.getProvisioningConfiguration().getWindowsRemoteManagement().getListeners()) {
                        Element listenerElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Listener");
                        listenersSequenceElement.appendChild(listenerElement);
                        
                        if (listenersItem.getCertificateThumbprint() != null) {
                            Element certificateThumbprintElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "CertificateThumbprint");
                            certificateThumbprintElement.appendChild(requestDoc.createTextNode(listenersItem.getCertificateThumbprint()));
                            listenerElement.appendChild(certificateThumbprintElement);
                        }
                        
                        Element protocolElement3 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Protocol");
                        protocolElement3.appendChild(requestDoc.createTextNode(listenersItem.getListenerType().toString()));
                        listenerElement.appendChild(protocolElement3);
                    }
                    winRMElement.appendChild(listenersSequenceElement);
                }
            }
            
            if (parameters.getProvisioningConfiguration().getAdminUserName() != null) {
                Element adminUsernameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "AdminUsername");
                adminUsernameElement.appendChild(requestDoc.createTextNode(parameters.getProvisioningConfiguration().getAdminUserName()));
                provisioningConfigurationElement.appendChild(adminUsernameElement);
            }
            
            if (parameters.getProvisioningConfiguration().getHostName() != null) {
                Element hostNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "HostName");
                hostNameElement.appendChild(requestDoc.createTextNode(parameters.getProvisioningConfiguration().getHostName()));
                provisioningConfigurationElement.appendChild(hostNameElement);
            }
            
            if (parameters.getProvisioningConfiguration().getUserName() != null) {
                Element userNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "UserName");
                userNameElement.appendChild(requestDoc.createTextNode(parameters.getProvisioningConfiguration().getUserName()));
                provisioningConfigurationElement.appendChild(userNameElement);
            }
            
            if (parameters.getProvisioningConfiguration().getUserPassword() != null) {
                Element userPasswordElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "UserPassword");
                userPasswordElement.appendChild(requestDoc.createTextNode(parameters.getProvisioningConfiguration().getUserPassword()));
                provisioningConfigurationElement.appendChild(userPasswordElement);
            }
            
            if (parameters.getProvisioningConfiguration().isDisableSshPasswordAuthentication() != null) {
                Element disableSshPasswordAuthenticationElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DisableSshPasswordAuthentication");
                disableSshPasswordAuthenticationElement.appendChild(requestDoc.createTextNode(Boolean.toString(parameters.getProvisioningConfiguration().isDisableSshPasswordAuthentication()).toLowerCase()));
                provisioningConfigurationElement.appendChild(disableSshPasswordAuthenticationElement);
            }
            
            if (parameters.getProvisioningConfiguration().getSshSettings() != null) {
                Element sSHElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "SSH");
                provisioningConfigurationElement.appendChild(sSHElement);
                
                if (parameters.getProvisioningConfiguration().getSshSettings().getPublicKeys() != null) {
                    Element publicKeysSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "PublicKeys");
                    for (SshSettingPublicKey publicKeysItem : parameters.getProvisioningConfiguration().getSshSettings().getPublicKeys()) {
                        Element publicKeyElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "PublicKey");
                        publicKeysSequenceElement.appendChild(publicKeyElement);
                        
                        Element fingerprintElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Fingerprint");
                        fingerprintElement.appendChild(requestDoc.createTextNode(publicKeysItem.getFingerprint()));
                        publicKeyElement.appendChild(fingerprintElement);
                        
                        Element pathElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Path");
                        pathElement2.appendChild(requestDoc.createTextNode(publicKeysItem.getPath()));
                        publicKeyElement.appendChild(pathElement2);
                    }
                    sSHElement.appendChild(publicKeysSequenceElement);
                }
                
                if (parameters.getProvisioningConfiguration().getSshSettings().getKeyPairs() != null) {
                    Element keyPairsSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "KeyPairs");
                    for (SshSettingKeyPair keyPairsItem : parameters.getProvisioningConfiguration().getSshSettings().getKeyPairs()) {
                        Element keyPairElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "KeyPair");
                        keyPairsSequenceElement.appendChild(keyPairElement);
                        
                        Element fingerprintElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Fingerprint");
                        fingerprintElement2.appendChild(requestDoc.createTextNode(keyPairsItem.getFingerprint()));
                        keyPairElement.appendChild(fingerprintElement2);
                        
                        Element pathElement3 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Path");
                        pathElement3.appendChild(requestDoc.createTextNode(keyPairsItem.getPath()));
                        keyPairElement.appendChild(pathElement3);
                    }
                    sSHElement.appendChild(keyPairsSequenceElement);
                }
            }
        }
        
        Element targetImageLabelElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "TargetImageLabel");
        targetImageLabelElement.appendChild(requestDoc.createTextNode(parameters.getTargetImageLabel()));
        captureRoleOperationElement.appendChild(targetImageLabelElement);
        
        Element targetImageNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "TargetImageName");
        targetImageNameElement.appendChild(requestDoc.createTextNode(parameters.getTargetImageName()));
        captureRoleOperationElement.appendChild(targetImageNameElement);
        
        DOMSource domSource = new DOMSource(requestDoc);
        StringWriter stringWriter = new StringWriter();
        StreamResult streamResult = new StreamResult(stringWriter);
        TransformerFactory transformerFactory = TransformerFactory.newInstance();
        Transformer transformer = transformerFactory.newTransformer();
        transformer.transform(domSource, streamResult);
        requestContent = stringWriter.toString();
        StringEntity entity = new StringEntity(requestContent);
        httpRequest.setEntity(entity);
        httpRequest.setHeader("Content-Type", "application/xml");
        
        // Send Request
        HttpResponse httpResponse = null;
        try {
            if (shouldTrace) {
                CloudTracing.sendRequest(invocationId, httpRequest);
            }
            httpResponse = this.getClient().getHttpClient().execute(httpRequest);
            if (shouldTrace) {
                CloudTracing.receiveResponse(invocationId, httpResponse);
            }
            int statusCode = httpResponse.getStatusLine().getStatusCode();
            if (statusCode != HttpStatus.SC_ACCEPTED) {
                ServiceException ex = ServiceException.createFromXml(httpRequest, requestContent, httpResponse, httpResponse.getEntity());
                if (shouldTrace) {
                    CloudTracing.error(invocationId, ex);
                }
                throw ex;
            }
            
            // Create Result
            OperationResponse result = null;
            result = new OperationResponse();
            result.setStatusCode(statusCode);
            if (httpResponse.getHeaders("x-ms-request-id").length > 0) {
                result.setRequestId(httpResponse.getFirstHeader("x-ms-request-id").getValue());
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            return result;
        } finally {
            if (httpResponse != null && httpResponse.getEntity() != null) {
                httpResponse.getEntity().getContent().close();
            }
        }
    }
    
    /**
    * The Add Role operation adds a virtual machine to an existing deployment.
    * You can refer to the OSDisk in the Add Role operation in the following
    * ways.  Platform/User Image – Set the SourceImageName to a platform or
    * user image. You can optionally specify the DiskName and MediaLink values
    * as part the operation to control the name and location of target disk.
    * When DiskName and MediaLink are specified in this mode, they must not
    * already exist in the system, otherwise a conflict fault is returned.
    * UserDisk – Set DiskName to a user supplied image in image repository.
    * SourceImageName must be set to NULL. All other properties are ignored.
    * Blob in a Storage Account – Set MediaLink to a blob containing the
    * image. SourceImageName and DiskName are set to NULL.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157186.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param parameters Parameters supplied to the Create Virtual Machine
    * operation.
    * @return A standard service response including an HTTP status code and
    * request ID.
    */
    @Override
    public Future<OperationResponse> beginCreatingAsync(final String serviceName, final String deploymentName, final VirtualMachineCreateParameters parameters) {
        return this.getClient().getExecutorService().submit(new Callable<OperationResponse>() { 
            @Override
            public OperationResponse call() throws Exception {
                return beginCreating(serviceName, deploymentName, parameters);
            }
         });
    }
    
    /**
    * The Add Role operation adds a virtual machine to an existing deployment.
    * You can refer to the OSDisk in the Add Role operation in the following
    * ways.  Platform/User Image – Set the SourceImageName to a platform or
    * user image. You can optionally specify the DiskName and MediaLink values
    * as part the operation to control the name and location of target disk.
    * When DiskName and MediaLink are specified in this mode, they must not
    * already exist in the system, otherwise a conflict fault is returned.
    * UserDisk – Set DiskName to a user supplied image in image repository.
    * SourceImageName must be set to NULL. All other properties are ignored.
    * Blob in a Storage Account – Set MediaLink to a blob containing the
    * image. SourceImageName and DiskName are set to NULL.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157186.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param parameters Parameters supplied to the Create Virtual Machine
    * operation.
    * @throws ParserConfigurationException Thrown if there was an error
    * configuring the parser for the response body.
    * @throws SAXException Thrown if there was an error parsing the response
    * body.
    * @throws TransformerException Thrown if there was an error creating the
    * DOM transformer.
    * @throws IOException Signals that an I/O exception of some sort has
    * occurred. This class is the general class of exceptions produced by
    * failed or interrupted I/O operations.
    * @throws ServiceException Thrown if an unexpected response is found.
    * @return A standard service response including an HTTP status code and
    * request ID.
    */
    @Override
    public OperationResponse beginCreating(String serviceName, String deploymentName, VirtualMachineCreateParameters parameters) throws ParserConfigurationException, SAXException, TransformerException, IOException, ServiceException {
        // Validate
        if (serviceName == null) {
            throw new NullPointerException("serviceName");
        }
        if (deploymentName == null) {
            throw new NullPointerException("deploymentName");
        }
        if (parameters == null) {
            throw new NullPointerException("parameters");
        }
        if (parameters.getConfigurationSets() != null) {
            for (ConfigurationSet configurationSetsParameterItem : parameters.getConfigurationSets()) {
                if (configurationSetsParameterItem.getDomainJoin() != null) {
                    if (configurationSetsParameterItem.getDomainJoin().getCredentials() != null) {
                        if (configurationSetsParameterItem.getDomainJoin().getCredentials().getPassword() == null) {
                            throw new NullPointerException("parameters.ConfigurationSets.DomainJoin.Credentials.Password");
                        }
                        if (configurationSetsParameterItem.getDomainJoin().getCredentials().getUserName() == null) {
                            throw new NullPointerException("parameters.ConfigurationSets.DomainJoin.Credentials.UserName");
                        }
                    }
                }
                if (configurationSetsParameterItem.getHostName() != null && configurationSetsParameterItem.getHostName().length() < 1) {
                    throw new IllegalArgumentException("parameters.ConfigurationSets.HostName");
                }
                if (configurationSetsParameterItem.getHostName() != null && configurationSetsParameterItem.getHostName().length() > 64) {
                    throw new IllegalArgumentException("parameters.ConfigurationSets.HostName");
                }
                if (configurationSetsParameterItem.getSshSettings() != null) {
                    if (configurationSetsParameterItem.getSshSettings().getKeyPairs() != null) {
                        for (SshSettingKeyPair keyPairsParameterItem : configurationSetsParameterItem.getSshSettings().getKeyPairs()) {
                            if (keyPairsParameterItem.getFingerprint() == null) {
                                throw new NullPointerException("parameters.ConfigurationSets.SshSettings.KeyPairs.Fingerprint");
                            }
                            if (keyPairsParameterItem.getPath() == null) {
                                throw new NullPointerException("parameters.ConfigurationSets.SshSettings.KeyPairs.Path");
                            }
                        }
                    }
                    if (configurationSetsParameterItem.getSshSettings().getPublicKeys() != null) {
                        for (SshSettingPublicKey publicKeysParameterItem : configurationSetsParameterItem.getSshSettings().getPublicKeys()) {
                            if (publicKeysParameterItem.getFingerprint() == null) {
                                throw new NullPointerException("parameters.ConfigurationSets.SshSettings.PublicKeys.Fingerprint");
                            }
                            if (publicKeysParameterItem.getPath() == null) {
                                throw new NullPointerException("parameters.ConfigurationSets.SshSettings.PublicKeys.Path");
                            }
                        }
                    }
                }
                if (configurationSetsParameterItem.getStoredCertificateSettings() != null) {
                    for (StoredCertificateSettings storedCertificateSettingsParameterItem : configurationSetsParameterItem.getStoredCertificateSettings()) {
                        if (storedCertificateSettingsParameterItem.getStoreName() == null) {
                            throw new NullPointerException("parameters.ConfigurationSets.StoredCertificateSettings.StoreName");
                        }
                        if (storedCertificateSettingsParameterItem.getThumbprint() == null) {
                            throw new NullPointerException("parameters.ConfigurationSets.StoredCertificateSettings.Thumbprint");
                        }
                    }
                }
                if (configurationSetsParameterItem.getUserName() != null && configurationSetsParameterItem.getUserName().length() < 1) {
                    throw new IllegalArgumentException("parameters.ConfigurationSets.UserName");
                }
                if (configurationSetsParameterItem.getUserName() != null && configurationSetsParameterItem.getUserName().length() > 32) {
                    throw new IllegalArgumentException("parameters.ConfigurationSets.UserName");
                }
                if (configurationSetsParameterItem.getUserPassword() != null && configurationSetsParameterItem.getUserPassword().length() < 6 && (configurationSetsParameterItem.isDisableSshPasswordAuthentication() == false || configurationSetsParameterItem.getUserPassword().length() != 0)) {
                    throw new IllegalArgumentException("parameters.ConfigurationSets.UserPassword");
                }
                if (configurationSetsParameterItem.getUserPassword() != null && configurationSetsParameterItem.getUserPassword().length() > 72) {
                    throw new IllegalArgumentException("parameters.ConfigurationSets.UserPassword");
                }
            }
        }
        if (parameters.getRoleName() == null) {
            throw new NullPointerException("parameters.RoleName");
        }
        
        // Tracing
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("deploymentName", deploymentName);
            tracingParameters.put("parameters", parameters);
            CloudTracing.enter(invocationId, this, "beginCreatingAsync", tracingParameters);
        }
        
        // Construct URL
        String url = this.getClient().getBaseUri() + "/" + this.getClient().getCredentials().getSubscriptionId() + "/services/hostedservices/" + serviceName + "/deployments/" + deploymentName + "/roles";
        
        // Create HTTP transport objects
        HttpPost httpRequest = new HttpPost(url);
        
        // Set Headers
        httpRequest.setHeader("Content-Type", "application/xml");
        httpRequest.setHeader("x-ms-version", "2013-11-01");
        
        // Serialize Request
        String requestContent = null;
        DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();
        DocumentBuilder documentBuilder = documentBuilderFactory.newDocumentBuilder();
        Document requestDoc = documentBuilder.newDocument();
        
        Element persistentVMRoleElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "PersistentVMRole");
        requestDoc.appendChild(persistentVMRoleElement);
        
        Element roleNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "RoleName");
        roleNameElement.appendChild(requestDoc.createTextNode(parameters.getRoleName()));
        persistentVMRoleElement.appendChild(roleNameElement);
        
        Element roleTypeElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "RoleType");
        roleTypeElement.appendChild(requestDoc.createTextNode("PersistentVMRole"));
        persistentVMRoleElement.appendChild(roleTypeElement);
        
        if (parameters.getConfigurationSets() != null) {
            Element configurationSetsSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ConfigurationSets");
            for (ConfigurationSet configurationSetsItem : parameters.getConfigurationSets()) {
                Element configurationSetElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ConfigurationSet");
                configurationSetsSequenceElement.appendChild(configurationSetElement);
                
                if (configurationSetsItem.getConfigurationSetType() != null) {
                    Element configurationSetTypeElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ConfigurationSetType");
                    configurationSetTypeElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getConfigurationSetType()));
                    configurationSetElement.appendChild(configurationSetTypeElement);
                }
                
                if (configurationSetsItem.getInputEndpoints() != null) {
                    Element inputEndpointsSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "InputEndpoints");
                    for (InputEndpoint inputEndpointsItem : configurationSetsItem.getInputEndpoints()) {
                        Element inputEndpointElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "InputEndpoint");
                        inputEndpointsSequenceElement.appendChild(inputEndpointElement);
                        
                        if (inputEndpointsItem.getLoadBalancedEndpointSetName() != null) {
                            Element loadBalancedEndpointSetNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "LoadBalancedEndpointSetName");
                            loadBalancedEndpointSetNameElement.appendChild(requestDoc.createTextNode(inputEndpointsItem.getLoadBalancedEndpointSetName()));
                            inputEndpointElement.appendChild(loadBalancedEndpointSetNameElement);
                        }
                        
                        if (inputEndpointsItem.getLocalPort() != null) {
                            Element localPortElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "LocalPort");
                            localPortElement.appendChild(requestDoc.createTextNode(Integer.toString(inputEndpointsItem.getLocalPort())));
                            inputEndpointElement.appendChild(localPortElement);
                        }
                        
                        if (inputEndpointsItem.getName() != null) {
                            Element nameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Name");
                            nameElement.appendChild(requestDoc.createTextNode(inputEndpointsItem.getName()));
                            inputEndpointElement.appendChild(nameElement);
                        }
                        
                        if (inputEndpointsItem.getPort() != null) {
                            Element portElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Port");
                            portElement.appendChild(requestDoc.createTextNode(Integer.toString(inputEndpointsItem.getPort())));
                            inputEndpointElement.appendChild(portElement);
                        }
                        
                        if (inputEndpointsItem.getLoadBalancerProbe() != null) {
                            Element loadBalancerProbeElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "LoadBalancerProbe");
                            inputEndpointElement.appendChild(loadBalancerProbeElement);
                            
                            if (inputEndpointsItem.getLoadBalancerProbe().getPath() != null) {
                                Element pathElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Path");
                                pathElement.appendChild(requestDoc.createTextNode(inputEndpointsItem.getLoadBalancerProbe().getPath()));
                                loadBalancerProbeElement.appendChild(pathElement);
                            }
                            
                            Element portElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Port");
                            portElement2.appendChild(requestDoc.createTextNode(Integer.toString(inputEndpointsItem.getLoadBalancerProbe().getPort())));
                            loadBalancerProbeElement.appendChild(portElement2);
                            
                            Element protocolElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Protocol");
                            protocolElement.appendChild(requestDoc.createTextNode(ComputeManagementClientImpl.loadBalancerProbeTransportProtocolToString(inputEndpointsItem.getLoadBalancerProbe().getProtocol())));
                            loadBalancerProbeElement.appendChild(protocolElement);
                            
                            if (inputEndpointsItem.getLoadBalancerProbe().getIntervalInSeconds() != null) {
                                Element intervalInSecondsElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "IntervalInSeconds");
                                intervalInSecondsElement.appendChild(requestDoc.createTextNode(Integer.toString(inputEndpointsItem.getLoadBalancerProbe().getIntervalInSeconds())));
                                loadBalancerProbeElement.appendChild(intervalInSecondsElement);
                            }
                            
                            if (inputEndpointsItem.getLoadBalancerProbe().getTimeoutInSeconds() != null) {
                                Element timeoutInSecondsElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "TimeoutInSeconds");
                                timeoutInSecondsElement.appendChild(requestDoc.createTextNode(Integer.toString(inputEndpointsItem.getLoadBalancerProbe().getTimeoutInSeconds())));
                                loadBalancerProbeElement.appendChild(timeoutInSecondsElement);
                            }
                        }
                        
                        if (inputEndpointsItem.getProtocol() != null) {
                            Element protocolElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Protocol");
                            protocolElement2.appendChild(requestDoc.createTextNode(inputEndpointsItem.getProtocol()));
                            inputEndpointElement.appendChild(protocolElement2);
                        }
                        
                        if (inputEndpointsItem.getVirtualIPAddress() != null) {
                            Element vipElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Vip");
                            vipElement.appendChild(requestDoc.createTextNode(inputEndpointsItem.getVirtualIPAddress().getHostAddress()));
                            inputEndpointElement.appendChild(vipElement);
                        }
                        
                        if (inputEndpointsItem.isEnableDirectServerReturn() != null) {
                            Element enableDirectServerReturnElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "EnableDirectServerReturn");
                            enableDirectServerReturnElement.appendChild(requestDoc.createTextNode(Boolean.toString(inputEndpointsItem.isEnableDirectServerReturn()).toLowerCase()));
                            inputEndpointElement.appendChild(enableDirectServerReturnElement);
                        }
                        
                        if (inputEndpointsItem.getEndpointAcl() != null) {
                            Element endpointAclElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "EndpointAcl");
                            inputEndpointElement.appendChild(endpointAclElement);
                            
                            if (inputEndpointsItem.getEndpointAcl().getRules() != null) {
                                Element rulesSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Rules");
                                for (AccessControlListRule rulesItem : inputEndpointsItem.getEndpointAcl().getRules()) {
                                    Element ruleElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Rule");
                                    rulesSequenceElement.appendChild(ruleElement);
                                    
                                    if (rulesItem.getOrder() != null) {
                                        Element orderElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Order");
                                        orderElement.appendChild(requestDoc.createTextNode(Integer.toString(rulesItem.getOrder())));
                                        ruleElement.appendChild(orderElement);
                                    }
                                    
                                    if (rulesItem.getAction() != null) {
                                        Element actionElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Action");
                                        actionElement.appendChild(requestDoc.createTextNode(rulesItem.getAction()));
                                        ruleElement.appendChild(actionElement);
                                    }
                                    
                                    if (rulesItem.getRemoteSubnet() != null) {
                                        Element remoteSubnetElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "RemoteSubnet");
                                        remoteSubnetElement.appendChild(requestDoc.createTextNode(rulesItem.getRemoteSubnet()));
                                        ruleElement.appendChild(remoteSubnetElement);
                                    }
                                    
                                    if (rulesItem.getDescription() != null) {
                                        Element descriptionElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Description");
                                        descriptionElement.appendChild(requestDoc.createTextNode(rulesItem.getDescription()));
                                        ruleElement.appendChild(descriptionElement);
                                    }
                                }
                                endpointAclElement.appendChild(rulesSequenceElement);
                            }
                        }
                    }
                    configurationSetElement.appendChild(inputEndpointsSequenceElement);
                }
                
                if (configurationSetsItem.getSubnetNames() != null) {
                    Element subnetNamesSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "SubnetNames");
                    for (String subnetNamesItem : configurationSetsItem.getSubnetNames()) {
                        Element subnetNamesItemElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "SubnetName");
                        subnetNamesItemElement.appendChild(requestDoc.createTextNode(subnetNamesItem));
                        subnetNamesSequenceElement.appendChild(subnetNamesItemElement);
                    }
                    configurationSetElement.appendChild(subnetNamesSequenceElement);
                }
                
                if (configurationSetsItem.getStaticVirtualNetworkIPAddress() != null) {
                    Element staticVirtualNetworkIPAddressElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "StaticVirtualNetworkIPAddress");
                    staticVirtualNetworkIPAddressElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getStaticVirtualNetworkIPAddress()));
                    configurationSetElement.appendChild(staticVirtualNetworkIPAddressElement);
                }
                
                if (configurationSetsItem.getComputerName() != null) {
                    Element computerNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ComputerName");
                    computerNameElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getComputerName()));
                    configurationSetElement.appendChild(computerNameElement);
                }
                
                if (configurationSetsItem.getAdminPassword() != null) {
                    Element adminPasswordElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "AdminPassword");
                    adminPasswordElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getAdminPassword()));
                    configurationSetElement.appendChild(adminPasswordElement);
                }
                
                if (configurationSetsItem.isResetPasswordOnFirstLogon() != null) {
                    Element resetPasswordOnFirstLogonElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ResetPasswordOnFirstLogon");
                    resetPasswordOnFirstLogonElement.appendChild(requestDoc.createTextNode(Boolean.toString(configurationSetsItem.isResetPasswordOnFirstLogon()).toLowerCase()));
                    configurationSetElement.appendChild(resetPasswordOnFirstLogonElement);
                }
                
                if (configurationSetsItem.isEnableAutomaticUpdates() != null) {
                    Element enableAutomaticUpdatesElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "EnableAutomaticUpdates");
                    enableAutomaticUpdatesElement.appendChild(requestDoc.createTextNode(Boolean.toString(configurationSetsItem.isEnableAutomaticUpdates()).toLowerCase()));
                    configurationSetElement.appendChild(enableAutomaticUpdatesElement);
                }
                
                if (configurationSetsItem.getTimeZone() != null) {
                    Element timeZoneElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "TimeZone");
                    timeZoneElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getTimeZone()));
                    configurationSetElement.appendChild(timeZoneElement);
                }
                
                if (configurationSetsItem.getDomainJoin() != null) {
                    Element domainJoinElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DomainJoin");
                    configurationSetElement.appendChild(domainJoinElement);
                    
                    if (configurationSetsItem.getDomainJoin().getCredentials() != null) {
                        Element credentialsElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Credentials");
                        domainJoinElement.appendChild(credentialsElement);
                        
                        if (configurationSetsItem.getDomainJoin().getCredentials().getDomain() != null) {
                            Element domainElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Domain");
                            domainElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getDomainJoin().getCredentials().getDomain()));
                            credentialsElement.appendChild(domainElement);
                        }
                        
                        Element usernameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Username");
                        usernameElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getDomainJoin().getCredentials().getUserName()));
                        credentialsElement.appendChild(usernameElement);
                        
                        Element passwordElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Password");
                        passwordElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getDomainJoin().getCredentials().getPassword()));
                        credentialsElement.appendChild(passwordElement);
                    }
                    
                    if (configurationSetsItem.getDomainJoin().getDomainToJoin() != null) {
                        Element joinDomainElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "JoinDomain");
                        joinDomainElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getDomainJoin().getDomainToJoin()));
                        domainJoinElement.appendChild(joinDomainElement);
                    }
                    
                    if (configurationSetsItem.getDomainJoin().getLdapMachineObjectOU() != null) {
                        Element machineObjectOUElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "MachineObjectOU");
                        machineObjectOUElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getDomainJoin().getLdapMachineObjectOU()));
                        domainJoinElement.appendChild(machineObjectOUElement);
                    }
                    
                    if (configurationSetsItem.getDomainJoin().getProvisioning() != null) {
                        Element provisioningElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Provisioning");
                        domainJoinElement.appendChild(provisioningElement);
                        
                        if (configurationSetsItem.getDomainJoin().getProvisioning().getAccountData() != null) {
                            Element accountDataElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "AccountData");
                            accountDataElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getDomainJoin().getProvisioning().getAccountData()));
                            provisioningElement.appendChild(accountDataElement);
                        }
                    }
                }
                
                if (configurationSetsItem.getStoredCertificateSettings() != null) {
                    Element storedCertificateSettingsSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "StoredCertificateSettings");
                    for (StoredCertificateSettings storedCertificateSettingsItem : configurationSetsItem.getStoredCertificateSettings()) {
                        Element certificateSettingElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "CertificateSetting");
                        storedCertificateSettingsSequenceElement.appendChild(certificateSettingElement);
                        
                        Element storeLocationElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "StoreLocation");
                        storeLocationElement.appendChild(requestDoc.createTextNode("LocalMachine"));
                        certificateSettingElement.appendChild(storeLocationElement);
                        
                        Element storeNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "StoreName");
                        storeNameElement.appendChild(requestDoc.createTextNode(storedCertificateSettingsItem.getStoreName()));
                        certificateSettingElement.appendChild(storeNameElement);
                        
                        Element thumbprintElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Thumbprint");
                        thumbprintElement.appendChild(requestDoc.createTextNode(storedCertificateSettingsItem.getThumbprint()));
                        certificateSettingElement.appendChild(thumbprintElement);
                    }
                    configurationSetElement.appendChild(storedCertificateSettingsSequenceElement);
                }
                
                if (configurationSetsItem.getWindowsRemoteManagement() != null) {
                    Element winRMElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "WinRM");
                    configurationSetElement.appendChild(winRMElement);
                    
                    if (configurationSetsItem.getWindowsRemoteManagement().getListeners() != null) {
                        Element listenersSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Listeners");
                        for (WindowsRemoteManagementListener listenersItem : configurationSetsItem.getWindowsRemoteManagement().getListeners()) {
                            Element listenerElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Listener");
                            listenersSequenceElement.appendChild(listenerElement);
                            
                            if (listenersItem.getCertificateThumbprint() != null) {
                                Element certificateThumbprintElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "CertificateThumbprint");
                                certificateThumbprintElement.appendChild(requestDoc.createTextNode(listenersItem.getCertificateThumbprint()));
                                listenerElement.appendChild(certificateThumbprintElement);
                            }
                            
                            Element protocolElement3 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Protocol");
                            protocolElement3.appendChild(requestDoc.createTextNode(listenersItem.getListenerType().toString()));
                            listenerElement.appendChild(protocolElement3);
                        }
                        winRMElement.appendChild(listenersSequenceElement);
                    }
                }
                
                if (configurationSetsItem.getAdminUserName() != null) {
                    Element adminUsernameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "AdminUsername");
                    adminUsernameElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getAdminUserName()));
                    configurationSetElement.appendChild(adminUsernameElement);
                }
                
                if (configurationSetsItem.getHostName() != null) {
                    Element hostNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "HostName");
                    hostNameElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getHostName()));
                    configurationSetElement.appendChild(hostNameElement);
                }
                
                if (configurationSetsItem.getUserName() != null) {
                    Element userNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "UserName");
                    userNameElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getUserName()));
                    configurationSetElement.appendChild(userNameElement);
                }
                
                if (configurationSetsItem.getUserPassword() != null) {
                    Element userPasswordElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "UserPassword");
                    userPasswordElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getUserPassword()));
                    configurationSetElement.appendChild(userPasswordElement);
                }
                
                if (configurationSetsItem.isDisableSshPasswordAuthentication() != null) {
                    Element disableSshPasswordAuthenticationElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DisableSshPasswordAuthentication");
                    disableSshPasswordAuthenticationElement.appendChild(requestDoc.createTextNode(Boolean.toString(configurationSetsItem.isDisableSshPasswordAuthentication()).toLowerCase()));
                    configurationSetElement.appendChild(disableSshPasswordAuthenticationElement);
                }
                
                if (configurationSetsItem.getSshSettings() != null) {
                    Element sSHElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "SSH");
                    configurationSetElement.appendChild(sSHElement);
                    
                    if (configurationSetsItem.getSshSettings().getPublicKeys() != null) {
                        Element publicKeysSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "PublicKeys");
                        for (SshSettingPublicKey publicKeysItem : configurationSetsItem.getSshSettings().getPublicKeys()) {
                            Element publicKeyElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "PublicKey");
                            publicKeysSequenceElement.appendChild(publicKeyElement);
                            
                            Element fingerprintElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Fingerprint");
                            fingerprintElement.appendChild(requestDoc.createTextNode(publicKeysItem.getFingerprint()));
                            publicKeyElement.appendChild(fingerprintElement);
                            
                            Element pathElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Path");
                            pathElement2.appendChild(requestDoc.createTextNode(publicKeysItem.getPath()));
                            publicKeyElement.appendChild(pathElement2);
                        }
                        sSHElement.appendChild(publicKeysSequenceElement);
                    }
                    
                    if (configurationSetsItem.getSshSettings().getKeyPairs() != null) {
                        Element keyPairsSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "KeyPairs");
                        for (SshSettingKeyPair keyPairsItem : configurationSetsItem.getSshSettings().getKeyPairs()) {
                            Element keyPairElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "KeyPair");
                            keyPairsSequenceElement.appendChild(keyPairElement);
                            
                            Element fingerprintElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Fingerprint");
                            fingerprintElement2.appendChild(requestDoc.createTextNode(keyPairsItem.getFingerprint()));
                            keyPairElement.appendChild(fingerprintElement2);
                            
                            Element pathElement3 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Path");
                            pathElement3.appendChild(requestDoc.createTextNode(keyPairsItem.getPath()));
                            keyPairElement.appendChild(pathElement3);
                        }
                        sSHElement.appendChild(keyPairsSequenceElement);
                    }
                }
            }
            persistentVMRoleElement.appendChild(configurationSetsSequenceElement);
        }
        
        if (parameters.getAvailabilitySetName() != null) {
            Element availabilitySetNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "AvailabilitySetName");
            availabilitySetNameElement.appendChild(requestDoc.createTextNode(parameters.getAvailabilitySetName()));
            persistentVMRoleElement.appendChild(availabilitySetNameElement);
        }
        
        if (parameters.getResourceExtensionReferences() != null) {
            Element resourceExtensionReferencesSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ResourceExtensionReferences");
            for (ResourceExtensionReference resourceExtensionReferencesItem : parameters.getResourceExtensionReferences()) {
                Element resourceExtensionReferenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ResourceExtensionReference");
                resourceExtensionReferencesSequenceElement.appendChild(resourceExtensionReferenceElement);
                
                if (resourceExtensionReferencesItem.getReferenceName() != null) {
                    Element referenceNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ReferenceName");
                    referenceNameElement.appendChild(requestDoc.createTextNode(resourceExtensionReferencesItem.getReferenceName()));
                    resourceExtensionReferenceElement.appendChild(referenceNameElement);
                }
                
                if (resourceExtensionReferencesItem.getPublisher() != null) {
                    Element publisherElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Publisher");
                    publisherElement.appendChild(requestDoc.createTextNode(resourceExtensionReferencesItem.getPublisher()));
                    resourceExtensionReferenceElement.appendChild(publisherElement);
                }
                
                if (resourceExtensionReferencesItem.getName() != null) {
                    Element nameElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Name");
                    nameElement2.appendChild(requestDoc.createTextNode(resourceExtensionReferencesItem.getName()));
                    resourceExtensionReferenceElement.appendChild(nameElement2);
                }
                
                if (resourceExtensionReferencesItem.getVersion() != null) {
                    Element versionElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Version");
                    versionElement.appendChild(requestDoc.createTextNode(resourceExtensionReferencesItem.getVersion()));
                    resourceExtensionReferenceElement.appendChild(versionElement);
                }
                
                if (resourceExtensionReferencesItem.getResourceExtensionParameterValues() != null) {
                    Element resourceExtensionParameterValuesSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ResourceExtensionParameterValues");
                    for (ResourceExtensionParameterValue resourceExtensionParameterValuesItem : resourceExtensionReferencesItem.getResourceExtensionParameterValues()) {
                        Element resourceExtensionParameterValueElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ResourceExtensionParameterValue");
                        resourceExtensionParameterValuesSequenceElement.appendChild(resourceExtensionParameterValueElement);
                        
                        if (resourceExtensionParameterValuesItem.getKey() != null) {
                            Element keyElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Key");
                            keyElement.appendChild(requestDoc.createTextNode(resourceExtensionParameterValuesItem.getKey()));
                            resourceExtensionParameterValueElement.appendChild(keyElement);
                        }
                        
                        if (resourceExtensionParameterValuesItem.getValue() != null) {
                            Element valueElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Value");
                            valueElement.appendChild(requestDoc.createTextNode(new String(Base64.encodeBase64(resourceExtensionParameterValuesItem.getValue().getBytes()))));
                            resourceExtensionParameterValueElement.appendChild(valueElement);
                        }
                        
                        if (resourceExtensionParameterValuesItem.getType() != null) {
                            Element typeElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Type");
                            typeElement.appendChild(requestDoc.createTextNode(resourceExtensionParameterValuesItem.getType().toString()));
                            resourceExtensionParameterValueElement.appendChild(typeElement);
                        }
                    }
                    resourceExtensionReferenceElement.appendChild(resourceExtensionParameterValuesSequenceElement);
                }
                
                if (resourceExtensionReferencesItem.getState() != null) {
                    Element stateElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "State");
                    stateElement.appendChild(requestDoc.createTextNode(resourceExtensionReferencesItem.getState().toString()));
                    resourceExtensionReferenceElement.appendChild(stateElement);
                }
            }
            persistentVMRoleElement.appendChild(resourceExtensionReferencesSequenceElement);
        }
        
        if (parameters.getDataVirtualHardDisks() != null) {
            Element dataVirtualHardDisksSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DataVirtualHardDisks");
            for (DataVirtualHardDisk dataVirtualHardDisksItem : parameters.getDataVirtualHardDisks()) {
                Element dataVirtualHardDiskElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DataVirtualHardDisk");
                dataVirtualHardDisksSequenceElement.appendChild(dataVirtualHardDiskElement);
                
                if (dataVirtualHardDisksItem.getHostCaching() != null) {
                    Element hostCachingElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "HostCaching");
                    hostCachingElement.appendChild(requestDoc.createTextNode(dataVirtualHardDisksItem.getHostCaching().toString()));
                    dataVirtualHardDiskElement.appendChild(hostCachingElement);
                }
                
                if (dataVirtualHardDisksItem.getDiskLabel() != null) {
                    Element diskLabelElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DiskLabel");
                    diskLabelElement.appendChild(requestDoc.createTextNode(dataVirtualHardDisksItem.getDiskLabel()));
                    dataVirtualHardDiskElement.appendChild(diskLabelElement);
                }
                
                if (dataVirtualHardDisksItem.getDiskName() != null) {
                    Element diskNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DiskName");
                    diskNameElement.appendChild(requestDoc.createTextNode(dataVirtualHardDisksItem.getDiskName()));
                    dataVirtualHardDiskElement.appendChild(diskNameElement);
                }
                
                if (dataVirtualHardDisksItem.getLogicalUnitNumber() != null) {
                    Element lunElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Lun");
                    lunElement.appendChild(requestDoc.createTextNode(Integer.toString(dataVirtualHardDisksItem.getLogicalUnitNumber())));
                    dataVirtualHardDiskElement.appendChild(lunElement);
                }
                
                Element logicalDiskSizeInGBElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "LogicalDiskSizeInGB");
                logicalDiskSizeInGBElement.appendChild(requestDoc.createTextNode(Integer.toString(dataVirtualHardDisksItem.getLogicalDiskSizeInGB())));
                dataVirtualHardDiskElement.appendChild(logicalDiskSizeInGBElement);
                
                if (dataVirtualHardDisksItem.getMediaLink() != null) {
                    Element mediaLinkElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "MediaLink");
                    mediaLinkElement.appendChild(requestDoc.createTextNode(dataVirtualHardDisksItem.getMediaLink().toString()));
                    dataVirtualHardDiskElement.appendChild(mediaLinkElement);
                }
            }
            persistentVMRoleElement.appendChild(dataVirtualHardDisksSequenceElement);
        }
        
        if (parameters.getOSVirtualHardDisk() != null) {
            Element oSVirtualHardDiskElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "OSVirtualHardDisk");
            persistentVMRoleElement.appendChild(oSVirtualHardDiskElement);
            
            if (parameters.getOSVirtualHardDisk().getHostCaching() != null) {
                Element hostCachingElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "HostCaching");
                hostCachingElement2.appendChild(requestDoc.createTextNode(parameters.getOSVirtualHardDisk().getHostCaching().toString()));
                oSVirtualHardDiskElement.appendChild(hostCachingElement2);
            }
            
            if (parameters.getOSVirtualHardDisk().getDiskLabel() != null) {
                Element diskLabelElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DiskLabel");
                diskLabelElement2.appendChild(requestDoc.createTextNode(parameters.getOSVirtualHardDisk().getDiskLabel()));
                oSVirtualHardDiskElement.appendChild(diskLabelElement2);
            }
            
            if (parameters.getOSVirtualHardDisk().getDiskName() != null) {
                Element diskNameElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DiskName");
                diskNameElement2.appendChild(requestDoc.createTextNode(parameters.getOSVirtualHardDisk().getDiskName()));
                oSVirtualHardDiskElement.appendChild(diskNameElement2);
            }
            
            if (parameters.getOSVirtualHardDisk().getMediaLink() != null) {
                Element mediaLinkElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "MediaLink");
                mediaLinkElement2.appendChild(requestDoc.createTextNode(parameters.getOSVirtualHardDisk().getMediaLink().toString()));
                oSVirtualHardDiskElement.appendChild(mediaLinkElement2);
            }
            
            if (parameters.getOSVirtualHardDisk().getSourceImageName() != null) {
                Element sourceImageNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "SourceImageName");
                sourceImageNameElement.appendChild(requestDoc.createTextNode(parameters.getOSVirtualHardDisk().getSourceImageName()));
                oSVirtualHardDiskElement.appendChild(sourceImageNameElement);
            }
            
            if (parameters.getOSVirtualHardDisk().getOperatingSystem() != null) {
                Element osElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "OS");
                osElement.appendChild(requestDoc.createTextNode(parameters.getOSVirtualHardDisk().getOperatingSystem()));
                oSVirtualHardDiskElement.appendChild(osElement);
            }
        }
        
        if (parameters.getRoleSize() != null) {
            Element roleSizeElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "RoleSize");
            roleSizeElement.appendChild(requestDoc.createTextNode(parameters.getRoleSize()));
            persistentVMRoleElement.appendChild(roleSizeElement);
        }
        
        if (parameters.isProvisionGuestAgent() != null) {
            Element provisionGuestAgentElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ProvisionGuestAgent");
            provisionGuestAgentElement.appendChild(requestDoc.createTextNode(Boolean.toString(parameters.isProvisionGuestAgent()).toLowerCase()));
            persistentVMRoleElement.appendChild(provisionGuestAgentElement);
        }
        
        DOMSource domSource = new DOMSource(requestDoc);
        StringWriter stringWriter = new StringWriter();
        StreamResult streamResult = new StreamResult(stringWriter);
        TransformerFactory transformerFactory = TransformerFactory.newInstance();
        Transformer transformer = transformerFactory.newTransformer();
        transformer.transform(domSource, streamResult);
        requestContent = stringWriter.toString();
        StringEntity entity = new StringEntity(requestContent);
        httpRequest.setEntity(entity);
        httpRequest.setHeader("Content-Type", "application/xml");
        
        // Send Request
        HttpResponse httpResponse = null;
        try {
            if (shouldTrace) {
                CloudTracing.sendRequest(invocationId, httpRequest);
            }
            httpResponse = this.getClient().getHttpClient().execute(httpRequest);
            if (shouldTrace) {
                CloudTracing.receiveResponse(invocationId, httpResponse);
            }
            int statusCode = httpResponse.getStatusLine().getStatusCode();
            if (statusCode != HttpStatus.SC_ACCEPTED) {
                ServiceException ex = ServiceException.createFromXml(httpRequest, requestContent, httpResponse, httpResponse.getEntity());
                if (shouldTrace) {
                    CloudTracing.error(invocationId, ex);
                }
                throw ex;
            }
            
            // Create Result
            OperationResponse result = null;
            result = new OperationResponse();
            result.setStatusCode(statusCode);
            if (httpResponse.getHeaders("x-ms-request-id").length > 0) {
                result.setRequestId(httpResponse.getFirstHeader("x-ms-request-id").getValue());
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            return result;
        } finally {
            if (httpResponse != null && httpResponse.getEntity() != null) {
                httpResponse.getEntity().getContent().close();
            }
        }
    }
    
    /**
    * The Create Virtual Machine Deployment operation provisions a virtual
    * machine based on the supplied configuration.  When you create a
    * deployment of a virtual machine, you should make sure that the cloud
    * service and the disk or image that you use are located in the same
    * region. For example, if the cloud service was created in the West US
    * region, the disk or image that you use should also be located in a
    * stor4age account in the West US region.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157194.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param parameters Parameters supplied to the Create Virtual Machine
    * Deployment operation.
    * @return A standard service response including an HTTP status code and
    * request ID.
    */
    @Override
    public Future<OperationResponse> beginCreatingDeploymentAsync(final String serviceName, final VirtualMachineCreateDeploymentParameters parameters) {
        return this.getClient().getExecutorService().submit(new Callable<OperationResponse>() { 
            @Override
            public OperationResponse call() throws Exception {
                return beginCreatingDeployment(serviceName, parameters);
            }
         });
    }
    
    /**
    * The Create Virtual Machine Deployment operation provisions a virtual
    * machine based on the supplied configuration.  When you create a
    * deployment of a virtual machine, you should make sure that the cloud
    * service and the disk or image that you use are located in the same
    * region. For example, if the cloud service was created in the West US
    * region, the disk or image that you use should also be located in a
    * stor4age account in the West US region.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157194.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param parameters Parameters supplied to the Create Virtual Machine
    * Deployment operation.
    * @throws ParserConfigurationException Thrown if there was an error
    * configuring the parser for the response body.
    * @throws SAXException Thrown if there was an error parsing the response
    * body.
    * @throws TransformerException Thrown if there was an error creating the
    * DOM transformer.
    * @throws IOException Signals that an I/O exception of some sort has
    * occurred. This class is the general class of exceptions produced by
    * failed or interrupted I/O operations.
    * @throws ServiceException Thrown if an unexpected response is found.
    * @return A standard service response including an HTTP status code and
    * request ID.
    */
    @Override
    public OperationResponse beginCreatingDeployment(String serviceName, VirtualMachineCreateDeploymentParameters parameters) throws ParserConfigurationException, SAXException, TransformerException, IOException, ServiceException {
        // Validate
        if (serviceName == null) {
            throw new NullPointerException("serviceName");
        }
        if (parameters == null) {
            throw new NullPointerException("parameters");
        }
        if (parameters.getLabel() == null) {
            throw new NullPointerException("parameters.Label");
        }
        if (parameters.getLabel().length() > 100) {
            throw new IllegalArgumentException("parameters.Label");
        }
        if (parameters.getName() == null) {
            throw new NullPointerException("parameters.Name");
        }
        if (parameters.getRoles() == null) {
            throw new NullPointerException("parameters.Roles");
        }
        if (parameters.getRoles() != null) {
            for (Role rolesParameterItem : parameters.getRoles()) {
                if (rolesParameterItem.getConfigurationSets() != null) {
                    for (ConfigurationSet configurationSetsParameterItem : rolesParameterItem.getConfigurationSets()) {
                        if (configurationSetsParameterItem.getDomainJoin() != null) {
                            if (configurationSetsParameterItem.getDomainJoin().getCredentials() != null) {
                                if (configurationSetsParameterItem.getDomainJoin().getCredentials().getPassword() == null) {
                                    throw new NullPointerException("parameters.Roles.ConfigurationSets.DomainJoin.Credentials.Password");
                                }
                                if (configurationSetsParameterItem.getDomainJoin().getCredentials().getUserName() == null) {
                                    throw new NullPointerException("parameters.Roles.ConfigurationSets.DomainJoin.Credentials.UserName");
                                }
                            }
                        }
                        if (configurationSetsParameterItem.getHostName() != null && configurationSetsParameterItem.getHostName().length() < 1) {
                            throw new IllegalArgumentException("parameters.Roles.ConfigurationSets.HostName");
                        }
                        if (configurationSetsParameterItem.getHostName() != null && configurationSetsParameterItem.getHostName().length() > 64) {
                            throw new IllegalArgumentException("parameters.Roles.ConfigurationSets.HostName");
                        }
                        if (configurationSetsParameterItem.getSshSettings() != null) {
                            if (configurationSetsParameterItem.getSshSettings().getKeyPairs() != null) {
                                for (SshSettingKeyPair keyPairsParameterItem : configurationSetsParameterItem.getSshSettings().getKeyPairs()) {
                                    if (keyPairsParameterItem.getFingerprint() == null) {
                                        throw new NullPointerException("parameters.Roles.ConfigurationSets.SshSettings.KeyPairs.Fingerprint");
                                    }
                                    if (keyPairsParameterItem.getPath() == null) {
                                        throw new NullPointerException("parameters.Roles.ConfigurationSets.SshSettings.KeyPairs.Path");
                                    }
                                }
                            }
                            if (configurationSetsParameterItem.getSshSettings().getPublicKeys() != null) {
                                for (SshSettingPublicKey publicKeysParameterItem : configurationSetsParameterItem.getSshSettings().getPublicKeys()) {
                                    if (publicKeysParameterItem.getFingerprint() == null) {
                                        throw new NullPointerException("parameters.Roles.ConfigurationSets.SshSettings.PublicKeys.Fingerprint");
                                    }
                                    if (publicKeysParameterItem.getPath() == null) {
                                        throw new NullPointerException("parameters.Roles.ConfigurationSets.SshSettings.PublicKeys.Path");
                                    }
                                }
                            }
                        }
                        if (configurationSetsParameterItem.getStoredCertificateSettings() != null) {
                            for (StoredCertificateSettings storedCertificateSettingsParameterItem : configurationSetsParameterItem.getStoredCertificateSettings()) {
                                if (storedCertificateSettingsParameterItem.getStoreName() == null) {
                                    throw new NullPointerException("parameters.Roles.ConfigurationSets.StoredCertificateSettings.StoreName");
                                }
                                if (storedCertificateSettingsParameterItem.getThumbprint() == null) {
                                    throw new NullPointerException("parameters.Roles.ConfigurationSets.StoredCertificateSettings.Thumbprint");
                                }
                            }
                        }
                        if (configurationSetsParameterItem.getUserName() != null && configurationSetsParameterItem.getUserName().length() < 1) {
                            throw new IllegalArgumentException("parameters.Roles.ConfigurationSets.UserName");
                        }
                        if (configurationSetsParameterItem.getUserName() != null && configurationSetsParameterItem.getUserName().length() > 32) {
                            throw new IllegalArgumentException("parameters.Roles.ConfigurationSets.UserName");
                        }
                        if (configurationSetsParameterItem.getUserPassword() != null && configurationSetsParameterItem.getUserPassword().length() < 6 && (configurationSetsParameterItem.isDisableSshPasswordAuthentication() == false || configurationSetsParameterItem.getUserPassword().length() != 0)) {
                            throw new IllegalArgumentException("parameters.Roles.ConfigurationSets.UserPassword");
                        }
                        if (configurationSetsParameterItem.getUserPassword() != null && configurationSetsParameterItem.getUserPassword().length() > 72) {
                            throw new IllegalArgumentException("parameters.Roles.ConfigurationSets.UserPassword");
                        }
                    }
                }
            }
        }
        
        // Tracing
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("parameters", parameters);
            CloudTracing.enter(invocationId, this, "beginCreatingDeploymentAsync", tracingParameters);
        }
        
        // Construct URL
        String url = this.getClient().getBaseUri() + "/" + this.getClient().getCredentials().getSubscriptionId() + "/services/hostedservices/" + serviceName + "/deployments";
        
        // Create HTTP transport objects
        HttpPost httpRequest = new HttpPost(url);
        
        // Set Headers
        httpRequest.setHeader("Content-Type", "application/xml");
        httpRequest.setHeader("x-ms-version", "2013-11-01");
        
        // Serialize Request
        String requestContent = null;
        DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();
        DocumentBuilder documentBuilder = documentBuilderFactory.newDocumentBuilder();
        Document requestDoc = documentBuilder.newDocument();
        
        Element deploymentElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Deployment");
        requestDoc.appendChild(deploymentElement);
        
        Element nameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Name");
        nameElement.appendChild(requestDoc.createTextNode(parameters.getName()));
        deploymentElement.appendChild(nameElement);
        
        Element deploymentSlotElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DeploymentSlot");
        deploymentSlotElement.appendChild(requestDoc.createTextNode(parameters.getDeploymentSlot().toString()));
        deploymentElement.appendChild(deploymentSlotElement);
        
        Element labelElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Label");
        labelElement.appendChild(requestDoc.createTextNode(new String(Base64.encodeBase64(parameters.getLabel().getBytes()))));
        deploymentElement.appendChild(labelElement);
        
        Element roleListSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "RoleList");
        for (Role roleListItem : parameters.getRoles()) {
            Element roleElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Role");
            roleListSequenceElement.appendChild(roleElement);
            
            if (roleListItem.getRoleName() != null) {
                Element roleNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "RoleName");
                roleNameElement.appendChild(requestDoc.createTextNode(roleListItem.getRoleName()));
                roleElement.appendChild(roleNameElement);
            }
            
            if (roleListItem.getOSVersion() != null) {
                Element osVersionElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "OsVersion");
                osVersionElement.appendChild(requestDoc.createTextNode(roleListItem.getOSVersion()));
                roleElement.appendChild(osVersionElement);
            }
            
            if (roleListItem.getRoleType() != null) {
                Element roleTypeElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "RoleType");
                roleTypeElement.appendChild(requestDoc.createTextNode(roleListItem.getRoleType()));
                roleElement.appendChild(roleTypeElement);
            }
            
            if (roleListItem.getConfigurationSets() != null) {
                Element configurationSetsSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ConfigurationSets");
                for (ConfigurationSet configurationSetsItem : roleListItem.getConfigurationSets()) {
                    Element configurationSetElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ConfigurationSet");
                    configurationSetsSequenceElement.appendChild(configurationSetElement);
                    
                    if (configurationSetsItem.getConfigurationSetType() != null) {
                        Element configurationSetTypeElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ConfigurationSetType");
                        configurationSetTypeElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getConfigurationSetType()));
                        configurationSetElement.appendChild(configurationSetTypeElement);
                    }
                    
                    if (configurationSetsItem.getInputEndpoints() != null) {
                        Element inputEndpointsSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "InputEndpoints");
                        for (InputEndpoint inputEndpointsItem : configurationSetsItem.getInputEndpoints()) {
                            Element inputEndpointElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "InputEndpoint");
                            inputEndpointsSequenceElement.appendChild(inputEndpointElement);
                            
                            if (inputEndpointsItem.getLoadBalancedEndpointSetName() != null) {
                                Element loadBalancedEndpointSetNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "LoadBalancedEndpointSetName");
                                loadBalancedEndpointSetNameElement.appendChild(requestDoc.createTextNode(inputEndpointsItem.getLoadBalancedEndpointSetName()));
                                inputEndpointElement.appendChild(loadBalancedEndpointSetNameElement);
                            }
                            
                            if (inputEndpointsItem.getLocalPort() != null) {
                                Element localPortElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "LocalPort");
                                localPortElement.appendChild(requestDoc.createTextNode(Integer.toString(inputEndpointsItem.getLocalPort())));
                                inputEndpointElement.appendChild(localPortElement);
                            }
                            
                            if (inputEndpointsItem.getName() != null) {
                                Element nameElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Name");
                                nameElement2.appendChild(requestDoc.createTextNode(inputEndpointsItem.getName()));
                                inputEndpointElement.appendChild(nameElement2);
                            }
                            
                            if (inputEndpointsItem.getPort() != null) {
                                Element portElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Port");
                                portElement.appendChild(requestDoc.createTextNode(Integer.toString(inputEndpointsItem.getPort())));
                                inputEndpointElement.appendChild(portElement);
                            }
                            
                            if (inputEndpointsItem.getLoadBalancerProbe() != null) {
                                Element loadBalancerProbeElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "LoadBalancerProbe");
                                inputEndpointElement.appendChild(loadBalancerProbeElement);
                                
                                if (inputEndpointsItem.getLoadBalancerProbe().getPath() != null) {
                                    Element pathElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Path");
                                    pathElement.appendChild(requestDoc.createTextNode(inputEndpointsItem.getLoadBalancerProbe().getPath()));
                                    loadBalancerProbeElement.appendChild(pathElement);
                                }
                                
                                Element portElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Port");
                                portElement2.appendChild(requestDoc.createTextNode(Integer.toString(inputEndpointsItem.getLoadBalancerProbe().getPort())));
                                loadBalancerProbeElement.appendChild(portElement2);
                                
                                Element protocolElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Protocol");
                                protocolElement.appendChild(requestDoc.createTextNode(ComputeManagementClientImpl.loadBalancerProbeTransportProtocolToString(inputEndpointsItem.getLoadBalancerProbe().getProtocol())));
                                loadBalancerProbeElement.appendChild(protocolElement);
                                
                                if (inputEndpointsItem.getLoadBalancerProbe().getIntervalInSeconds() != null) {
                                    Element intervalInSecondsElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "IntervalInSeconds");
                                    intervalInSecondsElement.appendChild(requestDoc.createTextNode(Integer.toString(inputEndpointsItem.getLoadBalancerProbe().getIntervalInSeconds())));
                                    loadBalancerProbeElement.appendChild(intervalInSecondsElement);
                                }
                                
                                if (inputEndpointsItem.getLoadBalancerProbe().getTimeoutInSeconds() != null) {
                                    Element timeoutInSecondsElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "TimeoutInSeconds");
                                    timeoutInSecondsElement.appendChild(requestDoc.createTextNode(Integer.toString(inputEndpointsItem.getLoadBalancerProbe().getTimeoutInSeconds())));
                                    loadBalancerProbeElement.appendChild(timeoutInSecondsElement);
                                }
                            }
                            
                            if (inputEndpointsItem.getProtocol() != null) {
                                Element protocolElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Protocol");
                                protocolElement2.appendChild(requestDoc.createTextNode(inputEndpointsItem.getProtocol()));
                                inputEndpointElement.appendChild(protocolElement2);
                            }
                            
                            if (inputEndpointsItem.getVirtualIPAddress() != null) {
                                Element vipElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Vip");
                                vipElement.appendChild(requestDoc.createTextNode(inputEndpointsItem.getVirtualIPAddress().getHostAddress()));
                                inputEndpointElement.appendChild(vipElement);
                            }
                            
                            if (inputEndpointsItem.isEnableDirectServerReturn() != null) {
                                Element enableDirectServerReturnElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "EnableDirectServerReturn");
                                enableDirectServerReturnElement.appendChild(requestDoc.createTextNode(Boolean.toString(inputEndpointsItem.isEnableDirectServerReturn()).toLowerCase()));
                                inputEndpointElement.appendChild(enableDirectServerReturnElement);
                            }
                            
                            if (inputEndpointsItem.getEndpointAcl() != null) {
                                Element endpointAclElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "EndpointAcl");
                                inputEndpointElement.appendChild(endpointAclElement);
                                
                                if (inputEndpointsItem.getEndpointAcl().getRules() != null) {
                                    Element rulesSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Rules");
                                    for (AccessControlListRule rulesItem : inputEndpointsItem.getEndpointAcl().getRules()) {
                                        Element ruleElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Rule");
                                        rulesSequenceElement.appendChild(ruleElement);
                                        
                                        if (rulesItem.getOrder() != null) {
                                            Element orderElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Order");
                                            orderElement.appendChild(requestDoc.createTextNode(Integer.toString(rulesItem.getOrder())));
                                            ruleElement.appendChild(orderElement);
                                        }
                                        
                                        if (rulesItem.getAction() != null) {
                                            Element actionElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Action");
                                            actionElement.appendChild(requestDoc.createTextNode(rulesItem.getAction()));
                                            ruleElement.appendChild(actionElement);
                                        }
                                        
                                        if (rulesItem.getRemoteSubnet() != null) {
                                            Element remoteSubnetElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "RemoteSubnet");
                                            remoteSubnetElement.appendChild(requestDoc.createTextNode(rulesItem.getRemoteSubnet()));
                                            ruleElement.appendChild(remoteSubnetElement);
                                        }
                                        
                                        if (rulesItem.getDescription() != null) {
                                            Element descriptionElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Description");
                                            descriptionElement.appendChild(requestDoc.createTextNode(rulesItem.getDescription()));
                                            ruleElement.appendChild(descriptionElement);
                                        }
                                    }
                                    endpointAclElement.appendChild(rulesSequenceElement);
                                }
                            }
                        }
                        configurationSetElement.appendChild(inputEndpointsSequenceElement);
                    }
                    
                    if (configurationSetsItem.getSubnetNames() != null) {
                        Element subnetNamesSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "SubnetNames");
                        for (String subnetNamesItem : configurationSetsItem.getSubnetNames()) {
                            Element subnetNamesItemElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "SubnetName");
                            subnetNamesItemElement.appendChild(requestDoc.createTextNode(subnetNamesItem));
                            subnetNamesSequenceElement.appendChild(subnetNamesItemElement);
                        }
                        configurationSetElement.appendChild(subnetNamesSequenceElement);
                    }
                    
                    if (configurationSetsItem.getStaticVirtualNetworkIPAddress() != null) {
                        Element staticVirtualNetworkIPAddressElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "StaticVirtualNetworkIPAddress");
                        staticVirtualNetworkIPAddressElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getStaticVirtualNetworkIPAddress()));
                        configurationSetElement.appendChild(staticVirtualNetworkIPAddressElement);
                    }
                    
                    if (configurationSetsItem.getComputerName() != null) {
                        Element computerNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ComputerName");
                        computerNameElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getComputerName()));
                        configurationSetElement.appendChild(computerNameElement);
                    }
                    
                    if (configurationSetsItem.getAdminPassword() != null) {
                        Element adminPasswordElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "AdminPassword");
                        adminPasswordElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getAdminPassword()));
                        configurationSetElement.appendChild(adminPasswordElement);
                    }
                    
                    if (configurationSetsItem.isResetPasswordOnFirstLogon() != null) {
                        Element resetPasswordOnFirstLogonElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ResetPasswordOnFirstLogon");
                        resetPasswordOnFirstLogonElement.appendChild(requestDoc.createTextNode(Boolean.toString(configurationSetsItem.isResetPasswordOnFirstLogon()).toLowerCase()));
                        configurationSetElement.appendChild(resetPasswordOnFirstLogonElement);
                    }
                    
                    if (configurationSetsItem.isEnableAutomaticUpdates() != null) {
                        Element enableAutomaticUpdatesElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "EnableAutomaticUpdates");
                        enableAutomaticUpdatesElement.appendChild(requestDoc.createTextNode(Boolean.toString(configurationSetsItem.isEnableAutomaticUpdates()).toLowerCase()));
                        configurationSetElement.appendChild(enableAutomaticUpdatesElement);
                    }
                    
                    if (configurationSetsItem.getTimeZone() != null) {
                        Element timeZoneElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "TimeZone");
                        timeZoneElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getTimeZone()));
                        configurationSetElement.appendChild(timeZoneElement);
                    }
                    
                    if (configurationSetsItem.getDomainJoin() != null) {
                        Element domainJoinElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DomainJoin");
                        configurationSetElement.appendChild(domainJoinElement);
                        
                        if (configurationSetsItem.getDomainJoin().getCredentials() != null) {
                            Element credentialsElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Credentials");
                            domainJoinElement.appendChild(credentialsElement);
                            
                            if (configurationSetsItem.getDomainJoin().getCredentials().getDomain() != null) {
                                Element domainElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Domain");
                                domainElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getDomainJoin().getCredentials().getDomain()));
                                credentialsElement.appendChild(domainElement);
                            }
                            
                            Element usernameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Username");
                            usernameElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getDomainJoin().getCredentials().getUserName()));
                            credentialsElement.appendChild(usernameElement);
                            
                            Element passwordElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Password");
                            passwordElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getDomainJoin().getCredentials().getPassword()));
                            credentialsElement.appendChild(passwordElement);
                        }
                        
                        if (configurationSetsItem.getDomainJoin().getDomainToJoin() != null) {
                            Element joinDomainElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "JoinDomain");
                            joinDomainElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getDomainJoin().getDomainToJoin()));
                            domainJoinElement.appendChild(joinDomainElement);
                        }
                        
                        if (configurationSetsItem.getDomainJoin().getLdapMachineObjectOU() != null) {
                            Element machineObjectOUElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "MachineObjectOU");
                            machineObjectOUElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getDomainJoin().getLdapMachineObjectOU()));
                            domainJoinElement.appendChild(machineObjectOUElement);
                        }
                        
                        if (configurationSetsItem.getDomainJoin().getProvisioning() != null) {
                            Element provisioningElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Provisioning");
                            domainJoinElement.appendChild(provisioningElement);
                            
                            if (configurationSetsItem.getDomainJoin().getProvisioning().getAccountData() != null) {
                                Element accountDataElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "AccountData");
                                accountDataElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getDomainJoin().getProvisioning().getAccountData()));
                                provisioningElement.appendChild(accountDataElement);
                            }
                        }
                    }
                    
                    if (configurationSetsItem.getStoredCertificateSettings() != null) {
                        Element storedCertificateSettingsSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "StoredCertificateSettings");
                        for (StoredCertificateSettings storedCertificateSettingsItem : configurationSetsItem.getStoredCertificateSettings()) {
                            Element certificateSettingElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "CertificateSetting");
                            storedCertificateSettingsSequenceElement.appendChild(certificateSettingElement);
                            
                            Element storeLocationElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "StoreLocation");
                            storeLocationElement.appendChild(requestDoc.createTextNode("LocalMachine"));
                            certificateSettingElement.appendChild(storeLocationElement);
                            
                            Element storeNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "StoreName");
                            storeNameElement.appendChild(requestDoc.createTextNode(storedCertificateSettingsItem.getStoreName()));
                            certificateSettingElement.appendChild(storeNameElement);
                            
                            Element thumbprintElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Thumbprint");
                            thumbprintElement.appendChild(requestDoc.createTextNode(storedCertificateSettingsItem.getThumbprint()));
                            certificateSettingElement.appendChild(thumbprintElement);
                        }
                        configurationSetElement.appendChild(storedCertificateSettingsSequenceElement);
                    }
                    
                    if (configurationSetsItem.getWindowsRemoteManagement() != null) {
                        Element winRMElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "WinRM");
                        configurationSetElement.appendChild(winRMElement);
                        
                        if (configurationSetsItem.getWindowsRemoteManagement().getListeners() != null) {
                            Element listenersSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Listeners");
                            for (WindowsRemoteManagementListener listenersItem : configurationSetsItem.getWindowsRemoteManagement().getListeners()) {
                                Element listenerElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Listener");
                                listenersSequenceElement.appendChild(listenerElement);
                                
                                if (listenersItem.getCertificateThumbprint() != null) {
                                    Element certificateThumbprintElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "CertificateThumbprint");
                                    certificateThumbprintElement.appendChild(requestDoc.createTextNode(listenersItem.getCertificateThumbprint()));
                                    listenerElement.appendChild(certificateThumbprintElement);
                                }
                                
                                Element protocolElement3 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Protocol");
                                protocolElement3.appendChild(requestDoc.createTextNode(listenersItem.getListenerType().toString()));
                                listenerElement.appendChild(protocolElement3);
                            }
                            winRMElement.appendChild(listenersSequenceElement);
                        }
                    }
                    
                    if (configurationSetsItem.getAdminUserName() != null) {
                        Element adminUsernameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "AdminUsername");
                        adminUsernameElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getAdminUserName()));
                        configurationSetElement.appendChild(adminUsernameElement);
                    }
                    
                    if (configurationSetsItem.getHostName() != null) {
                        Element hostNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "HostName");
                        hostNameElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getHostName()));
                        configurationSetElement.appendChild(hostNameElement);
                    }
                    
                    if (configurationSetsItem.getUserName() != null) {
                        Element userNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "UserName");
                        userNameElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getUserName()));
                        configurationSetElement.appendChild(userNameElement);
                    }
                    
                    if (configurationSetsItem.getUserPassword() != null) {
                        Element userPasswordElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "UserPassword");
                        userPasswordElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getUserPassword()));
                        configurationSetElement.appendChild(userPasswordElement);
                    }
                    
                    if (configurationSetsItem.isDisableSshPasswordAuthentication() != null) {
                        Element disableSshPasswordAuthenticationElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DisableSshPasswordAuthentication");
                        disableSshPasswordAuthenticationElement.appendChild(requestDoc.createTextNode(Boolean.toString(configurationSetsItem.isDisableSshPasswordAuthentication()).toLowerCase()));
                        configurationSetElement.appendChild(disableSshPasswordAuthenticationElement);
                    }
                    
                    if (configurationSetsItem.getSshSettings() != null) {
                        Element sSHElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "SSH");
                        configurationSetElement.appendChild(sSHElement);
                        
                        if (configurationSetsItem.getSshSettings().getPublicKeys() != null) {
                            Element publicKeysSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "PublicKeys");
                            for (SshSettingPublicKey publicKeysItem : configurationSetsItem.getSshSettings().getPublicKeys()) {
                                Element publicKeyElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "PublicKey");
                                publicKeysSequenceElement.appendChild(publicKeyElement);
                                
                                Element fingerprintElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Fingerprint");
                                fingerprintElement.appendChild(requestDoc.createTextNode(publicKeysItem.getFingerprint()));
                                publicKeyElement.appendChild(fingerprintElement);
                                
                                Element pathElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Path");
                                pathElement2.appendChild(requestDoc.createTextNode(publicKeysItem.getPath()));
                                publicKeyElement.appendChild(pathElement2);
                            }
                            sSHElement.appendChild(publicKeysSequenceElement);
                        }
                        
                        if (configurationSetsItem.getSshSettings().getKeyPairs() != null) {
                            Element keyPairsSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "KeyPairs");
                            for (SshSettingKeyPair keyPairsItem : configurationSetsItem.getSshSettings().getKeyPairs()) {
                                Element keyPairElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "KeyPair");
                                keyPairsSequenceElement.appendChild(keyPairElement);
                                
                                Element fingerprintElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Fingerprint");
                                fingerprintElement2.appendChild(requestDoc.createTextNode(keyPairsItem.getFingerprint()));
                                keyPairElement.appendChild(fingerprintElement2);
                                
                                Element pathElement3 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Path");
                                pathElement3.appendChild(requestDoc.createTextNode(keyPairsItem.getPath()));
                                keyPairElement.appendChild(pathElement3);
                            }
                            sSHElement.appendChild(keyPairsSequenceElement);
                        }
                    }
                }
                roleElement.appendChild(configurationSetsSequenceElement);
            }
            
            if (roleListItem.getResourceExtensionReferences() != null) {
                Element resourceExtensionReferencesSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ResourceExtensionReferences");
                for (ResourceExtensionReference resourceExtensionReferencesItem : roleListItem.getResourceExtensionReferences()) {
                    Element resourceExtensionReferenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ResourceExtensionReference");
                    resourceExtensionReferencesSequenceElement.appendChild(resourceExtensionReferenceElement);
                    
                    if (resourceExtensionReferencesItem.getReferenceName() != null) {
                        Element referenceNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ReferenceName");
                        referenceNameElement.appendChild(requestDoc.createTextNode(resourceExtensionReferencesItem.getReferenceName()));
                        resourceExtensionReferenceElement.appendChild(referenceNameElement);
                    }
                    
                    if (resourceExtensionReferencesItem.getPublisher() != null) {
                        Element publisherElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Publisher");
                        publisherElement.appendChild(requestDoc.createTextNode(resourceExtensionReferencesItem.getPublisher()));
                        resourceExtensionReferenceElement.appendChild(publisherElement);
                    }
                    
                    if (resourceExtensionReferencesItem.getName() != null) {
                        Element nameElement3 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Name");
                        nameElement3.appendChild(requestDoc.createTextNode(resourceExtensionReferencesItem.getName()));
                        resourceExtensionReferenceElement.appendChild(nameElement3);
                    }
                    
                    if (resourceExtensionReferencesItem.getVersion() != null) {
                        Element versionElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Version");
                        versionElement.appendChild(requestDoc.createTextNode(resourceExtensionReferencesItem.getVersion()));
                        resourceExtensionReferenceElement.appendChild(versionElement);
                    }
                    
                    if (resourceExtensionReferencesItem.getResourceExtensionParameterValues() != null) {
                        Element resourceExtensionParameterValuesSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ResourceExtensionParameterValues");
                        for (ResourceExtensionParameterValue resourceExtensionParameterValuesItem : resourceExtensionReferencesItem.getResourceExtensionParameterValues()) {
                            Element resourceExtensionParameterValueElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ResourceExtensionParameterValue");
                            resourceExtensionParameterValuesSequenceElement.appendChild(resourceExtensionParameterValueElement);
                            
                            if (resourceExtensionParameterValuesItem.getKey() != null) {
                                Element keyElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Key");
                                keyElement.appendChild(requestDoc.createTextNode(resourceExtensionParameterValuesItem.getKey()));
                                resourceExtensionParameterValueElement.appendChild(keyElement);
                            }
                            
                            if (resourceExtensionParameterValuesItem.getValue() != null) {
                                Element valueElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Value");
                                valueElement.appendChild(requestDoc.createTextNode(new String(Base64.encodeBase64(resourceExtensionParameterValuesItem.getValue().getBytes()))));
                                resourceExtensionParameterValueElement.appendChild(valueElement);
                            }
                            
                            if (resourceExtensionParameterValuesItem.getType() != null) {
                                Element typeElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Type");
                                typeElement.appendChild(requestDoc.createTextNode(resourceExtensionParameterValuesItem.getType().toString()));
                                resourceExtensionParameterValueElement.appendChild(typeElement);
                            }
                        }
                        resourceExtensionReferenceElement.appendChild(resourceExtensionParameterValuesSequenceElement);
                    }
                    
                    if (resourceExtensionReferencesItem.getState() != null) {
                        Element stateElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "State");
                        stateElement.appendChild(requestDoc.createTextNode(resourceExtensionReferencesItem.getState().toString()));
                        resourceExtensionReferenceElement.appendChild(stateElement);
                    }
                }
                roleElement.appendChild(resourceExtensionReferencesSequenceElement);
            }
            
            if (roleListItem.getAvailabilitySetName() != null) {
                Element availabilitySetNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "AvailabilitySetName");
                availabilitySetNameElement.appendChild(requestDoc.createTextNode(roleListItem.getAvailabilitySetName()));
                roleElement.appendChild(availabilitySetNameElement);
            }
            
            if (roleListItem.getDataVirtualHardDisks() != null) {
                Element dataVirtualHardDisksSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DataVirtualHardDisks");
                for (DataVirtualHardDisk dataVirtualHardDisksItem : roleListItem.getDataVirtualHardDisks()) {
                    Element dataVirtualHardDiskElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DataVirtualHardDisk");
                    dataVirtualHardDisksSequenceElement.appendChild(dataVirtualHardDiskElement);
                    
                    if (dataVirtualHardDisksItem.getHostCaching() != null) {
                        Element hostCachingElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "HostCaching");
                        hostCachingElement.appendChild(requestDoc.createTextNode(dataVirtualHardDisksItem.getHostCaching().toString()));
                        dataVirtualHardDiskElement.appendChild(hostCachingElement);
                    }
                    
                    if (dataVirtualHardDisksItem.getDiskLabel() != null) {
                        Element diskLabelElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DiskLabel");
                        diskLabelElement.appendChild(requestDoc.createTextNode(dataVirtualHardDisksItem.getDiskLabel()));
                        dataVirtualHardDiskElement.appendChild(diskLabelElement);
                    }
                    
                    if (dataVirtualHardDisksItem.getDiskName() != null) {
                        Element diskNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DiskName");
                        diskNameElement.appendChild(requestDoc.createTextNode(dataVirtualHardDisksItem.getDiskName()));
                        dataVirtualHardDiskElement.appendChild(diskNameElement);
                    }
                    
                    if (dataVirtualHardDisksItem.getLogicalUnitNumber() != null) {
                        Element lunElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Lun");
                        lunElement.appendChild(requestDoc.createTextNode(Integer.toString(dataVirtualHardDisksItem.getLogicalUnitNumber())));
                        dataVirtualHardDiskElement.appendChild(lunElement);
                    }
                    
                    Element logicalDiskSizeInGBElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "LogicalDiskSizeInGB");
                    logicalDiskSizeInGBElement.appendChild(requestDoc.createTextNode(Integer.toString(dataVirtualHardDisksItem.getLogicalDiskSizeInGB())));
                    dataVirtualHardDiskElement.appendChild(logicalDiskSizeInGBElement);
                    
                    if (dataVirtualHardDisksItem.getMediaLink() != null) {
                        Element mediaLinkElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "MediaLink");
                        mediaLinkElement.appendChild(requestDoc.createTextNode(dataVirtualHardDisksItem.getMediaLink().toString()));
                        dataVirtualHardDiskElement.appendChild(mediaLinkElement);
                    }
                }
                roleElement.appendChild(dataVirtualHardDisksSequenceElement);
            }
            
            if (roleListItem.getLabel() != null) {
                Element labelElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Label");
                labelElement2.appendChild(requestDoc.createTextNode(roleListItem.getLabel()));
                roleElement.appendChild(labelElement2);
            }
            
            if (roleListItem.getOSVirtualHardDisk() != null) {
                Element oSVirtualHardDiskElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "OSVirtualHardDisk");
                roleElement.appendChild(oSVirtualHardDiskElement);
                
                if (roleListItem.getOSVirtualHardDisk().getHostCaching() != null) {
                    Element hostCachingElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "HostCaching");
                    hostCachingElement2.appendChild(requestDoc.createTextNode(roleListItem.getOSVirtualHardDisk().getHostCaching().toString()));
                    oSVirtualHardDiskElement.appendChild(hostCachingElement2);
                }
                
                if (roleListItem.getOSVirtualHardDisk().getDiskLabel() != null) {
                    Element diskLabelElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DiskLabel");
                    diskLabelElement2.appendChild(requestDoc.createTextNode(roleListItem.getOSVirtualHardDisk().getDiskLabel()));
                    oSVirtualHardDiskElement.appendChild(diskLabelElement2);
                }
                
                if (roleListItem.getOSVirtualHardDisk().getDiskName() != null) {
                    Element diskNameElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DiskName");
                    diskNameElement2.appendChild(requestDoc.createTextNode(roleListItem.getOSVirtualHardDisk().getDiskName()));
                    oSVirtualHardDiskElement.appendChild(diskNameElement2);
                }
                
                if (roleListItem.getOSVirtualHardDisk().getMediaLink() != null) {
                    Element mediaLinkElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "MediaLink");
                    mediaLinkElement2.appendChild(requestDoc.createTextNode(roleListItem.getOSVirtualHardDisk().getMediaLink().toString()));
                    oSVirtualHardDiskElement.appendChild(mediaLinkElement2);
                }
                
                if (roleListItem.getOSVirtualHardDisk().getSourceImageName() != null) {
                    Element sourceImageNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "SourceImageName");
                    sourceImageNameElement.appendChild(requestDoc.createTextNode(roleListItem.getOSVirtualHardDisk().getSourceImageName()));
                    oSVirtualHardDiskElement.appendChild(sourceImageNameElement);
                }
                
                if (roleListItem.getOSVirtualHardDisk().getOperatingSystem() != null) {
                    Element osElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "OS");
                    osElement.appendChild(requestDoc.createTextNode(roleListItem.getOSVirtualHardDisk().getOperatingSystem()));
                    oSVirtualHardDiskElement.appendChild(osElement);
                }
            }
            
            if (roleListItem.getRoleSize() != null) {
                Element roleSizeElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "RoleSize");
                roleSizeElement.appendChild(requestDoc.createTextNode(roleListItem.getRoleSize()));
                roleElement.appendChild(roleSizeElement);
            }
            
            if (roleListItem.isProvisionGuestAgent() != null) {
                Element provisionGuestAgentElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ProvisionGuestAgent");
                provisionGuestAgentElement.appendChild(requestDoc.createTextNode(Boolean.toString(roleListItem.isProvisionGuestAgent()).toLowerCase()));
                roleElement.appendChild(provisionGuestAgentElement);
            }
            
            if (roleListItem.getDefaultWinRmCertificateThumbprint() != null) {
                Element defaultWinRmCertificateThumbprintElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DefaultWinRmCertificateThumbprint");
                defaultWinRmCertificateThumbprintElement.appendChild(requestDoc.createTextNode(roleListItem.getDefaultWinRmCertificateThumbprint()));
                roleElement.appendChild(defaultWinRmCertificateThumbprintElement);
            }
        }
        deploymentElement.appendChild(roleListSequenceElement);
        
        if (parameters.getVirtualNetworkName() != null) {
            Element virtualNetworkNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "VirtualNetworkName");
            virtualNetworkNameElement.appendChild(requestDoc.createTextNode(parameters.getVirtualNetworkName()));
            deploymentElement.appendChild(virtualNetworkNameElement);
        }
        
        if (parameters.getDnsSettings() != null) {
            Element dnsElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Dns");
            deploymentElement.appendChild(dnsElement);
            
            if (parameters.getDnsSettings().getDnsServers() != null) {
                Element dnsServersSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DnsServers");
                for (DnsServer dnsServersItem : parameters.getDnsSettings().getDnsServers()) {
                    Element dnsServerElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DnsServer");
                    dnsServersSequenceElement.appendChild(dnsServerElement);
                    
                    if (dnsServersItem.getName() != null) {
                        Element nameElement4 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Name");
                        nameElement4.appendChild(requestDoc.createTextNode(dnsServersItem.getName()));
                        dnsServerElement.appendChild(nameElement4);
                    }
                    
                    if (dnsServersItem.getAddress() != null) {
                        Element addressElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Address");
                        addressElement.appendChild(requestDoc.createTextNode(dnsServersItem.getAddress().getHostAddress()));
                        dnsServerElement.appendChild(addressElement);
                    }
                }
                dnsElement.appendChild(dnsServersSequenceElement);
            }
        }
        
        if (parameters.getReservedIPName() != null) {
            Element reservedIPNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ReservedIPName");
            reservedIPNameElement.appendChild(requestDoc.createTextNode(parameters.getReservedIPName()));
            deploymentElement.appendChild(reservedIPNameElement);
        }
        
        DOMSource domSource = new DOMSource(requestDoc);
        StringWriter stringWriter = new StringWriter();
        StreamResult streamResult = new StreamResult(stringWriter);
        TransformerFactory transformerFactory = TransformerFactory.newInstance();
        Transformer transformer = transformerFactory.newTransformer();
        transformer.transform(domSource, streamResult);
        requestContent = stringWriter.toString();
        StringEntity entity = new StringEntity(requestContent);
        httpRequest.setEntity(entity);
        httpRequest.setHeader("Content-Type", "application/xml");
        
        // Send Request
        HttpResponse httpResponse = null;
        try {
            if (shouldTrace) {
                CloudTracing.sendRequest(invocationId, httpRequest);
            }
            httpResponse = this.getClient().getHttpClient().execute(httpRequest);
            if (shouldTrace) {
                CloudTracing.receiveResponse(invocationId, httpResponse);
            }
            int statusCode = httpResponse.getStatusLine().getStatusCode();
            if (statusCode != HttpStatus.SC_ACCEPTED) {
                ServiceException ex = ServiceException.createFromXml(httpRequest, requestContent, httpResponse, httpResponse.getEntity());
                if (shouldTrace) {
                    CloudTracing.error(invocationId, ex);
                }
                throw ex;
            }
            
            // Create Result
            OperationResponse result = null;
            result = new OperationResponse();
            result.setStatusCode(statusCode);
            if (httpResponse.getHeaders("x-ms-request-id").length > 0) {
                result.setRequestId(httpResponse.getFirstHeader("x-ms-request-id").getValue());
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            return result;
        } finally {
            if (httpResponse != null && httpResponse.getEntity() != null) {
                httpResponse.getEntity().getContent().close();
            }
        }
    }
    
    /**
    * The Delete Role operation deletes the specified virtual machine.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157184.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine to delete.
    * @param deleteFromStorage Optional. Specifies that the source blob(s) for
    * the virtual machine should also be deleted from storage.
    * @return A standard service response including an HTTP status code and
    * request ID.
    */
    @Override
    public Future<OperationResponse> beginDeletingAsync(final String serviceName, final String deploymentName, final String virtualMachineName, final boolean deleteFromStorage) {
        return this.getClient().getExecutorService().submit(new Callable<OperationResponse>() { 
            @Override
            public OperationResponse call() throws Exception {
                return beginDeleting(serviceName, deploymentName, virtualMachineName, deleteFromStorage);
            }
         });
    }
    
    /**
    * The Delete Role operation deletes the specified virtual machine.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157184.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine to delete.
    * @param deleteFromStorage Optional. Specifies that the source blob(s) for
    * the virtual machine should also be deleted from storage.
    * @throws IOException Signals that an I/O exception of some sort has
    * occurred. This class is the general class of exceptions produced by
    * failed or interrupted I/O operations.
    * @throws ServiceException Thrown if an unexpected response is found.
    * @return A standard service response including an HTTP status code and
    * request ID.
    */
    @Override
    public OperationResponse beginDeleting(String serviceName, String deploymentName, String virtualMachineName, boolean deleteFromStorage) throws IOException, ServiceException {
        // Validate
        if (serviceName == null) {
            throw new NullPointerException("serviceName");
        }
        if (deploymentName == null) {
            throw new NullPointerException("deploymentName");
        }
        if (virtualMachineName == null) {
            throw new NullPointerException("virtualMachineName");
        }
        
        // Tracing
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("deploymentName", deploymentName);
            tracingParameters.put("virtualMachineName", virtualMachineName);
            tracingParameters.put("deleteFromStorage", deleteFromStorage);
            CloudTracing.enter(invocationId, this, "beginDeletingAsync", tracingParameters);
        }
        
        // Construct URL
        String url = this.getClient().getBaseUri() + "/" + this.getClient().getCredentials().getSubscriptionId() + "/services/hostedservices/" + serviceName + "/deployments/" + deploymentName + "/roles/" + virtualMachineName + "?";
        if (deleteFromStorage == true) {
            url = url + "comp=" + "media";
        }
        
        // Create HTTP transport objects
        CustomHttpDelete httpRequest = new CustomHttpDelete(url);
        
        // Set Headers
        httpRequest.setHeader("x-ms-version", "2013-11-01");
        
        // Send Request
        HttpResponse httpResponse = null;
        try {
            if (shouldTrace) {
                CloudTracing.sendRequest(invocationId, httpRequest);
            }
            httpResponse = this.getClient().getHttpClient().execute(httpRequest);
            if (shouldTrace) {
                CloudTracing.receiveResponse(invocationId, httpResponse);
            }
            int statusCode = httpResponse.getStatusLine().getStatusCode();
            if (statusCode != HttpStatus.SC_ACCEPTED) {
                ServiceException ex = ServiceException.createFromXml(httpRequest, null, httpResponse, httpResponse.getEntity());
                if (shouldTrace) {
                    CloudTracing.error(invocationId, ex);
                }
                throw ex;
            }
            
            // Create Result
            OperationResponse result = null;
            result = new OperationResponse();
            result.setStatusCode(statusCode);
            if (httpResponse.getHeaders("x-ms-request-id").length > 0) {
                result.setRequestId(httpResponse.getFirstHeader("x-ms-request-id").getValue());
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            return result;
        } finally {
            if (httpResponse != null && httpResponse.getEntity() != null) {
                httpResponse.getEntity().getContent().close();
            }
        }
    }
    
    /**
    * The Restart role operation restarts the specified virtual machine.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157197.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine to restart.
    * @return A standard service response including an HTTP status code and
    * request ID.
    */
    @Override
    public Future<OperationResponse> beginRestartingAsync(final String serviceName, final String deploymentName, final String virtualMachineName) {
        return this.getClient().getExecutorService().submit(new Callable<OperationResponse>() { 
            @Override
            public OperationResponse call() throws Exception {
                return beginRestarting(serviceName, deploymentName, virtualMachineName);
            }
         });
    }
    
    /**
    * The Restart role operation restarts the specified virtual machine.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157197.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine to restart.
    * @throws IOException Signals that an I/O exception of some sort has
    * occurred. This class is the general class of exceptions produced by
    * failed or interrupted I/O operations.
    * @throws ServiceException Thrown if an unexpected response is found.
    * @return A standard service response including an HTTP status code and
    * request ID.
    */
    @Override
    public OperationResponse beginRestarting(String serviceName, String deploymentName, String virtualMachineName) throws IOException, ServiceException {
        // Validate
        if (serviceName == null) {
            throw new NullPointerException("serviceName");
        }
        if (deploymentName == null) {
            throw new NullPointerException("deploymentName");
        }
        if (virtualMachineName == null) {
            throw new NullPointerException("virtualMachineName");
        }
        
        // Tracing
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("deploymentName", deploymentName);
            tracingParameters.put("virtualMachineName", virtualMachineName);
            CloudTracing.enter(invocationId, this, "beginRestartingAsync", tracingParameters);
        }
        
        // Construct URL
        String url = this.getClient().getBaseUri() + "/" + this.getClient().getCredentials().getSubscriptionId() + "/services/hostedservices/" + serviceName + "/deployments/" + deploymentName + "/roleinstances/" + virtualMachineName + "/Operations";
        
        // Create HTTP transport objects
        HttpPost httpRequest = new HttpPost(url);
        
        // Set Headers
        httpRequest.setHeader("Content-Type", "application/xml");
        httpRequest.setHeader("x-ms-version", "2013-11-01");
        
        // Serialize Request
        String requestContent = "<RestartRoleOperation xmlns=\"http://schemas.microsoft.com/windowsazure\"><OperationType>RestartRoleOperation</OperationType></RestartRoleOperation>";
        StringEntity entity = new StringEntity(requestContent);
        httpRequest.setEntity(entity);
        httpRequest.setHeader("Content-Type", "application/xml");
        
        // Send Request
        HttpResponse httpResponse = null;
        try {
            if (shouldTrace) {
                CloudTracing.sendRequest(invocationId, httpRequest);
            }
            httpResponse = this.getClient().getHttpClient().execute(httpRequest);
            if (shouldTrace) {
                CloudTracing.receiveResponse(invocationId, httpResponse);
            }
            int statusCode = httpResponse.getStatusLine().getStatusCode();
            if (statusCode != HttpStatus.SC_ACCEPTED) {
                ServiceException ex = ServiceException.createFromXml(httpRequest, requestContent, httpResponse, httpResponse.getEntity());
                if (shouldTrace) {
                    CloudTracing.error(invocationId, ex);
                }
                throw ex;
            }
            
            // Create Result
            OperationResponse result = null;
            result = new OperationResponse();
            result.setStatusCode(statusCode);
            if (httpResponse.getHeaders("x-ms-request-id").length > 0) {
                result.setRequestId(httpResponse.getFirstHeader("x-ms-request-id").getValue());
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            return result;
        } finally {
            if (httpResponse != null && httpResponse.getEntity() != null) {
                httpResponse.getEntity().getContent().close();
            }
        }
    }
    
    /**
    * The Shutdown Role operation shuts down the specified virtual machine.
    * (see http://msdn.microsoft.com/en-us/library/windowsazure/jj157195.aspx
    * for more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine to shutdown.
    * @param parameters The parameters for the shutdown vm operation.
    * @return A standard service response including an HTTP status code and
    * request ID.
    */
    @Override
    public Future<OperationResponse> beginShutdownAsync(final String serviceName, final String deploymentName, final String virtualMachineName, final VirtualMachineShutdownParameters parameters) {
        return this.getClient().getExecutorService().submit(new Callable<OperationResponse>() { 
            @Override
            public OperationResponse call() throws Exception {
                return beginShutdown(serviceName, deploymentName, virtualMachineName, parameters);
            }
         });
    }
    
    /**
    * The Shutdown Role operation shuts down the specified virtual machine.
    * (see http://msdn.microsoft.com/en-us/library/windowsazure/jj157195.aspx
    * for more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine to shutdown.
    * @param parameters The parameters for the shutdown vm operation.
    * @throws ParserConfigurationException Thrown if there was an error
    * configuring the parser for the response body.
    * @throws SAXException Thrown if there was an error parsing the response
    * body.
    * @throws TransformerException Thrown if there was an error creating the
    * DOM transformer.
    * @throws IOException Signals that an I/O exception of some sort has
    * occurred. This class is the general class of exceptions produced by
    * failed or interrupted I/O operations.
    * @throws ServiceException Thrown if an unexpected response is found.
    * @return A standard service response including an HTTP status code and
    * request ID.
    */
    @Override
    public OperationResponse beginShutdown(String serviceName, String deploymentName, String virtualMachineName, VirtualMachineShutdownParameters parameters) throws ParserConfigurationException, SAXException, TransformerException, IOException, ServiceException {
        // Validate
        if (serviceName == null) {
            throw new NullPointerException("serviceName");
        }
        if (deploymentName == null) {
            throw new NullPointerException("deploymentName");
        }
        if (virtualMachineName == null) {
            throw new NullPointerException("virtualMachineName");
        }
        if (parameters == null) {
            throw new NullPointerException("parameters");
        }
        
        // Tracing
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("deploymentName", deploymentName);
            tracingParameters.put("virtualMachineName", virtualMachineName);
            tracingParameters.put("parameters", parameters);
            CloudTracing.enter(invocationId, this, "beginShutdownAsync", tracingParameters);
        }
        
        // Construct URL
        String url = this.getClient().getBaseUri() + "/" + this.getClient().getCredentials().getSubscriptionId() + "/services/hostedservices/" + serviceName + "/deployments/" + deploymentName + "/roleinstances/" + virtualMachineName + "/Operations";
        
        // Create HTTP transport objects
        HttpPost httpRequest = new HttpPost(url);
        
        // Set Headers
        httpRequest.setHeader("Content-Type", "application/xml");
        httpRequest.setHeader("x-ms-version", "2013-11-01");
        
        // Serialize Request
        String requestContent = null;
        DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();
        DocumentBuilder documentBuilder = documentBuilderFactory.newDocumentBuilder();
        Document requestDoc = documentBuilder.newDocument();
        
        Element shutdownRoleOperationElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ShutdownRoleOperation");
        requestDoc.appendChild(shutdownRoleOperationElement);
        
        Element operationTypeElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "OperationType");
        operationTypeElement.appendChild(requestDoc.createTextNode("ShutdownRoleOperation"));
        shutdownRoleOperationElement.appendChild(operationTypeElement);
        
        Element postShutdownActionElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "PostShutdownAction");
        postShutdownActionElement.appendChild(requestDoc.createTextNode(parameters.getPostShutdownAction().toString()));
        shutdownRoleOperationElement.appendChild(postShutdownActionElement);
        
        DOMSource domSource = new DOMSource(requestDoc);
        StringWriter stringWriter = new StringWriter();
        StreamResult streamResult = new StreamResult(stringWriter);
        TransformerFactory transformerFactory = TransformerFactory.newInstance();
        Transformer transformer = transformerFactory.newTransformer();
        transformer.transform(domSource, streamResult);
        requestContent = stringWriter.toString();
        StringEntity entity = new StringEntity(requestContent);
        httpRequest.setEntity(entity);
        httpRequest.setHeader("Content-Type", "application/xml");
        
        // Send Request
        HttpResponse httpResponse = null;
        try {
            if (shouldTrace) {
                CloudTracing.sendRequest(invocationId, httpRequest);
            }
            httpResponse = this.getClient().getHttpClient().execute(httpRequest);
            if (shouldTrace) {
                CloudTracing.receiveResponse(invocationId, httpResponse);
            }
            int statusCode = httpResponse.getStatusLine().getStatusCode();
            if (statusCode != HttpStatus.SC_ACCEPTED) {
                ServiceException ex = ServiceException.createFromXml(httpRequest, requestContent, httpResponse, httpResponse.getEntity());
                if (shouldTrace) {
                    CloudTracing.error(invocationId, ex);
                }
                throw ex;
            }
            
            // Create Result
            OperationResponse result = null;
            result = new OperationResponse();
            result.setStatusCode(statusCode);
            if (httpResponse.getHeaders("x-ms-request-id").length > 0) {
                result.setRequestId(httpResponse.getFirstHeader("x-ms-request-id").getValue());
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            return result;
        } finally {
            if (httpResponse != null && httpResponse.getEntity() != null) {
                httpResponse.getEntity().getContent().close();
            }
        }
    }
    
    /**
    * The Shutdown Roles operation stops the specified set of virtual machines.
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param parameters The set of virtual machine roles to shutdown and their
    * post shutdown state.
    * @return A standard service response including an HTTP status code and
    * request ID.
    */
    @Override
    public Future<OperationResponse> beginShuttingDownRolesAsync(final String serviceName, final String deploymentName, final VirtualMachineShutdownRolesParameters parameters) {
        return this.getClient().getExecutorService().submit(new Callable<OperationResponse>() { 
            @Override
            public OperationResponse call() throws Exception {
                return beginShuttingDownRoles(serviceName, deploymentName, parameters);
            }
         });
    }
    
    /**
    * The Shutdown Roles operation stops the specified set of virtual machines.
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param parameters The set of virtual machine roles to shutdown and their
    * post shutdown state.
    * @throws ParserConfigurationException Thrown if there was an error
    * configuring the parser for the response body.
    * @throws SAXException Thrown if there was an error parsing the response
    * body.
    * @throws TransformerException Thrown if there was an error creating the
    * DOM transformer.
    * @throws IOException Signals that an I/O exception of some sort has
    * occurred. This class is the general class of exceptions produced by
    * failed or interrupted I/O operations.
    * @throws ServiceException Thrown if an unexpected response is found.
    * @return A standard service response including an HTTP status code and
    * request ID.
    */
    @Override
    public OperationResponse beginShuttingDownRoles(String serviceName, String deploymentName, VirtualMachineShutdownRolesParameters parameters) throws ParserConfigurationException, SAXException, TransformerException, IOException, ServiceException {
        // Validate
        if (serviceName == null) {
            throw new NullPointerException("serviceName");
        }
        if (deploymentName == null) {
            throw new NullPointerException("deploymentName");
        }
        if (parameters == null) {
            throw new NullPointerException("parameters");
        }
        
        // Tracing
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("deploymentName", deploymentName);
            tracingParameters.put("parameters", parameters);
            CloudTracing.enter(invocationId, this, "beginShuttingDownRolesAsync", tracingParameters);
        }
        
        // Construct URL
        String url = this.getClient().getBaseUri() + "/" + this.getClient().getCredentials().getSubscriptionId() + "/services/hostedservices/" + serviceName + "/deployments/" + deploymentName + "/Roles/Operations";
        
        // Create HTTP transport objects
        HttpPost httpRequest = new HttpPost(url);
        
        // Set Headers
        httpRequest.setHeader("Content-Type", "application/xml");
        httpRequest.setHeader("x-ms-version", "2013-11-01");
        
        // Serialize Request
        String requestContent = null;
        DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();
        DocumentBuilder documentBuilder = documentBuilderFactory.newDocumentBuilder();
        Document requestDoc = documentBuilder.newDocument();
        
        Element shutdownRolesOperationElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ShutdownRolesOperation");
        requestDoc.appendChild(shutdownRolesOperationElement);
        
        Element operationTypeElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "OperationType");
        operationTypeElement.appendChild(requestDoc.createTextNode("ShutdownRolesOperation"));
        shutdownRolesOperationElement.appendChild(operationTypeElement);
        
        if (parameters.getRoles() != null) {
            Element rolesSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Roles");
            for (String rolesItem : parameters.getRoles()) {
                Element rolesItemElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Name");
                rolesItemElement.appendChild(requestDoc.createTextNode(rolesItem));
                rolesSequenceElement.appendChild(rolesItemElement);
            }
            shutdownRolesOperationElement.appendChild(rolesSequenceElement);
        }
        
        if (parameters.getPostShutdownAction() != null) {
            Element postShutdownActionElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "PostShutdownAction");
            postShutdownActionElement.appendChild(requestDoc.createTextNode(parameters.getPostShutdownAction().toString()));
            shutdownRolesOperationElement.appendChild(postShutdownActionElement);
        }
        
        DOMSource domSource = new DOMSource(requestDoc);
        StringWriter stringWriter = new StringWriter();
        StreamResult streamResult = new StreamResult(stringWriter);
        TransformerFactory transformerFactory = TransformerFactory.newInstance();
        Transformer transformer = transformerFactory.newTransformer();
        transformer.transform(domSource, streamResult);
        requestContent = stringWriter.toString();
        StringEntity entity = new StringEntity(requestContent);
        httpRequest.setEntity(entity);
        httpRequest.setHeader("Content-Type", "application/xml");
        
        // Send Request
        HttpResponse httpResponse = null;
        try {
            if (shouldTrace) {
                CloudTracing.sendRequest(invocationId, httpRequest);
            }
            httpResponse = this.getClient().getHttpClient().execute(httpRequest);
            if (shouldTrace) {
                CloudTracing.receiveResponse(invocationId, httpResponse);
            }
            int statusCode = httpResponse.getStatusLine().getStatusCode();
            if (statusCode != HttpStatus.SC_ACCEPTED) {
                ServiceException ex = ServiceException.createFromXml(httpRequest, requestContent, httpResponse, httpResponse.getEntity());
                if (shouldTrace) {
                    CloudTracing.error(invocationId, ex);
                }
                throw ex;
            }
            
            // Create Result
            OperationResponse result = null;
            result = new OperationResponse();
            result.setStatusCode(statusCode);
            if (httpResponse.getHeaders("x-ms-request-id").length > 0) {
                result.setRequestId(httpResponse.getFirstHeader("x-ms-request-id").getValue());
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            return result;
        } finally {
            if (httpResponse != null && httpResponse.getEntity() != null) {
                httpResponse.getEntity().getContent().close();
            }
        }
    }
    
    /**
    * The Start Role operation starts the specified virtual machine.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157189.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine to start.
    * @return A standard service response including an HTTP status code and
    * request ID.
    */
    @Override
    public Future<OperationResponse> beginStartingAsync(final String serviceName, final String deploymentName, final String virtualMachineName) {
        return this.getClient().getExecutorService().submit(new Callable<OperationResponse>() { 
            @Override
            public OperationResponse call() throws Exception {
                return beginStarting(serviceName, deploymentName, virtualMachineName);
            }
         });
    }
    
    /**
    * The Start Role operation starts the specified virtual machine.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157189.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine to start.
    * @throws IOException Signals that an I/O exception of some sort has
    * occurred. This class is the general class of exceptions produced by
    * failed or interrupted I/O operations.
    * @throws ServiceException Thrown if an unexpected response is found.
    * @return A standard service response including an HTTP status code and
    * request ID.
    */
    @Override
    public OperationResponse beginStarting(String serviceName, String deploymentName, String virtualMachineName) throws IOException, ServiceException {
        // Validate
        if (serviceName == null) {
            throw new NullPointerException("serviceName");
        }
        if (deploymentName == null) {
            throw new NullPointerException("deploymentName");
        }
        if (virtualMachineName == null) {
            throw new NullPointerException("virtualMachineName");
        }
        
        // Tracing
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("deploymentName", deploymentName);
            tracingParameters.put("virtualMachineName", virtualMachineName);
            CloudTracing.enter(invocationId, this, "beginStartingAsync", tracingParameters);
        }
        
        // Construct URL
        String url = this.getClient().getBaseUri() + "/" + this.getClient().getCredentials().getSubscriptionId() + "/services/hostedservices/" + serviceName + "/deployments/" + deploymentName + "/roleinstances/" + virtualMachineName + "/Operations";
        
        // Create HTTP transport objects
        HttpPost httpRequest = new HttpPost(url);
        
        // Set Headers
        httpRequest.setHeader("Content-Type", "application/xml");
        httpRequest.setHeader("x-ms-version", "2013-11-01");
        
        // Serialize Request
        String requestContent = "<StartRoleOperation xmlns=\"http://schemas.microsoft.com/windowsazure\"><OperationType>StartRoleOperation</OperationType></StartRoleOperation>";
        StringEntity entity = new StringEntity(requestContent);
        httpRequest.setEntity(entity);
        httpRequest.setHeader("Content-Type", "application/xml");
        
        // Send Request
        HttpResponse httpResponse = null;
        try {
            if (shouldTrace) {
                CloudTracing.sendRequest(invocationId, httpRequest);
            }
            httpResponse = this.getClient().getHttpClient().execute(httpRequest);
            if (shouldTrace) {
                CloudTracing.receiveResponse(invocationId, httpResponse);
            }
            int statusCode = httpResponse.getStatusLine().getStatusCode();
            if (statusCode != HttpStatus.SC_ACCEPTED) {
                ServiceException ex = ServiceException.createFromXml(httpRequest, requestContent, httpResponse, httpResponse.getEntity());
                if (shouldTrace) {
                    CloudTracing.error(invocationId, ex);
                }
                throw ex;
            }
            
            // Create Result
            OperationResponse result = null;
            result = new OperationResponse();
            result.setStatusCode(statusCode);
            if (httpResponse.getHeaders("x-ms-request-id").length > 0) {
                result.setRequestId(httpResponse.getFirstHeader("x-ms-request-id").getValue());
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            return result;
        } finally {
            if (httpResponse != null && httpResponse.getEntity() != null) {
                httpResponse.getEntity().getContent().close();
            }
        }
    }
    
    /**
    * The Start Roles operation starts the specified set of virtual machines.
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param parameters The set of virtual machine roles to start.
    * @return A standard service response including an HTTP status code and
    * request ID.
    */
    @Override
    public Future<OperationResponse> beginStartingRolesAsync(final String serviceName, final String deploymentName, final VirtualMachineStartRolesParameters parameters) {
        return this.getClient().getExecutorService().submit(new Callable<OperationResponse>() { 
            @Override
            public OperationResponse call() throws Exception {
                return beginStartingRoles(serviceName, deploymentName, parameters);
            }
         });
    }
    
    /**
    * The Start Roles operation starts the specified set of virtual machines.
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param parameters The set of virtual machine roles to start.
    * @throws ParserConfigurationException Thrown if there was an error
    * configuring the parser for the response body.
    * @throws SAXException Thrown if there was an error parsing the response
    * body.
    * @throws TransformerException Thrown if there was an error creating the
    * DOM transformer.
    * @throws IOException Signals that an I/O exception of some sort has
    * occurred. This class is the general class of exceptions produced by
    * failed or interrupted I/O operations.
    * @throws ServiceException Thrown if an unexpected response is found.
    * @return A standard service response including an HTTP status code and
    * request ID.
    */
    @Override
    public OperationResponse beginStartingRoles(String serviceName, String deploymentName, VirtualMachineStartRolesParameters parameters) throws ParserConfigurationException, SAXException, TransformerException, IOException, ServiceException {
        // Validate
        if (serviceName == null) {
            throw new NullPointerException("serviceName");
        }
        if (deploymentName == null) {
            throw new NullPointerException("deploymentName");
        }
        if (parameters == null) {
            throw new NullPointerException("parameters");
        }
        
        // Tracing
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("deploymentName", deploymentName);
            tracingParameters.put("parameters", parameters);
            CloudTracing.enter(invocationId, this, "beginStartingRolesAsync", tracingParameters);
        }
        
        // Construct URL
        String url = this.getClient().getBaseUri() + "/" + this.getClient().getCredentials().getSubscriptionId() + "/services/hostedservices/" + serviceName + "/deployments/" + deploymentName + "/Roles/Operations";
        
        // Create HTTP transport objects
        HttpPost httpRequest = new HttpPost(url);
        
        // Set Headers
        httpRequest.setHeader("Content-Type", "application/xml");
        httpRequest.setHeader("x-ms-version", "2013-11-01");
        
        // Serialize Request
        String requestContent = null;
        DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();
        DocumentBuilder documentBuilder = documentBuilderFactory.newDocumentBuilder();
        Document requestDoc = documentBuilder.newDocument();
        
        Element startRolesOperationElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "StartRolesOperation");
        requestDoc.appendChild(startRolesOperationElement);
        
        Element operationTypeElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "OperationType");
        operationTypeElement.appendChild(requestDoc.createTextNode("StartRolesOperation"));
        startRolesOperationElement.appendChild(operationTypeElement);
        
        if (parameters.getRoles() != null) {
            Element rolesSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Roles");
            for (String rolesItem : parameters.getRoles()) {
                Element rolesItemElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Name");
                rolesItemElement.appendChild(requestDoc.createTextNode(rolesItem));
                rolesSequenceElement.appendChild(rolesItemElement);
            }
            startRolesOperationElement.appendChild(rolesSequenceElement);
        }
        
        DOMSource domSource = new DOMSource(requestDoc);
        StringWriter stringWriter = new StringWriter();
        StreamResult streamResult = new StreamResult(stringWriter);
        TransformerFactory transformerFactory = TransformerFactory.newInstance();
        Transformer transformer = transformerFactory.newTransformer();
        transformer.transform(domSource, streamResult);
        requestContent = stringWriter.toString();
        StringEntity entity = new StringEntity(requestContent);
        httpRequest.setEntity(entity);
        httpRequest.setHeader("Content-Type", "application/xml");
        
        // Send Request
        HttpResponse httpResponse = null;
        try {
            if (shouldTrace) {
                CloudTracing.sendRequest(invocationId, httpRequest);
            }
            httpResponse = this.getClient().getHttpClient().execute(httpRequest);
            if (shouldTrace) {
                CloudTracing.receiveResponse(invocationId, httpResponse);
            }
            int statusCode = httpResponse.getStatusLine().getStatusCode();
            if (statusCode != HttpStatus.SC_ACCEPTED) {
                ServiceException ex = ServiceException.createFromXml(httpRequest, requestContent, httpResponse, httpResponse.getEntity());
                if (shouldTrace) {
                    CloudTracing.error(invocationId, ex);
                }
                throw ex;
            }
            
            // Create Result
            OperationResponse result = null;
            result = new OperationResponse();
            result.setStatusCode(statusCode);
            if (httpResponse.getHeaders("x-ms-request-id").length > 0) {
                result.setRequestId(httpResponse.getFirstHeader("x-ms-request-id").getValue());
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            return result;
        } finally {
            if (httpResponse != null && httpResponse.getEntity() != null) {
                httpResponse.getEntity().getContent().close();
            }
        }
    }
    
    /**
    * The Update Role operation adds a virtual machine to an existing
    * deployment.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157187.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of your virtual machine.
    * @param parameters Parameters supplied to the Update Virtual Machine
    * operation.
    * @return A standard service response including an HTTP status code and
    * request ID.
    */
    @Override
    public Future<OperationResponse> beginUpdatingAsync(final String serviceName, final String deploymentName, final String virtualMachineName, final VirtualMachineUpdateParameters parameters) {
        return this.getClient().getExecutorService().submit(new Callable<OperationResponse>() { 
            @Override
            public OperationResponse call() throws Exception {
                return beginUpdating(serviceName, deploymentName, virtualMachineName, parameters);
            }
         });
    }
    
    /**
    * The Update Role operation adds a virtual machine to an existing
    * deployment.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157187.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of your virtual machine.
    * @param parameters Parameters supplied to the Update Virtual Machine
    * operation.
    * @throws ParserConfigurationException Thrown if there was an error
    * configuring the parser for the response body.
    * @throws SAXException Thrown if there was an error parsing the response
    * body.
    * @throws TransformerException Thrown if there was an error creating the
    * DOM transformer.
    * @throws IOException Signals that an I/O exception of some sort has
    * occurred. This class is the general class of exceptions produced by
    * failed or interrupted I/O operations.
    * @throws ServiceException Thrown if an unexpected response is found.
    * @return A standard service response including an HTTP status code and
    * request ID.
    */
    @Override
    public OperationResponse beginUpdating(String serviceName, String deploymentName, String virtualMachineName, VirtualMachineUpdateParameters parameters) throws ParserConfigurationException, SAXException, TransformerException, IOException, ServiceException {
        // Validate
        if (serviceName == null) {
            throw new NullPointerException("serviceName");
        }
        if (deploymentName == null) {
            throw new NullPointerException("deploymentName");
        }
        if (virtualMachineName == null) {
            throw new NullPointerException("virtualMachineName");
        }
        if (parameters == null) {
            throw new NullPointerException("parameters");
        }
        if (parameters.getConfigurationSets() != null) {
            for (ConfigurationSet configurationSetsParameterItem : parameters.getConfigurationSets()) {
                if (configurationSetsParameterItem.getDomainJoin() != null) {
                    if (configurationSetsParameterItem.getDomainJoin().getCredentials() != null) {
                        if (configurationSetsParameterItem.getDomainJoin().getCredentials().getPassword() == null) {
                            throw new NullPointerException("parameters.ConfigurationSets.DomainJoin.Credentials.Password");
                        }
                        if (configurationSetsParameterItem.getDomainJoin().getCredentials().getUserName() == null) {
                            throw new NullPointerException("parameters.ConfigurationSets.DomainJoin.Credentials.UserName");
                        }
                    }
                }
                if (configurationSetsParameterItem.getHostName() != null && configurationSetsParameterItem.getHostName().length() < 1) {
                    throw new IllegalArgumentException("parameters.ConfigurationSets.HostName");
                }
                if (configurationSetsParameterItem.getHostName() != null && configurationSetsParameterItem.getHostName().length() > 64) {
                    throw new IllegalArgumentException("parameters.ConfigurationSets.HostName");
                }
                if (configurationSetsParameterItem.getSshSettings() != null) {
                    if (configurationSetsParameterItem.getSshSettings().getKeyPairs() != null) {
                        for (SshSettingKeyPair keyPairsParameterItem : configurationSetsParameterItem.getSshSettings().getKeyPairs()) {
                            if (keyPairsParameterItem.getFingerprint() == null) {
                                throw new NullPointerException("parameters.ConfigurationSets.SshSettings.KeyPairs.Fingerprint");
                            }
                            if (keyPairsParameterItem.getPath() == null) {
                                throw new NullPointerException("parameters.ConfigurationSets.SshSettings.KeyPairs.Path");
                            }
                        }
                    }
                    if (configurationSetsParameterItem.getSshSettings().getPublicKeys() != null) {
                        for (SshSettingPublicKey publicKeysParameterItem : configurationSetsParameterItem.getSshSettings().getPublicKeys()) {
                            if (publicKeysParameterItem.getFingerprint() == null) {
                                throw new NullPointerException("parameters.ConfigurationSets.SshSettings.PublicKeys.Fingerprint");
                            }
                            if (publicKeysParameterItem.getPath() == null) {
                                throw new NullPointerException("parameters.ConfigurationSets.SshSettings.PublicKeys.Path");
                            }
                        }
                    }
                }
                if (configurationSetsParameterItem.getStoredCertificateSettings() != null) {
                    for (StoredCertificateSettings storedCertificateSettingsParameterItem : configurationSetsParameterItem.getStoredCertificateSettings()) {
                        if (storedCertificateSettingsParameterItem.getStoreName() == null) {
                            throw new NullPointerException("parameters.ConfigurationSets.StoredCertificateSettings.StoreName");
                        }
                        if (storedCertificateSettingsParameterItem.getThumbprint() == null) {
                            throw new NullPointerException("parameters.ConfigurationSets.StoredCertificateSettings.Thumbprint");
                        }
                    }
                }
                if (configurationSetsParameterItem.getUserName() != null && configurationSetsParameterItem.getUserName().length() < 1) {
                    throw new IllegalArgumentException("parameters.ConfigurationSets.UserName");
                }
                if (configurationSetsParameterItem.getUserName() != null && configurationSetsParameterItem.getUserName().length() > 32) {
                    throw new IllegalArgumentException("parameters.ConfigurationSets.UserName");
                }
                if (configurationSetsParameterItem.getUserPassword() != null && configurationSetsParameterItem.getUserPassword().length() < 6 && (configurationSetsParameterItem.isDisableSshPasswordAuthentication() == false || configurationSetsParameterItem.getUserPassword().length() != 0)) {
                    throw new IllegalArgumentException("parameters.ConfigurationSets.UserPassword");
                }
                if (configurationSetsParameterItem.getUserPassword() != null && configurationSetsParameterItem.getUserPassword().length() > 72) {
                    throw new IllegalArgumentException("parameters.ConfigurationSets.UserPassword");
                }
            }
        }
        if (parameters.getOSVirtualHardDisk() == null) {
            throw new NullPointerException("parameters.OSVirtualHardDisk");
        }
        if (parameters.getRoleName() == null) {
            throw new NullPointerException("parameters.RoleName");
        }
        
        // Tracing
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("deploymentName", deploymentName);
            tracingParameters.put("virtualMachineName", virtualMachineName);
            tracingParameters.put("parameters", parameters);
            CloudTracing.enter(invocationId, this, "beginUpdatingAsync", tracingParameters);
        }
        
        // Construct URL
        String url = this.getClient().getBaseUri() + "/" + this.getClient().getCredentials().getSubscriptionId() + "/services/hostedservices/" + serviceName + "/deployments/" + deploymentName + "/roles/" + virtualMachineName;
        
        // Create HTTP transport objects
        HttpPut httpRequest = new HttpPut(url);
        
        // Set Headers
        httpRequest.setHeader("Content-Type", "application/xml");
        httpRequest.setHeader("x-ms-version", "2013-11-01");
        
        // Serialize Request
        String requestContent = null;
        DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();
        DocumentBuilder documentBuilder = documentBuilderFactory.newDocumentBuilder();
        Document requestDoc = documentBuilder.newDocument();
        
        Element persistentVMRoleElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "PersistentVMRole");
        requestDoc.appendChild(persistentVMRoleElement);
        
        Element roleNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "RoleName");
        roleNameElement.appendChild(requestDoc.createTextNode(parameters.getRoleName()));
        persistentVMRoleElement.appendChild(roleNameElement);
        
        Element roleTypeElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "RoleType");
        roleTypeElement.appendChild(requestDoc.createTextNode("PersistentVMRole"));
        persistentVMRoleElement.appendChild(roleTypeElement);
        
        if (parameters.getConfigurationSets() != null) {
            Element configurationSetsSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ConfigurationSets");
            for (ConfigurationSet configurationSetsItem : parameters.getConfigurationSets()) {
                Element configurationSetElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ConfigurationSet");
                configurationSetsSequenceElement.appendChild(configurationSetElement);
                
                if (configurationSetsItem.getConfigurationSetType() != null) {
                    Element configurationSetTypeElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ConfigurationSetType");
                    configurationSetTypeElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getConfigurationSetType()));
                    configurationSetElement.appendChild(configurationSetTypeElement);
                }
                
                if (configurationSetsItem.getInputEndpoints() != null) {
                    Element inputEndpointsSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "InputEndpoints");
                    for (InputEndpoint inputEndpointsItem : configurationSetsItem.getInputEndpoints()) {
                        Element inputEndpointElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "InputEndpoint");
                        inputEndpointsSequenceElement.appendChild(inputEndpointElement);
                        
                        if (inputEndpointsItem.getLoadBalancedEndpointSetName() != null) {
                            Element loadBalancedEndpointSetNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "LoadBalancedEndpointSetName");
                            loadBalancedEndpointSetNameElement.appendChild(requestDoc.createTextNode(inputEndpointsItem.getLoadBalancedEndpointSetName()));
                            inputEndpointElement.appendChild(loadBalancedEndpointSetNameElement);
                        }
                        
                        if (inputEndpointsItem.getLocalPort() != null) {
                            Element localPortElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "LocalPort");
                            localPortElement.appendChild(requestDoc.createTextNode(Integer.toString(inputEndpointsItem.getLocalPort())));
                            inputEndpointElement.appendChild(localPortElement);
                        }
                        
                        if (inputEndpointsItem.getName() != null) {
                            Element nameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Name");
                            nameElement.appendChild(requestDoc.createTextNode(inputEndpointsItem.getName()));
                            inputEndpointElement.appendChild(nameElement);
                        }
                        
                        if (inputEndpointsItem.getPort() != null) {
                            Element portElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Port");
                            portElement.appendChild(requestDoc.createTextNode(Integer.toString(inputEndpointsItem.getPort())));
                            inputEndpointElement.appendChild(portElement);
                        }
                        
                        if (inputEndpointsItem.getLoadBalancerProbe() != null) {
                            Element loadBalancerProbeElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "LoadBalancerProbe");
                            inputEndpointElement.appendChild(loadBalancerProbeElement);
                            
                            if (inputEndpointsItem.getLoadBalancerProbe().getPath() != null) {
                                Element pathElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Path");
                                pathElement.appendChild(requestDoc.createTextNode(inputEndpointsItem.getLoadBalancerProbe().getPath()));
                                loadBalancerProbeElement.appendChild(pathElement);
                            }
                            
                            Element portElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Port");
                            portElement2.appendChild(requestDoc.createTextNode(Integer.toString(inputEndpointsItem.getLoadBalancerProbe().getPort())));
                            loadBalancerProbeElement.appendChild(portElement2);
                            
                            Element protocolElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Protocol");
                            protocolElement.appendChild(requestDoc.createTextNode(ComputeManagementClientImpl.loadBalancerProbeTransportProtocolToString(inputEndpointsItem.getLoadBalancerProbe().getProtocol())));
                            loadBalancerProbeElement.appendChild(protocolElement);
                            
                            if (inputEndpointsItem.getLoadBalancerProbe().getIntervalInSeconds() != null) {
                                Element intervalInSecondsElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "IntervalInSeconds");
                                intervalInSecondsElement.appendChild(requestDoc.createTextNode(Integer.toString(inputEndpointsItem.getLoadBalancerProbe().getIntervalInSeconds())));
                                loadBalancerProbeElement.appendChild(intervalInSecondsElement);
                            }
                            
                            if (inputEndpointsItem.getLoadBalancerProbe().getTimeoutInSeconds() != null) {
                                Element timeoutInSecondsElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "TimeoutInSeconds");
                                timeoutInSecondsElement.appendChild(requestDoc.createTextNode(Integer.toString(inputEndpointsItem.getLoadBalancerProbe().getTimeoutInSeconds())));
                                loadBalancerProbeElement.appendChild(timeoutInSecondsElement);
                            }
                        }
                        
                        if (inputEndpointsItem.getProtocol() != null) {
                            Element protocolElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Protocol");
                            protocolElement2.appendChild(requestDoc.createTextNode(inputEndpointsItem.getProtocol()));
                            inputEndpointElement.appendChild(protocolElement2);
                        }
                        
                        if (inputEndpointsItem.getVirtualIPAddress() != null) {
                            Element vipElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Vip");
                            vipElement.appendChild(requestDoc.createTextNode(inputEndpointsItem.getVirtualIPAddress().getHostAddress()));
                            inputEndpointElement.appendChild(vipElement);
                        }
                        
                        if (inputEndpointsItem.isEnableDirectServerReturn() != null) {
                            Element enableDirectServerReturnElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "EnableDirectServerReturn");
                            enableDirectServerReturnElement.appendChild(requestDoc.createTextNode(Boolean.toString(inputEndpointsItem.isEnableDirectServerReturn()).toLowerCase()));
                            inputEndpointElement.appendChild(enableDirectServerReturnElement);
                        }
                        
                        if (inputEndpointsItem.getEndpointAcl() != null) {
                            Element endpointAclElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "EndpointAcl");
                            inputEndpointElement.appendChild(endpointAclElement);
                            
                            if (inputEndpointsItem.getEndpointAcl().getRules() != null) {
                                Element rulesSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Rules");
                                for (AccessControlListRule rulesItem : inputEndpointsItem.getEndpointAcl().getRules()) {
                                    Element ruleElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Rule");
                                    rulesSequenceElement.appendChild(ruleElement);
                                    
                                    if (rulesItem.getOrder() != null) {
                                        Element orderElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Order");
                                        orderElement.appendChild(requestDoc.createTextNode(Integer.toString(rulesItem.getOrder())));
                                        ruleElement.appendChild(orderElement);
                                    }
                                    
                                    if (rulesItem.getAction() != null) {
                                        Element actionElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Action");
                                        actionElement.appendChild(requestDoc.createTextNode(rulesItem.getAction()));
                                        ruleElement.appendChild(actionElement);
                                    }
                                    
                                    if (rulesItem.getRemoteSubnet() != null) {
                                        Element remoteSubnetElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "RemoteSubnet");
                                        remoteSubnetElement.appendChild(requestDoc.createTextNode(rulesItem.getRemoteSubnet()));
                                        ruleElement.appendChild(remoteSubnetElement);
                                    }
                                    
                                    if (rulesItem.getDescription() != null) {
                                        Element descriptionElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Description");
                                        descriptionElement.appendChild(requestDoc.createTextNode(rulesItem.getDescription()));
                                        ruleElement.appendChild(descriptionElement);
                                    }
                                }
                                endpointAclElement.appendChild(rulesSequenceElement);
                            }
                        }
                    }
                    configurationSetElement.appendChild(inputEndpointsSequenceElement);
                }
                
                if (configurationSetsItem.getSubnetNames() != null) {
                    Element subnetNamesSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "SubnetNames");
                    for (String subnetNamesItem : configurationSetsItem.getSubnetNames()) {
                        Element subnetNamesItemElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "SubnetName");
                        subnetNamesItemElement.appendChild(requestDoc.createTextNode(subnetNamesItem));
                        subnetNamesSequenceElement.appendChild(subnetNamesItemElement);
                    }
                    configurationSetElement.appendChild(subnetNamesSequenceElement);
                }
                
                if (configurationSetsItem.getStaticVirtualNetworkIPAddress() != null) {
                    Element staticVirtualNetworkIPAddressElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "StaticVirtualNetworkIPAddress");
                    staticVirtualNetworkIPAddressElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getStaticVirtualNetworkIPAddress()));
                    configurationSetElement.appendChild(staticVirtualNetworkIPAddressElement);
                }
                
                if (configurationSetsItem.getComputerName() != null) {
                    Element computerNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ComputerName");
                    computerNameElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getComputerName()));
                    configurationSetElement.appendChild(computerNameElement);
                }
                
                if (configurationSetsItem.getAdminPassword() != null) {
                    Element adminPasswordElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "AdminPassword");
                    adminPasswordElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getAdminPassword()));
                    configurationSetElement.appendChild(adminPasswordElement);
                }
                
                if (configurationSetsItem.isResetPasswordOnFirstLogon() != null) {
                    Element resetPasswordOnFirstLogonElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ResetPasswordOnFirstLogon");
                    resetPasswordOnFirstLogonElement.appendChild(requestDoc.createTextNode(Boolean.toString(configurationSetsItem.isResetPasswordOnFirstLogon()).toLowerCase()));
                    configurationSetElement.appendChild(resetPasswordOnFirstLogonElement);
                }
                
                if (configurationSetsItem.isEnableAutomaticUpdates() != null) {
                    Element enableAutomaticUpdatesElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "EnableAutomaticUpdates");
                    enableAutomaticUpdatesElement.appendChild(requestDoc.createTextNode(Boolean.toString(configurationSetsItem.isEnableAutomaticUpdates()).toLowerCase()));
                    configurationSetElement.appendChild(enableAutomaticUpdatesElement);
                }
                
                if (configurationSetsItem.getTimeZone() != null) {
                    Element timeZoneElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "TimeZone");
                    timeZoneElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getTimeZone()));
                    configurationSetElement.appendChild(timeZoneElement);
                }
                
                if (configurationSetsItem.getDomainJoin() != null) {
                    Element domainJoinElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DomainJoin");
                    configurationSetElement.appendChild(domainJoinElement);
                    
                    if (configurationSetsItem.getDomainJoin().getCredentials() != null) {
                        Element credentialsElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Credentials");
                        domainJoinElement.appendChild(credentialsElement);
                        
                        if (configurationSetsItem.getDomainJoin().getCredentials().getDomain() != null) {
                            Element domainElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Domain");
                            domainElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getDomainJoin().getCredentials().getDomain()));
                            credentialsElement.appendChild(domainElement);
                        }
                        
                        Element usernameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Username");
                        usernameElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getDomainJoin().getCredentials().getUserName()));
                        credentialsElement.appendChild(usernameElement);
                        
                        Element passwordElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Password");
                        passwordElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getDomainJoin().getCredentials().getPassword()));
                        credentialsElement.appendChild(passwordElement);
                    }
                    
                    if (configurationSetsItem.getDomainJoin().getDomainToJoin() != null) {
                        Element joinDomainElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "JoinDomain");
                        joinDomainElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getDomainJoin().getDomainToJoin()));
                        domainJoinElement.appendChild(joinDomainElement);
                    }
                    
                    if (configurationSetsItem.getDomainJoin().getLdapMachineObjectOU() != null) {
                        Element machineObjectOUElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "MachineObjectOU");
                        machineObjectOUElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getDomainJoin().getLdapMachineObjectOU()));
                        domainJoinElement.appendChild(machineObjectOUElement);
                    }
                    
                    if (configurationSetsItem.getDomainJoin().getProvisioning() != null) {
                        Element provisioningElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Provisioning");
                        domainJoinElement.appendChild(provisioningElement);
                        
                        if (configurationSetsItem.getDomainJoin().getProvisioning().getAccountData() != null) {
                            Element accountDataElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "AccountData");
                            accountDataElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getDomainJoin().getProvisioning().getAccountData()));
                            provisioningElement.appendChild(accountDataElement);
                        }
                    }
                }
                
                if (configurationSetsItem.getStoredCertificateSettings() != null) {
                    Element storedCertificateSettingsSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "StoredCertificateSettings");
                    for (StoredCertificateSettings storedCertificateSettingsItem : configurationSetsItem.getStoredCertificateSettings()) {
                        Element certificateSettingElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "CertificateSetting");
                        storedCertificateSettingsSequenceElement.appendChild(certificateSettingElement);
                        
                        Element storeLocationElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "StoreLocation");
                        storeLocationElement.appendChild(requestDoc.createTextNode("LocalMachine"));
                        certificateSettingElement.appendChild(storeLocationElement);
                        
                        Element storeNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "StoreName");
                        storeNameElement.appendChild(requestDoc.createTextNode(storedCertificateSettingsItem.getStoreName()));
                        certificateSettingElement.appendChild(storeNameElement);
                        
                        Element thumbprintElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Thumbprint");
                        thumbprintElement.appendChild(requestDoc.createTextNode(storedCertificateSettingsItem.getThumbprint()));
                        certificateSettingElement.appendChild(thumbprintElement);
                    }
                    configurationSetElement.appendChild(storedCertificateSettingsSequenceElement);
                }
                
                if (configurationSetsItem.getWindowsRemoteManagement() != null) {
                    Element winRMElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "WinRM");
                    configurationSetElement.appendChild(winRMElement);
                    
                    if (configurationSetsItem.getWindowsRemoteManagement().getListeners() != null) {
                        Element listenersSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Listeners");
                        for (WindowsRemoteManagementListener listenersItem : configurationSetsItem.getWindowsRemoteManagement().getListeners()) {
                            Element listenerElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Listener");
                            listenersSequenceElement.appendChild(listenerElement);
                            
                            if (listenersItem.getCertificateThumbprint() != null) {
                                Element certificateThumbprintElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "CertificateThumbprint");
                                certificateThumbprintElement.appendChild(requestDoc.createTextNode(listenersItem.getCertificateThumbprint()));
                                listenerElement.appendChild(certificateThumbprintElement);
                            }
                            
                            Element protocolElement3 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Protocol");
                            protocolElement3.appendChild(requestDoc.createTextNode(listenersItem.getListenerType().toString()));
                            listenerElement.appendChild(protocolElement3);
                        }
                        winRMElement.appendChild(listenersSequenceElement);
                    }
                }
                
                if (configurationSetsItem.getAdminUserName() != null) {
                    Element adminUsernameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "AdminUsername");
                    adminUsernameElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getAdminUserName()));
                    configurationSetElement.appendChild(adminUsernameElement);
                }
                
                if (configurationSetsItem.getHostName() != null) {
                    Element hostNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "HostName");
                    hostNameElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getHostName()));
                    configurationSetElement.appendChild(hostNameElement);
                }
                
                if (configurationSetsItem.getUserName() != null) {
                    Element userNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "UserName");
                    userNameElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getUserName()));
                    configurationSetElement.appendChild(userNameElement);
                }
                
                if (configurationSetsItem.getUserPassword() != null) {
                    Element userPasswordElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "UserPassword");
                    userPasswordElement.appendChild(requestDoc.createTextNode(configurationSetsItem.getUserPassword()));
                    configurationSetElement.appendChild(userPasswordElement);
                }
                
                if (configurationSetsItem.isDisableSshPasswordAuthentication() != null) {
                    Element disableSshPasswordAuthenticationElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DisableSshPasswordAuthentication");
                    disableSshPasswordAuthenticationElement.appendChild(requestDoc.createTextNode(Boolean.toString(configurationSetsItem.isDisableSshPasswordAuthentication()).toLowerCase()));
                    configurationSetElement.appendChild(disableSshPasswordAuthenticationElement);
                }
                
                if (configurationSetsItem.getSshSettings() != null) {
                    Element sSHElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "SSH");
                    configurationSetElement.appendChild(sSHElement);
                    
                    if (configurationSetsItem.getSshSettings().getPublicKeys() != null) {
                        Element publicKeysSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "PublicKeys");
                        for (SshSettingPublicKey publicKeysItem : configurationSetsItem.getSshSettings().getPublicKeys()) {
                            Element publicKeyElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "PublicKey");
                            publicKeysSequenceElement.appendChild(publicKeyElement);
                            
                            Element fingerprintElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Fingerprint");
                            fingerprintElement.appendChild(requestDoc.createTextNode(publicKeysItem.getFingerprint()));
                            publicKeyElement.appendChild(fingerprintElement);
                            
                            Element pathElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Path");
                            pathElement2.appendChild(requestDoc.createTextNode(publicKeysItem.getPath()));
                            publicKeyElement.appendChild(pathElement2);
                        }
                        sSHElement.appendChild(publicKeysSequenceElement);
                    }
                    
                    if (configurationSetsItem.getSshSettings().getKeyPairs() != null) {
                        Element keyPairsSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "KeyPairs");
                        for (SshSettingKeyPair keyPairsItem : configurationSetsItem.getSshSettings().getKeyPairs()) {
                            Element keyPairElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "KeyPair");
                            keyPairsSequenceElement.appendChild(keyPairElement);
                            
                            Element fingerprintElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Fingerprint");
                            fingerprintElement2.appendChild(requestDoc.createTextNode(keyPairsItem.getFingerprint()));
                            keyPairElement.appendChild(fingerprintElement2);
                            
                            Element pathElement3 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Path");
                            pathElement3.appendChild(requestDoc.createTextNode(keyPairsItem.getPath()));
                            keyPairElement.appendChild(pathElement3);
                        }
                        sSHElement.appendChild(keyPairsSequenceElement);
                    }
                }
            }
            persistentVMRoleElement.appendChild(configurationSetsSequenceElement);
        }
        
        if (parameters.getAvailabilitySetName() != null) {
            Element availabilitySetNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "AvailabilitySetName");
            availabilitySetNameElement.appendChild(requestDoc.createTextNode(parameters.getAvailabilitySetName()));
            persistentVMRoleElement.appendChild(availabilitySetNameElement);
        }
        
        if (parameters.getResourceExtensionReferences() != null) {
            Element resourceExtensionReferencesSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ResourceExtensionReferences");
            for (ResourceExtensionReference resourceExtensionReferencesItem : parameters.getResourceExtensionReferences()) {
                Element resourceExtensionReferenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ResourceExtensionReference");
                resourceExtensionReferencesSequenceElement.appendChild(resourceExtensionReferenceElement);
                
                if (resourceExtensionReferencesItem.getReferenceName() != null) {
                    Element referenceNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ReferenceName");
                    referenceNameElement.appendChild(requestDoc.createTextNode(resourceExtensionReferencesItem.getReferenceName()));
                    resourceExtensionReferenceElement.appendChild(referenceNameElement);
                }
                
                if (resourceExtensionReferencesItem.getPublisher() != null) {
                    Element publisherElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Publisher");
                    publisherElement.appendChild(requestDoc.createTextNode(resourceExtensionReferencesItem.getPublisher()));
                    resourceExtensionReferenceElement.appendChild(publisherElement);
                }
                
                if (resourceExtensionReferencesItem.getName() != null) {
                    Element nameElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Name");
                    nameElement2.appendChild(requestDoc.createTextNode(resourceExtensionReferencesItem.getName()));
                    resourceExtensionReferenceElement.appendChild(nameElement2);
                }
                
                if (resourceExtensionReferencesItem.getVersion() != null) {
                    Element versionElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Version");
                    versionElement.appendChild(requestDoc.createTextNode(resourceExtensionReferencesItem.getVersion()));
                    resourceExtensionReferenceElement.appendChild(versionElement);
                }
                
                if (resourceExtensionReferencesItem.getResourceExtensionParameterValues() != null) {
                    Element resourceExtensionParameterValuesSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ResourceExtensionParameterValues");
                    for (ResourceExtensionParameterValue resourceExtensionParameterValuesItem : resourceExtensionReferencesItem.getResourceExtensionParameterValues()) {
                        Element resourceExtensionParameterValueElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ResourceExtensionParameterValue");
                        resourceExtensionParameterValuesSequenceElement.appendChild(resourceExtensionParameterValueElement);
                        
                        if (resourceExtensionParameterValuesItem.getKey() != null) {
                            Element keyElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Key");
                            keyElement.appendChild(requestDoc.createTextNode(resourceExtensionParameterValuesItem.getKey()));
                            resourceExtensionParameterValueElement.appendChild(keyElement);
                        }
                        
                        if (resourceExtensionParameterValuesItem.getValue() != null) {
                            Element valueElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Value");
                            valueElement.appendChild(requestDoc.createTextNode(new String(Base64.encodeBase64(resourceExtensionParameterValuesItem.getValue().getBytes()))));
                            resourceExtensionParameterValueElement.appendChild(valueElement);
                        }
                        
                        if (resourceExtensionParameterValuesItem.getType() != null) {
                            Element typeElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Type");
                            typeElement.appendChild(requestDoc.createTextNode(resourceExtensionParameterValuesItem.getType().toString()));
                            resourceExtensionParameterValueElement.appendChild(typeElement);
                        }
                    }
                    resourceExtensionReferenceElement.appendChild(resourceExtensionParameterValuesSequenceElement);
                }
                
                if (resourceExtensionReferencesItem.getState() != null) {
                    Element stateElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "State");
                    stateElement.appendChild(requestDoc.createTextNode(resourceExtensionReferencesItem.getState().toString()));
                    resourceExtensionReferenceElement.appendChild(stateElement);
                }
            }
            persistentVMRoleElement.appendChild(resourceExtensionReferencesSequenceElement);
        }
        
        if (parameters.getDataVirtualHardDisks() != null) {
            Element dataVirtualHardDisksSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DataVirtualHardDisks");
            for (DataVirtualHardDisk dataVirtualHardDisksItem : parameters.getDataVirtualHardDisks()) {
                Element dataVirtualHardDiskElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DataVirtualHardDisk");
                dataVirtualHardDisksSequenceElement.appendChild(dataVirtualHardDiskElement);
                
                if (dataVirtualHardDisksItem.getHostCaching() != null) {
                    Element hostCachingElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "HostCaching");
                    hostCachingElement.appendChild(requestDoc.createTextNode(dataVirtualHardDisksItem.getHostCaching().toString()));
                    dataVirtualHardDiskElement.appendChild(hostCachingElement);
                }
                
                if (dataVirtualHardDisksItem.getDiskLabel() != null) {
                    Element diskLabelElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DiskLabel");
                    diskLabelElement.appendChild(requestDoc.createTextNode(dataVirtualHardDisksItem.getDiskLabel()));
                    dataVirtualHardDiskElement.appendChild(diskLabelElement);
                }
                
                if (dataVirtualHardDisksItem.getDiskName() != null) {
                    Element diskNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DiskName");
                    diskNameElement.appendChild(requestDoc.createTextNode(dataVirtualHardDisksItem.getDiskName()));
                    dataVirtualHardDiskElement.appendChild(diskNameElement);
                }
                
                if (dataVirtualHardDisksItem.getLogicalUnitNumber() != null) {
                    Element lunElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Lun");
                    lunElement.appendChild(requestDoc.createTextNode(Integer.toString(dataVirtualHardDisksItem.getLogicalUnitNumber())));
                    dataVirtualHardDiskElement.appendChild(lunElement);
                }
                
                Element logicalDiskSizeInGBElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "LogicalDiskSizeInGB");
                logicalDiskSizeInGBElement.appendChild(requestDoc.createTextNode(Integer.toString(dataVirtualHardDisksItem.getLogicalDiskSizeInGB())));
                dataVirtualHardDiskElement.appendChild(logicalDiskSizeInGBElement);
                
                if (dataVirtualHardDisksItem.getMediaLink() != null) {
                    Element mediaLinkElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "MediaLink");
                    mediaLinkElement.appendChild(requestDoc.createTextNode(dataVirtualHardDisksItem.getMediaLink().toString()));
                    dataVirtualHardDiskElement.appendChild(mediaLinkElement);
                }
            }
            persistentVMRoleElement.appendChild(dataVirtualHardDisksSequenceElement);
        }
        
        Element oSVirtualHardDiskElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "OSVirtualHardDisk");
        persistentVMRoleElement.appendChild(oSVirtualHardDiskElement);
        
        if (parameters.getOSVirtualHardDisk().getHostCaching() != null) {
            Element hostCachingElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "HostCaching");
            hostCachingElement2.appendChild(requestDoc.createTextNode(parameters.getOSVirtualHardDisk().getHostCaching().toString()));
            oSVirtualHardDiskElement.appendChild(hostCachingElement2);
        }
        
        if (parameters.getOSVirtualHardDisk().getDiskLabel() != null) {
            Element diskLabelElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DiskLabel");
            diskLabelElement2.appendChild(requestDoc.createTextNode(parameters.getOSVirtualHardDisk().getDiskLabel()));
            oSVirtualHardDiskElement.appendChild(diskLabelElement2);
        }
        
        if (parameters.getOSVirtualHardDisk().getDiskName() != null) {
            Element diskNameElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "DiskName");
            diskNameElement2.appendChild(requestDoc.createTextNode(parameters.getOSVirtualHardDisk().getDiskName()));
            oSVirtualHardDiskElement.appendChild(diskNameElement2);
        }
        
        if (parameters.getOSVirtualHardDisk().getMediaLink() != null) {
            Element mediaLinkElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "MediaLink");
            mediaLinkElement2.appendChild(requestDoc.createTextNode(parameters.getOSVirtualHardDisk().getMediaLink().toString()));
            oSVirtualHardDiskElement.appendChild(mediaLinkElement2);
        }
        
        if (parameters.getOSVirtualHardDisk().getSourceImageName() != null) {
            Element sourceImageNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "SourceImageName");
            sourceImageNameElement.appendChild(requestDoc.createTextNode(parameters.getOSVirtualHardDisk().getSourceImageName()));
            oSVirtualHardDiskElement.appendChild(sourceImageNameElement);
        }
        
        if (parameters.getOSVirtualHardDisk().getOperatingSystem() != null) {
            Element osElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "OS");
            osElement.appendChild(requestDoc.createTextNode(parameters.getOSVirtualHardDisk().getOperatingSystem()));
            oSVirtualHardDiskElement.appendChild(osElement);
        }
        
        if (parameters.getRoleSize() != null) {
            Element roleSizeElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "RoleSize");
            roleSizeElement.appendChild(requestDoc.createTextNode(parameters.getRoleSize()));
            persistentVMRoleElement.appendChild(roleSizeElement);
        }
        
        if (parameters.isProvisionGuestAgent() != null) {
            Element provisionGuestAgentElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "ProvisionGuestAgent");
            provisionGuestAgentElement.appendChild(requestDoc.createTextNode(Boolean.toString(parameters.isProvisionGuestAgent()).toLowerCase()));
            persistentVMRoleElement.appendChild(provisionGuestAgentElement);
        }
        
        DOMSource domSource = new DOMSource(requestDoc);
        StringWriter stringWriter = new StringWriter();
        StreamResult streamResult = new StreamResult(stringWriter);
        TransformerFactory transformerFactory = TransformerFactory.newInstance();
        Transformer transformer = transformerFactory.newTransformer();
        transformer.transform(domSource, streamResult);
        requestContent = stringWriter.toString();
        StringEntity entity = new StringEntity(requestContent);
        httpRequest.setEntity(entity);
        httpRequest.setHeader("Content-Type", "application/xml");
        
        // Send Request
        HttpResponse httpResponse = null;
        try {
            if (shouldTrace) {
                CloudTracing.sendRequest(invocationId, httpRequest);
            }
            httpResponse = this.getClient().getHttpClient().execute(httpRequest);
            if (shouldTrace) {
                CloudTracing.receiveResponse(invocationId, httpResponse);
            }
            int statusCode = httpResponse.getStatusLine().getStatusCode();
            if (statusCode != HttpStatus.SC_ACCEPTED) {
                ServiceException ex = ServiceException.createFromXml(httpRequest, requestContent, httpResponse, httpResponse.getEntity());
                if (shouldTrace) {
                    CloudTracing.error(invocationId, ex);
                }
                throw ex;
            }
            
            // Create Result
            OperationResponse result = null;
            result = new OperationResponse();
            result.setStatusCode(statusCode);
            if (httpResponse.getHeaders("x-ms-request-id").length > 0) {
                result.setRequestId(httpResponse.getFirstHeader("x-ms-request-id").getValue());
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            return result;
        } finally {
            if (httpResponse != null && httpResponse.getEntity() != null) {
                httpResponse.getEntity().getContent().close();
            }
        }
    }
    
    /**
    * The UpdateLoadBalancedEndpointSet operation changes the specified
    * load-balanced InputEndpoints on all the roles of an Infrastructure as a
    * Service deployment. Non load-balanced endpoints must be changed using
    * UpdateRole.
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param parameters Parameters supplied to the Update Load Balanced
    * Endpoint Set operation.
    * @return A standard service response including an HTTP status code and
    * request ID.
    */
    @Override
    public Future<OperationResponse> beginUpdatingLoadBalancedEndpointSetAsync(final String serviceName, final String deploymentName, final VirtualMachineUpdateLoadBalancedSetParameters parameters) {
        return this.getClient().getExecutorService().submit(new Callable<OperationResponse>() { 
            @Override
            public OperationResponse call() throws Exception {
                return beginUpdatingLoadBalancedEndpointSet(serviceName, deploymentName, parameters);
            }
         });
    }
    
    /**
    * The UpdateLoadBalancedEndpointSet operation changes the specified
    * load-balanced InputEndpoints on all the roles of an Infrastructure as a
    * Service deployment. Non load-balanced endpoints must be changed using
    * UpdateRole.
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param parameters Parameters supplied to the Update Load Balanced
    * Endpoint Set operation.
    * @throws ParserConfigurationException Thrown if there was an error
    * configuring the parser for the response body.
    * @throws SAXException Thrown if there was an error parsing the response
    * body.
    * @throws TransformerException Thrown if there was an error creating the
    * DOM transformer.
    * @throws IOException Signals that an I/O exception of some sort has
    * occurred. This class is the general class of exceptions produced by
    * failed or interrupted I/O operations.
    * @throws ServiceException Thrown if an unexpected response is found.
    * @return A standard service response including an HTTP status code and
    * request ID.
    */
    @Override
    public OperationResponse beginUpdatingLoadBalancedEndpointSet(String serviceName, String deploymentName, VirtualMachineUpdateLoadBalancedSetParameters parameters) throws ParserConfigurationException, SAXException, TransformerException, IOException, ServiceException {
        // Validate
        if (serviceName == null) {
            throw new NullPointerException("serviceName");
        }
        if (deploymentName == null) {
            throw new NullPointerException("deploymentName");
        }
        if (parameters == null) {
            throw new NullPointerException("parameters");
        }
        if (parameters.getLoadBalancedEndpoints() != null) {
            for (VirtualMachineUpdateLoadBalancedSetParameters.InputEndpoint loadBalancedEndpointsParameterItem : parameters.getLoadBalancedEndpoints()) {
                if (loadBalancedEndpointsParameterItem.getLoadBalancedEndpointSetName() == null) {
                    throw new NullPointerException("parameters.LoadBalancedEndpoints.LoadBalancedEndpointSetName");
                }
            }
        }
        
        // Tracing
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("deploymentName", deploymentName);
            tracingParameters.put("parameters", parameters);
            CloudTracing.enter(invocationId, this, "beginUpdatingLoadBalancedEndpointSetAsync", tracingParameters);
        }
        
        // Construct URL
        String url = this.getClient().getBaseUri() + "/" + this.getClient().getCredentials().getSubscriptionId() + "/services/hostedservices/" + serviceName + "/deployments/" + deploymentName + "?" + "comp=UpdateLbSet";
        
        // Create HTTP transport objects
        HttpPost httpRequest = new HttpPost(url);
        
        // Set Headers
        httpRequest.setHeader("Content-Type", "application/xml");
        httpRequest.setHeader("x-ms-version", "2013-11-01");
        
        // Serialize Request
        String requestContent = null;
        DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();
        DocumentBuilder documentBuilder = documentBuilderFactory.newDocumentBuilder();
        Document requestDoc = documentBuilder.newDocument();
        
        Element loadBalancedEndpointListElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "LoadBalancedEndpointList");
        requestDoc.appendChild(loadBalancedEndpointListElement);
        
        if (parameters.getLoadBalancedEndpoints() != null) {
            for (VirtualMachineUpdateLoadBalancedSetParameters.InputEndpoint loadBalancedEndpointsItem : parameters.getLoadBalancedEndpoints()) {
                Element inputEndpointElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "InputEndpoint");
                loadBalancedEndpointListElement.appendChild(inputEndpointElement);
                
                Element loadBalancedEndpointSetNameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "LoadBalancedEndpointSetName");
                loadBalancedEndpointSetNameElement.appendChild(requestDoc.createTextNode(loadBalancedEndpointsItem.getLoadBalancedEndpointSetName()));
                inputEndpointElement.appendChild(loadBalancedEndpointSetNameElement);
                
                if (loadBalancedEndpointsItem.getLocalPort() != null) {
                    Element localPortElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "LocalPort");
                    localPortElement.appendChild(requestDoc.createTextNode(Integer.toString(loadBalancedEndpointsItem.getLocalPort())));
                    inputEndpointElement.appendChild(localPortElement);
                }
                
                if (loadBalancedEndpointsItem.getName() != null) {
                    Element nameElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Name");
                    nameElement.appendChild(requestDoc.createTextNode(loadBalancedEndpointsItem.getName()));
                    inputEndpointElement.appendChild(nameElement);
                }
                
                if (loadBalancedEndpointsItem.getPort() != null) {
                    Element portElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Port");
                    portElement.appendChild(requestDoc.createTextNode(Integer.toString(loadBalancedEndpointsItem.getPort())));
                    inputEndpointElement.appendChild(portElement);
                }
                
                if (loadBalancedEndpointsItem.getLoadBalancerProbe() != null) {
                    Element loadBalancerProbeElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "LoadBalancerProbe");
                    inputEndpointElement.appendChild(loadBalancerProbeElement);
                    
                    if (loadBalancedEndpointsItem.getLoadBalancerProbe().getPath() != null) {
                        Element pathElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Path");
                        pathElement.appendChild(requestDoc.createTextNode(loadBalancedEndpointsItem.getLoadBalancerProbe().getPath()));
                        loadBalancerProbeElement.appendChild(pathElement);
                    }
                    
                    Element portElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Port");
                    portElement2.appendChild(requestDoc.createTextNode(Integer.toString(loadBalancedEndpointsItem.getLoadBalancerProbe().getPort())));
                    loadBalancerProbeElement.appendChild(portElement2);
                    
                    Element protocolElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Protocol");
                    protocolElement.appendChild(requestDoc.createTextNode(ComputeManagementClientImpl.loadBalancerProbeTransportProtocolToString(loadBalancedEndpointsItem.getLoadBalancerProbe().getProtocol())));
                    loadBalancerProbeElement.appendChild(protocolElement);
                    
                    if (loadBalancedEndpointsItem.getLoadBalancerProbe().getIntervalInSeconds() != null) {
                        Element intervalInSecondsElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "IntervalInSeconds");
                        intervalInSecondsElement.appendChild(requestDoc.createTextNode(Integer.toString(loadBalancedEndpointsItem.getLoadBalancerProbe().getIntervalInSeconds())));
                        loadBalancerProbeElement.appendChild(intervalInSecondsElement);
                    }
                    
                    if (loadBalancedEndpointsItem.getLoadBalancerProbe().getTimeoutInSeconds() != null) {
                        Element timeoutInSecondsElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "TimeoutInSeconds");
                        timeoutInSecondsElement.appendChild(requestDoc.createTextNode(Integer.toString(loadBalancedEndpointsItem.getLoadBalancerProbe().getTimeoutInSeconds())));
                        loadBalancerProbeElement.appendChild(timeoutInSecondsElement);
                    }
                }
                
                if (loadBalancedEndpointsItem.getProtocol() != null) {
                    Element protocolElement2 = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Protocol");
                    protocolElement2.appendChild(requestDoc.createTextNode(loadBalancedEndpointsItem.getProtocol()));
                    inputEndpointElement.appendChild(protocolElement2);
                }
                
                if (loadBalancedEndpointsItem.getVirtualIPAddress() != null) {
                    Element vipElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Vip");
                    vipElement.appendChild(requestDoc.createTextNode(loadBalancedEndpointsItem.getVirtualIPAddress().getHostAddress()));
                    inputEndpointElement.appendChild(vipElement);
                }
                
                if (loadBalancedEndpointsItem.isEnableDirectServerReturn() != null) {
                    Element enableDirectServerReturnElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "EnableDirectServerReturn");
                    enableDirectServerReturnElement.appendChild(requestDoc.createTextNode(Boolean.toString(loadBalancedEndpointsItem.isEnableDirectServerReturn()).toLowerCase()));
                    inputEndpointElement.appendChild(enableDirectServerReturnElement);
                }
                
                Element endpointAclElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "EndpointAcl");
                inputEndpointElement.appendChild(endpointAclElement);
                
                if (loadBalancedEndpointsItem.getRules() != null) {
                    Element rulesSequenceElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Rules");
                    for (AccessControlListRule rulesItem : loadBalancedEndpointsItem.getRules()) {
                        Element ruleElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Rule");
                        rulesSequenceElement.appendChild(ruleElement);
                        
                        if (rulesItem.getOrder() != null) {
                            Element orderElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Order");
                            orderElement.appendChild(requestDoc.createTextNode(Integer.toString(rulesItem.getOrder())));
                            ruleElement.appendChild(orderElement);
                        }
                        
                        if (rulesItem.getAction() != null) {
                            Element actionElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Action");
                            actionElement.appendChild(requestDoc.createTextNode(rulesItem.getAction()));
                            ruleElement.appendChild(actionElement);
                        }
                        
                        if (rulesItem.getRemoteSubnet() != null) {
                            Element remoteSubnetElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "RemoteSubnet");
                            remoteSubnetElement.appendChild(requestDoc.createTextNode(rulesItem.getRemoteSubnet()));
                            ruleElement.appendChild(remoteSubnetElement);
                        }
                        
                        if (rulesItem.getDescription() != null) {
                            Element descriptionElement = requestDoc.createElementNS("http://schemas.microsoft.com/windowsazure", "Description");
                            descriptionElement.appendChild(requestDoc.createTextNode(rulesItem.getDescription()));
                            ruleElement.appendChild(descriptionElement);
                        }
                    }
                    endpointAclElement.appendChild(rulesSequenceElement);
                }
            }
        }
        
        DOMSource domSource = new DOMSource(requestDoc);
        StringWriter stringWriter = new StringWriter();
        StreamResult streamResult = new StreamResult(stringWriter);
        TransformerFactory transformerFactory = TransformerFactory.newInstance();
        Transformer transformer = transformerFactory.newTransformer();
        transformer.transform(domSource, streamResult);
        requestContent = stringWriter.toString();
        StringEntity entity = new StringEntity(requestContent);
        httpRequest.setEntity(entity);
        httpRequest.setHeader("Content-Type", "application/xml");
        
        // Send Request
        HttpResponse httpResponse = null;
        try {
            if (shouldTrace) {
                CloudTracing.sendRequest(invocationId, httpRequest);
            }
            httpResponse = this.getClient().getHttpClient().execute(httpRequest);
            if (shouldTrace) {
                CloudTracing.receiveResponse(invocationId, httpResponse);
            }
            int statusCode = httpResponse.getStatusLine().getStatusCode();
            if (statusCode != HttpStatus.SC_ACCEPTED) {
                ServiceException ex = ServiceException.createFromXml(httpRequest, requestContent, httpResponse, httpResponse.getEntity());
                if (shouldTrace) {
                    CloudTracing.error(invocationId, ex);
                }
                throw ex;
            }
            
            // Create Result
            OperationResponse result = null;
            result = new OperationResponse();
            result.setStatusCode(statusCode);
            if (httpResponse.getHeaders("x-ms-request-id").length > 0) {
                result.setRequestId(httpResponse.getFirstHeader("x-ms-request-id").getValue());
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            return result;
        } finally {
            if (httpResponse != null && httpResponse.getEntity() != null) {
                httpResponse.getEntity().getContent().close();
            }
        }
    }
    
    /**
    * The Capture Role operation creates a copy of the operating system virtual
    * hard disk (VHD) that is deployed in the virtual machine, saves the VHD
    * copy in the same storage location as the operating system VHD, and
    * registers the copy as an image in your image gallery. From the captured
    * image, you can create additional customized virtual machines. For more
    * information about images and disks, see Manage Disks and Images. For
    * more information about capturing images, see How to Capture an Image of
    * a Virtual Machine Running Windows Server 2008 R2 or How to Capture an
    * Image of a Virtual Machine Running Linux.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157201.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine to restart.
    * @param parameters Parameters supplied to the Capture Virtual Machine
    * operation.
    * @return The response body contains the status of the specified
    * asynchronous operation, indicating whether it has succeeded, is
    * inprogress, or has failed. Note that this status is distinct from the
    * HTTP status code returned for the Get Operation Status operation itself.
    * If the asynchronous operation succeeded, the response body includes the
    * HTTP status code for the successful request.  If the asynchronous
    * operation failed, the response body includes the HTTP status code for
    * the failed request, and also includes error information regarding the
    * failure.
    */
    @Override
    public Future<ComputeOperationStatusResponse> captureAsync(final String serviceName, final String deploymentName, final String virtualMachineName, final VirtualMachineCaptureParameters parameters) {
        return this.getClient().getExecutorService().submit(new Callable<ComputeOperationStatusResponse>() { 
            @Override
            public ComputeOperationStatusResponse call() throws Exception {
                return capture(serviceName, deploymentName, virtualMachineName, parameters);
            }
         });
    }
    
    /**
    * The Capture Role operation creates a copy of the operating system virtual
    * hard disk (VHD) that is deployed in the virtual machine, saves the VHD
    * copy in the same storage location as the operating system VHD, and
    * registers the copy as an image in your image gallery. From the captured
    * image, you can create additional customized virtual machines. For more
    * information about images and disks, see Manage Disks and Images. For
    * more information about capturing images, see How to Capture an Image of
    * a Virtual Machine Running Windows Server 2008 R2 or How to Capture an
    * Image of a Virtual Machine Running Linux.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157201.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine to restart.
    * @param parameters Parameters supplied to the Capture Virtual Machine
    * operation.
    * @throws InterruptedException Thrown when a thread is waiting, sleeping,
    * or otherwise occupied, and the thread is interrupted, either before or
    * during the activity. Occasionally a method may wish to test whether the
    * current thread has been interrupted, and if so, to immediately throw
    * this exception. The following code can be used to achieve this effect:
    * @throws ExecutionException Thrown when attempting to retrieve the result
    * of a task that aborted by throwing an exception. This exception can be
    * inspected using the Throwable.getCause() method.
    * @throws ServiceException Thrown if the server returned an error for the
    * request.
    * @throws IOException Thrown if there was an error setting up tracing for
    * the request.
    * @return The response body contains the status of the specified
    * asynchronous operation, indicating whether it has succeeded, is
    * inprogress, or has failed. Note that this status is distinct from the
    * HTTP status code returned for the Get Operation Status operation itself.
    * If the asynchronous operation succeeded, the response body includes the
    * HTTP status code for the successful request.  If the asynchronous
    * operation failed, the response body includes the HTTP status code for
    * the failed request, and also includes error information regarding the
    * failure.
    */
    @Override
    public ComputeOperationStatusResponse capture(String serviceName, String deploymentName, String virtualMachineName, VirtualMachineCaptureParameters parameters) throws InterruptedException, ExecutionException, ServiceException, IOException {
        ComputeManagementClient client2 = this.getClient();
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("deploymentName", deploymentName);
            tracingParameters.put("virtualMachineName", virtualMachineName);
            tracingParameters.put("parameters", parameters);
            CloudTracing.enter(invocationId, this, "captureAsync", tracingParameters);
        }
        try {
            if (shouldTrace) {
                client2 = this.getClient().withRequestFilterLast(new ClientRequestTrackingHandler(invocationId)).withResponseFilterLast(new ClientRequestTrackingHandler(invocationId));
            }
            
            OperationResponse response = client2.getVirtualMachinesOperations().beginCapturingAsync(serviceName, deploymentName, virtualMachineName, parameters).get();
            ComputeOperationStatusResponse result = client2.getOperationStatusAsync(response.getRequestId()).get();
            int delayInSeconds = 30;
            while ((result.getStatus() != OperationStatus.InProgress) == false) {
                Thread.sleep(delayInSeconds * 1000);
                result = client2.getOperationStatusAsync(response.getRequestId()).get();
                delayInSeconds = 30;
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            
            if (result.getStatus() != OperationStatus.Succeeded) {
                if (result.getError() != null) {
                    ServiceException ex = new ServiceException(result.getError().getCode() + " : " + result.getError().getMessage());
                    ex.setErrorCode(result.getError().getCode());
                    ex.setErrorMessage(result.getError().getMessage());
                    if (shouldTrace) {
                        CloudTracing.error(invocationId, ex);
                    }
                    throw ex;
                } else {
                    ServiceException ex = new ServiceException("");
                    if (shouldTrace) {
                        CloudTracing.error(invocationId, ex);
                    }
                    throw ex;
                }
            }
            
            return result;
        } finally {
            if (this.getClient() != null && shouldTrace) {
                this.getClient().close();
            }
        }
    }
    
    /**
    * The Add Role operation adds a virtual machine to an existing deployment.
    * You can refer to the OSDisk in the Add Role operation in the following
    * ways.  Platform/User Image – Set the SourceImageName to a platform or
    * user image. You can optionally specify the DiskName and MediaLink values
    * as part the operation to control the name and location of target disk.
    * When DiskName and MediaLink are specified in this mode, they must not
    * already exist in the system, otherwise a conflict fault is returned.
    * UserDisk – Set DiskName to a user supplied image in image repository.
    * SourceImageName must be set to NULL. All other properties are ignored.
    * Blob in a Storage Account – Set MediaLink to a blob containing the
    * image. SourceImageName and DiskName are set to NULL.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157186.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param parameters Parameters supplied to the Create Virtual Machine
    * operation.
    * @return The response body contains the status of the specified
    * asynchronous operation, indicating whether it has succeeded, is
    * inprogress, or has failed. Note that this status is distinct from the
    * HTTP status code returned for the Get Operation Status operation itself.
    * If the asynchronous operation succeeded, the response body includes the
    * HTTP status code for the successful request.  If the asynchronous
    * operation failed, the response body includes the HTTP status code for
    * the failed request, and also includes error information regarding the
    * failure.
    */
    @Override
    public Future<ComputeOperationStatusResponse> createAsync(final String serviceName, final String deploymentName, final VirtualMachineCreateParameters parameters) {
        return this.getClient().getExecutorService().submit(new Callable<ComputeOperationStatusResponse>() { 
            @Override
            public ComputeOperationStatusResponse call() throws Exception {
                return create(serviceName, deploymentName, parameters);
            }
         });
    }
    
    /**
    * The Add Role operation adds a virtual machine to an existing deployment.
    * You can refer to the OSDisk in the Add Role operation in the following
    * ways.  Platform/User Image – Set the SourceImageName to a platform or
    * user image. You can optionally specify the DiskName and MediaLink values
    * as part the operation to control the name and location of target disk.
    * When DiskName and MediaLink are specified in this mode, they must not
    * already exist in the system, otherwise a conflict fault is returned.
    * UserDisk – Set DiskName to a user supplied image in image repository.
    * SourceImageName must be set to NULL. All other properties are ignored.
    * Blob in a Storage Account – Set MediaLink to a blob containing the
    * image. SourceImageName and DiskName are set to NULL.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157186.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param parameters Parameters supplied to the Create Virtual Machine
    * operation.
    * @throws InterruptedException Thrown when a thread is waiting, sleeping,
    * or otherwise occupied, and the thread is interrupted, either before or
    * during the activity. Occasionally a method may wish to test whether the
    * current thread has been interrupted, and if so, to immediately throw
    * this exception. The following code can be used to achieve this effect:
    * @throws ExecutionException Thrown when attempting to retrieve the result
    * of a task that aborted by throwing an exception. This exception can be
    * inspected using the Throwable.getCause() method.
    * @throws ServiceException Thrown if the server returned an error for the
    * request.
    * @throws IOException Thrown if there was an error setting up tracing for
    * the request.
    * @throws ParserConfigurationException Thrown if there was an error
    * configuring the parser for the response body.
    * @throws SAXException Thrown if there was an error parsing the response
    * body.
    * @throws TransformerException Thrown if there was an error creating the
    * DOM transformer.
    * @throws ServiceException Thrown if an unexpected response is found.
    * @throws URISyntaxException Thrown if there was an error parsing a URI in
    * the response.
    * @return The response body contains the status of the specified
    * asynchronous operation, indicating whether it has succeeded, is
    * inprogress, or has failed. Note that this status is distinct from the
    * HTTP status code returned for the Get Operation Status operation itself.
    * If the asynchronous operation succeeded, the response body includes the
    * HTTP status code for the successful request.  If the asynchronous
    * operation failed, the response body includes the HTTP status code for
    * the failed request, and also includes error information regarding the
    * failure.
    */
    @Override
    public ComputeOperationStatusResponse create(String serviceName, String deploymentName, VirtualMachineCreateParameters parameters) throws InterruptedException, ExecutionException, ServiceException, IOException, ParserConfigurationException, SAXException, TransformerException, ServiceException, URISyntaxException {
        ComputeManagementClient client2 = this.getClient();
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("deploymentName", deploymentName);
            tracingParameters.put("parameters", parameters);
            CloudTracing.enter(invocationId, this, "createAsync", tracingParameters);
        }
        try {
            if (shouldTrace) {
                client2 = this.getClient().withRequestFilterLast(new ClientRequestTrackingHandler(invocationId)).withResponseFilterLast(new ClientRequestTrackingHandler(invocationId));
            }
            
            OperationResponse response = client2.getVirtualMachinesOperations().beginCreatingAsync(serviceName, deploymentName, parameters).get();
            ComputeOperationStatusResponse result = client2.getOperationStatusAsync(response.getRequestId()).get();
            int delayInSeconds = 30;
            while ((result.getStatus() != OperationStatus.InProgress) == false) {
                Thread.sleep(delayInSeconds * 1000);
                result = client2.getOperationStatusAsync(response.getRequestId()).get();
                delayInSeconds = 30;
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            
            if (result.getStatus() != OperationStatus.Succeeded) {
                if (result.getError() != null) {
                    ServiceException ex = new ServiceException(result.getError().getCode() + " : " + result.getError().getMessage());
                    ex.setErrorCode(result.getError().getCode());
                    ex.setErrorMessage(result.getError().getMessage());
                    if (shouldTrace) {
                        CloudTracing.error(invocationId, ex);
                    }
                    throw ex;
                } else {
                    ServiceException ex = new ServiceException("");
                    if (shouldTrace) {
                        CloudTracing.error(invocationId, ex);
                    }
                    throw ex;
                }
            }
            
            return result;
        } finally {
            if (this.getClient() != null && shouldTrace) {
                this.getClient().close();
            }
        }
    }
    
    /**
    * The Create Virtual Machine Deployment operation provisions a virtual
    * machine based on the supplied configuration.  When you create a
    * deployment of a virtual machine, you should make sure that the cloud
    * service and the disk or image that you use are located in the same
    * region. For example, if the cloud service was created in the West US
    * region, the disk or image that you use should also be located in a
    * stor4age account in the West US region.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157194.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param parameters Parameters supplied to the Create Virtual Machine
    * Deployment operation.
    * @return The response body contains the status of the specified
    * asynchronous operation, indicating whether it has succeeded, is
    * inprogress, or has failed. Note that this status is distinct from the
    * HTTP status code returned for the Get Operation Status operation itself.
    * If the asynchronous operation succeeded, the response body includes the
    * HTTP status code for the successful request.  If the asynchronous
    * operation failed, the response body includes the HTTP status code for
    * the failed request, and also includes error information regarding the
    * failure.
    */
    @Override
    public Future<ComputeOperationStatusResponse> createDeploymentAsync(final String serviceName, final VirtualMachineCreateDeploymentParameters parameters) {
        return this.getClient().getExecutorService().submit(new Callable<ComputeOperationStatusResponse>() { 
            @Override
            public ComputeOperationStatusResponse call() throws Exception {
                return createDeployment(serviceName, parameters);
            }
         });
    }
    
    /**
    * The Create Virtual Machine Deployment operation provisions a virtual
    * machine based on the supplied configuration.  When you create a
    * deployment of a virtual machine, you should make sure that the cloud
    * service and the disk or image that you use are located in the same
    * region. For example, if the cloud service was created in the West US
    * region, the disk or image that you use should also be located in a
    * stor4age account in the West US region.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157194.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param parameters Parameters supplied to the Create Virtual Machine
    * Deployment operation.
    * @throws InterruptedException Thrown when a thread is waiting, sleeping,
    * or otherwise occupied, and the thread is interrupted, either before or
    * during the activity. Occasionally a method may wish to test whether the
    * current thread has been interrupted, and if so, to immediately throw
    * this exception. The following code can be used to achieve this effect:
    * @throws ExecutionException Thrown when attempting to retrieve the result
    * of a task that aborted by throwing an exception. This exception can be
    * inspected using the Throwable.getCause() method.
    * @throws ServiceException Thrown if the server returned an error for the
    * request.
    * @throws IOException Thrown if there was an error setting up tracing for
    * the request.
    * @return The response body contains the status of the specified
    * asynchronous operation, indicating whether it has succeeded, is
    * inprogress, or has failed. Note that this status is distinct from the
    * HTTP status code returned for the Get Operation Status operation itself.
    * If the asynchronous operation succeeded, the response body includes the
    * HTTP status code for the successful request.  If the asynchronous
    * operation failed, the response body includes the HTTP status code for
    * the failed request, and also includes error information regarding the
    * failure.
    */
    @Override
    public ComputeOperationStatusResponse createDeployment(String serviceName, VirtualMachineCreateDeploymentParameters parameters) throws InterruptedException, ExecutionException, ServiceException, IOException {
        ComputeManagementClient client2 = this.getClient();
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("parameters", parameters);
            CloudTracing.enter(invocationId, this, "createDeploymentAsync", tracingParameters);
        }
        try {
            if (shouldTrace) {
                client2 = this.getClient().withRequestFilterLast(new ClientRequestTrackingHandler(invocationId)).withResponseFilterLast(new ClientRequestTrackingHandler(invocationId));
            }
            
            OperationResponse response = client2.getVirtualMachinesOperations().beginCreatingDeploymentAsync(serviceName, parameters).get();
            ComputeOperationStatusResponse result = client2.getOperationStatusAsync(response.getRequestId()).get();
            int delayInSeconds = 30;
            while ((result.getStatus() != OperationStatus.InProgress) == false) {
                Thread.sleep(delayInSeconds * 1000);
                result = client2.getOperationStatusAsync(response.getRequestId()).get();
                delayInSeconds = 30;
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            
            if (result.getStatus() != OperationStatus.Succeeded) {
                if (result.getError() != null) {
                    ServiceException ex = new ServiceException(result.getError().getCode() + " : " + result.getError().getMessage());
                    ex.setErrorCode(result.getError().getCode());
                    ex.setErrorMessage(result.getError().getMessage());
                    if (shouldTrace) {
                        CloudTracing.error(invocationId, ex);
                    }
                    throw ex;
                } else {
                    ServiceException ex = new ServiceException("");
                    if (shouldTrace) {
                        CloudTracing.error(invocationId, ex);
                    }
                    throw ex;
                }
            }
            
            return result;
        } finally {
            if (this.getClient() != null && shouldTrace) {
                this.getClient().close();
            }
        }
    }
    
    /**
    * The Delete Role operation deletes the specified virtual machine.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157184.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine to delete.
    * @param deleteFromStorage Optional. Specifies that the source blob(s) for
    * the virtual machine should also be deleted from storage.
    * @return The response body contains the status of the specified
    * asynchronous operation, indicating whether it has succeeded, is
    * inprogress, or has failed. Note that this status is distinct from the
    * HTTP status code returned for the Get Operation Status operation itself.
    * If the asynchronous operation succeeded, the response body includes the
    * HTTP status code for the successful request.  If the asynchronous
    * operation failed, the response body includes the HTTP status code for
    * the failed request, and also includes error information regarding the
    * failure.
    */
    @Override
    public Future<ComputeOperationStatusResponse> deleteAsync(final String serviceName, final String deploymentName, final String virtualMachineName, final boolean deleteFromStorage) {
        return this.getClient().getExecutorService().submit(new Callable<ComputeOperationStatusResponse>() { 
            @Override
            public ComputeOperationStatusResponse call() throws Exception {
                return delete(serviceName, deploymentName, virtualMachineName, deleteFromStorage);
            }
         });
    }
    
    /**
    * The Delete Role operation deletes the specified virtual machine.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157184.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine to delete.
    * @param deleteFromStorage Optional. Specifies that the source blob(s) for
    * the virtual machine should also be deleted from storage.
    * @throws IOException Signals that an I/O exception of some sort has
    * occurred. This class is the general class of exceptions produced by
    * failed or interrupted I/O operations.
    * @throws ServiceException Thrown if an unexpected response is found.
    * @throws InterruptedException Thrown when a thread is waiting, sleeping,
    * or otherwise occupied, and the thread is interrupted, either before or
    * during the activity. Occasionally a method may wish to test whether the
    * current thread has been interrupted, and if so, to immediately throw
    * this exception. The following code can be used to achieve this effect:
    * @throws ExecutionException Thrown when attempting to retrieve the result
    * of a task that aborted by throwing an exception. This exception can be
    * inspected using the Throwable.getCause() method.
    * @throws ServiceException Thrown if the server returned an error for the
    * request.
    * @return The response body contains the status of the specified
    * asynchronous operation, indicating whether it has succeeded, is
    * inprogress, or has failed. Note that this status is distinct from the
    * HTTP status code returned for the Get Operation Status operation itself.
    * If the asynchronous operation succeeded, the response body includes the
    * HTTP status code for the successful request.  If the asynchronous
    * operation failed, the response body includes the HTTP status code for
    * the failed request, and also includes error information regarding the
    * failure.
    */
    @Override
    public ComputeOperationStatusResponse delete(String serviceName, String deploymentName, String virtualMachineName, boolean deleteFromStorage) throws IOException, ServiceException, InterruptedException, ExecutionException, ServiceException {
        ComputeManagementClient client2 = this.getClient();
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("deploymentName", deploymentName);
            tracingParameters.put("virtualMachineName", virtualMachineName);
            tracingParameters.put("deleteFromStorage", deleteFromStorage);
            CloudTracing.enter(invocationId, this, "deleteAsync", tracingParameters);
        }
        try {
            if (shouldTrace) {
                client2 = this.getClient().withRequestFilterLast(new ClientRequestTrackingHandler(invocationId)).withResponseFilterLast(new ClientRequestTrackingHandler(invocationId));
            }
            
            OperationResponse response = client2.getVirtualMachinesOperations().beginDeletingAsync(serviceName, deploymentName, virtualMachineName, deleteFromStorage).get();
            ComputeOperationStatusResponse result = client2.getOperationStatusAsync(response.getRequestId()).get();
            int delayInSeconds = 30;
            while ((result.getStatus() != OperationStatus.InProgress) == false) {
                Thread.sleep(delayInSeconds * 1000);
                result = client2.getOperationStatusAsync(response.getRequestId()).get();
                delayInSeconds = 30;
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            
            if (result.getStatus() != OperationStatus.Succeeded) {
                if (result.getError() != null) {
                    ServiceException ex = new ServiceException(result.getError().getCode() + " : " + result.getError().getMessage());
                    ex.setErrorCode(result.getError().getCode());
                    ex.setErrorMessage(result.getError().getMessage());
                    if (shouldTrace) {
                        CloudTracing.error(invocationId, ex);
                    }
                    throw ex;
                } else {
                    ServiceException ex = new ServiceException("");
                    if (shouldTrace) {
                        CloudTracing.error(invocationId, ex);
                    }
                    throw ex;
                }
            }
            
            return result;
        } finally {
            if (this.getClient() != null && shouldTrace) {
                this.getClient().close();
            }
        }
    }
    
    /**
    * The Get Role operation retrieves information about the specified virtual
    * machine.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157193.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine.
    * @return The Get Virtual Machine operation response.
    */
    @Override
    public Future<VirtualMachineGetResponse> getAsync(final String serviceName, final String deploymentName, final String virtualMachineName) {
        return this.getClient().getExecutorService().submit(new Callable<VirtualMachineGetResponse>() { 
            @Override
            public VirtualMachineGetResponse call() throws Exception {
                return get(serviceName, deploymentName, virtualMachineName);
            }
         });
    }
    
    /**
    * The Get Role operation retrieves information about the specified virtual
    * machine.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157193.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine.
    * @throws IOException Signals that an I/O exception of some sort has
    * occurred. This class is the general class of exceptions produced by
    * failed or interrupted I/O operations.
    * @throws ServiceException Thrown if an unexpected response is found.
    * @throws ParserConfigurationException Thrown if there was a serious
    * configuration error with the document parser.
    * @throws SAXException Thrown if there was an error parsing the XML
    * response.
    * @throws URISyntaxException Thrown if there was an error parsing a URI in
    * the response.
    * @return The Get Virtual Machine operation response.
    */
    @Override
    public VirtualMachineGetResponse get(String serviceName, String deploymentName, String virtualMachineName) throws IOException, ServiceException, ParserConfigurationException, SAXException, URISyntaxException {
        // Validate
        if (serviceName == null) {
            throw new NullPointerException("serviceName");
        }
        if (deploymentName == null) {
            throw new NullPointerException("deploymentName");
        }
        if (virtualMachineName == null) {
            throw new NullPointerException("virtualMachineName");
        }
        
        // Tracing
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("deploymentName", deploymentName);
            tracingParameters.put("virtualMachineName", virtualMachineName);
            CloudTracing.enter(invocationId, this, "getAsync", tracingParameters);
        }
        
        // Construct URL
        String url = this.getClient().getBaseUri() + "/" + this.getClient().getCredentials().getSubscriptionId() + "/services/hostedservices/" + serviceName + "/deployments/" + deploymentName + "/roles/" + virtualMachineName;
        
        // Create HTTP transport objects
        HttpGet httpRequest = new HttpGet(url);
        
        // Set Headers
        httpRequest.setHeader("x-ms-version", "2013-11-01");
        
        // Send Request
        HttpResponse httpResponse = null;
        try {
            if (shouldTrace) {
                CloudTracing.sendRequest(invocationId, httpRequest);
            }
            httpResponse = this.getClient().getHttpClient().execute(httpRequest);
            if (shouldTrace) {
                CloudTracing.receiveResponse(invocationId, httpResponse);
            }
            int statusCode = httpResponse.getStatusLine().getStatusCode();
            if (statusCode != HttpStatus.SC_OK) {
                ServiceException ex = ServiceException.createFromXml(httpRequest, null, httpResponse, httpResponse.getEntity());
                if (shouldTrace) {
                    CloudTracing.error(invocationId, ex);
                }
                throw ex;
            }
            
            // Create Result
            VirtualMachineGetResponse result = null;
            // Deserialize Response
            InputStream responseContent = httpResponse.getEntity().getContent();
            result = new VirtualMachineGetResponse();
            DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();
            documentBuilderFactory.setNamespaceAware(true);
            DocumentBuilder documentBuilder = documentBuilderFactory.newDocumentBuilder();
            Document responseDoc = documentBuilder.parse(responseContent);
            
            NodeList elements = XmlUtility.getElementsByTagNameNS(responseDoc, "http://schemas.microsoft.com/windowsazure", "PersistentVMRole");
            Element persistentVMRoleElement = elements.getLength() > 0 ? ((Element) elements.item(0)) : null;
            if (persistentVMRoleElement != null) {
                NodeList elements2 = XmlUtility.getElementsByTagNameNS(persistentVMRoleElement, "http://schemas.microsoft.com/windowsazure", "RoleName");
                Element roleNameElement = elements2.getLength() > 0 ? ((Element) elements2.item(0)) : null;
                if (roleNameElement != null) {
                    String roleNameInstance;
                    roleNameInstance = roleNameElement.getTextContent();
                    result.setRoleName(roleNameInstance);
                }
                
                NodeList elements3 = XmlUtility.getElementsByTagNameNS(persistentVMRoleElement, "http://schemas.microsoft.com/windowsazure", "OsVersion");
                Element osVersionElement = elements3.getLength() > 0 ? ((Element) elements3.item(0)) : null;
                if (osVersionElement != null) {
                    String osVersionInstance;
                    osVersionInstance = osVersionElement.getTextContent();
                    result.setOsVersion(osVersionInstance);
                }
                
                NodeList elements4 = XmlUtility.getElementsByTagNameNS(persistentVMRoleElement, "http://schemas.microsoft.com/windowsazure", "RoleType");
                Element roleTypeElement = elements4.getLength() > 0 ? ((Element) elements4.item(0)) : null;
                if (roleTypeElement != null) {
                    VirtualMachineRoleType roleTypeInstance;
                    roleTypeInstance = VirtualMachineRoleType.valueOf(roleTypeElement.getTextContent());
                    result.setRoleType(roleTypeInstance);
                }
                
                NodeList elements5 = XmlUtility.getElementsByTagNameNS(persistentVMRoleElement, "http://schemas.microsoft.com/windowsazure", "AvailabilitySetName");
                Element availabilitySetNameElement = elements5.getLength() > 0 ? ((Element) elements5.item(0)) : null;
                if (availabilitySetNameElement != null) {
                    String availabilitySetNameInstance;
                    availabilitySetNameInstance = availabilitySetNameElement.getTextContent();
                    result.setAvailabilitySetName(availabilitySetNameInstance);
                }
                
                NodeList elements6 = XmlUtility.getElementsByTagNameNS(persistentVMRoleElement, "http://schemas.microsoft.com/windowsazure", "RoleSize");
                Element roleSizeElement = elements6.getLength() > 0 ? ((Element) elements6.item(0)) : null;
                if (roleSizeElement != null) {
                    String roleSizeInstance;
                    roleSizeInstance = roleSizeElement.getTextContent();
                    result.setRoleSize(roleSizeInstance);
                }
                
                NodeList elements7 = XmlUtility.getElementsByTagNameNS(persistentVMRoleElement, "http://schemas.microsoft.com/windowsazure", "DefaultWinRmCertificateThumbprint");
                Element defaultWinRmCertificateThumbprintElement = elements7.getLength() > 0 ? ((Element) elements7.item(0)) : null;
                if (defaultWinRmCertificateThumbprintElement != null) {
                    String defaultWinRmCertificateThumbprintInstance;
                    defaultWinRmCertificateThumbprintInstance = defaultWinRmCertificateThumbprintElement.getTextContent();
                    result.setDefaultWinRmCertificateThumbprint(defaultWinRmCertificateThumbprintInstance);
                }
                
                NodeList elements8 = XmlUtility.getElementsByTagNameNS(persistentVMRoleElement, "http://schemas.microsoft.com/windowsazure", "ConfigurationSets");
                Element configurationSetsSequenceElement = elements8.getLength() > 0 ? ((Element) elements8.item(0)) : null;
                if (configurationSetsSequenceElement != null) {
                    for (int i1 = 0; i1 < com.microsoft.windowsazure.core.utils.XmlUtility.getElementsByTagNameNS(configurationSetsSequenceElement, "http://schemas.microsoft.com/windowsazure", "ConfigurationSet").getLength(); i1 = i1 + 1) {
                        org.w3c.dom.Element configurationSetsElement = ((org.w3c.dom.Element) com.microsoft.windowsazure.core.utils.XmlUtility.getElementsByTagNameNS(configurationSetsSequenceElement, "http://schemas.microsoft.com/windowsazure", "ConfigurationSet").item(i1));
                        ConfigurationSet configurationSetInstance = new ConfigurationSet();
                        result.getConfigurationSets().add(configurationSetInstance);
                        
                        NodeList elements9 = XmlUtility.getElementsByTagNameNS(configurationSetsElement, "http://schemas.microsoft.com/windowsazure", "ConfigurationSetType");
                        Element configurationSetTypeElement = elements9.getLength() > 0 ? ((Element) elements9.item(0)) : null;
                        if (configurationSetTypeElement != null) {
                            String configurationSetTypeInstance;
                            configurationSetTypeInstance = configurationSetTypeElement.getTextContent();
                            configurationSetInstance.setConfigurationSetType(configurationSetTypeInstance);
                        }
                        
                        NodeList elements10 = XmlUtility.getElementsByTagNameNS(configurationSetsElement, "http://schemas.microsoft.com/windowsazure", "InputEndpoints");
                        Element inputEndpointsSequenceElement = elements10.getLength() > 0 ? ((Element) elements10.item(0)) : null;
                        if (inputEndpointsSequenceElement != null) {
                            for (int i2 = 0; i2 < com.microsoft.windowsazure.core.utils.XmlUtility.getElementsByTagNameNS(inputEndpointsSequenceElement, "http://schemas.microsoft.com/windowsazure", "InputEndpoint").getLength(); i2 = i2 + 1) {
                                org.w3c.dom.Element inputEndpointsElement = ((org.w3c.dom.Element) com.microsoft.windowsazure.core.utils.XmlUtility.getElementsByTagNameNS(inputEndpointsSequenceElement, "http://schemas.microsoft.com/windowsazure", "InputEndpoint").item(i2));
                                InputEndpoint inputEndpointInstance = new InputEndpoint();
                                configurationSetInstance.getInputEndpoints().add(inputEndpointInstance);
                                
                                NodeList elements11 = XmlUtility.getElementsByTagNameNS(inputEndpointsElement, "http://schemas.microsoft.com/windowsazure", "LoadBalancedEndpointSetName");
                                Element loadBalancedEndpointSetNameElement = elements11.getLength() > 0 ? ((Element) elements11.item(0)) : null;
                                if (loadBalancedEndpointSetNameElement != null) {
                                    String loadBalancedEndpointSetNameInstance;
                                    loadBalancedEndpointSetNameInstance = loadBalancedEndpointSetNameElement.getTextContent();
                                    inputEndpointInstance.setLoadBalancedEndpointSetName(loadBalancedEndpointSetNameInstance);
                                }
                                
                                NodeList elements12 = XmlUtility.getElementsByTagNameNS(inputEndpointsElement, "http://schemas.microsoft.com/windowsazure", "LocalPort");
                                Element localPortElement = elements12.getLength() > 0 ? ((Element) elements12.item(0)) : null;
                                if (localPortElement != null && (localPortElement.getTextContent() == null || localPortElement.getTextContent().isEmpty() == true) == false) {
                                    int localPortInstance;
                                    localPortInstance = DatatypeConverter.parseInt(localPortElement.getTextContent());
                                    inputEndpointInstance.setLocalPort(localPortInstance);
                                }
                                
                                NodeList elements13 = XmlUtility.getElementsByTagNameNS(inputEndpointsElement, "http://schemas.microsoft.com/windowsazure", "Name");
                                Element nameElement = elements13.getLength() > 0 ? ((Element) elements13.item(0)) : null;
                                if (nameElement != null) {
                                    String nameInstance;
                                    nameInstance = nameElement.getTextContent();
                                    inputEndpointInstance.setName(nameInstance);
                                }
                                
                                NodeList elements14 = XmlUtility.getElementsByTagNameNS(inputEndpointsElement, "http://schemas.microsoft.com/windowsazure", "Port");
                                Element portElement = elements14.getLength() > 0 ? ((Element) elements14.item(0)) : null;
                                if (portElement != null && (portElement.getTextContent() == null || portElement.getTextContent().isEmpty() == true) == false) {
                                    int portInstance;
                                    portInstance = DatatypeConverter.parseInt(portElement.getTextContent());
                                    inputEndpointInstance.setPort(portInstance);
                                }
                                
                                NodeList elements15 = XmlUtility.getElementsByTagNameNS(inputEndpointsElement, "http://schemas.microsoft.com/windowsazure", "LoadBalancerProbe");
                                Element loadBalancerProbeElement = elements15.getLength() > 0 ? ((Element) elements15.item(0)) : null;
                                if (loadBalancerProbeElement != null) {
                                    LoadBalancerProbe loadBalancerProbeInstance = new LoadBalancerProbe();
                                    inputEndpointInstance.setLoadBalancerProbe(loadBalancerProbeInstance);
                                    
                                    NodeList elements16 = XmlUtility.getElementsByTagNameNS(loadBalancerProbeElement, "http://schemas.microsoft.com/windowsazure", "Path");
                                    Element pathElement = elements16.getLength() > 0 ? ((Element) elements16.item(0)) : null;
                                    if (pathElement != null) {
                                        String pathInstance;
                                        pathInstance = pathElement.getTextContent();
                                        loadBalancerProbeInstance.setPath(pathInstance);
                                    }
                                    
                                    NodeList elements17 = XmlUtility.getElementsByTagNameNS(loadBalancerProbeElement, "http://schemas.microsoft.com/windowsazure", "Port");
                                    Element portElement2 = elements17.getLength() > 0 ? ((Element) elements17.item(0)) : null;
                                    if (portElement2 != null) {
                                        int portInstance2;
                                        portInstance2 = DatatypeConverter.parseInt(portElement2.getTextContent());
                                        loadBalancerProbeInstance.setPort(portInstance2);
                                    }
                                    
                                    NodeList elements18 = XmlUtility.getElementsByTagNameNS(loadBalancerProbeElement, "http://schemas.microsoft.com/windowsazure", "Protocol");
                                    Element protocolElement = elements18.getLength() > 0 ? ((Element) elements18.item(0)) : null;
                                    if (protocolElement != null) {
                                        LoadBalancerProbeTransportProtocol protocolInstance;
                                        protocolInstance = ComputeManagementClientImpl.parseLoadBalancerProbeTransportProtocol(protocolElement.getTextContent());
                                        loadBalancerProbeInstance.setProtocol(protocolInstance);
                                    }
                                    
                                    NodeList elements19 = XmlUtility.getElementsByTagNameNS(loadBalancerProbeElement, "http://schemas.microsoft.com/windowsazure", "IntervalInSeconds");
                                    Element intervalInSecondsElement = elements19.getLength() > 0 ? ((Element) elements19.item(0)) : null;
                                    if (intervalInSecondsElement != null && (intervalInSecondsElement.getTextContent() == null || intervalInSecondsElement.getTextContent().isEmpty() == true) == false) {
                                        int intervalInSecondsInstance;
                                        intervalInSecondsInstance = DatatypeConverter.parseInt(intervalInSecondsElement.getTextContent());
                                        loadBalancerProbeInstance.setIntervalInSeconds(intervalInSecondsInstance);
                                    }
                                    
                                    NodeList elements20 = XmlUtility.getElementsByTagNameNS(loadBalancerProbeElement, "http://schemas.microsoft.com/windowsazure", "TimeoutInSeconds");
                                    Element timeoutInSecondsElement = elements20.getLength() > 0 ? ((Element) elements20.item(0)) : null;
                                    if (timeoutInSecondsElement != null && (timeoutInSecondsElement.getTextContent() == null || timeoutInSecondsElement.getTextContent().isEmpty() == true) == false) {
                                        int timeoutInSecondsInstance;
                                        timeoutInSecondsInstance = DatatypeConverter.parseInt(timeoutInSecondsElement.getTextContent());
                                        loadBalancerProbeInstance.setTimeoutInSeconds(timeoutInSecondsInstance);
                                    }
                                }
                                
                                NodeList elements21 = XmlUtility.getElementsByTagNameNS(inputEndpointsElement, "http://schemas.microsoft.com/windowsazure", "Protocol");
                                Element protocolElement2 = elements21.getLength() > 0 ? ((Element) elements21.item(0)) : null;
                                if (protocolElement2 != null) {
                                    String protocolInstance2;
                                    protocolInstance2 = protocolElement2.getTextContent();
                                    inputEndpointInstance.setProtocol(protocolInstance2);
                                }
                                
                                NodeList elements22 = XmlUtility.getElementsByTagNameNS(inputEndpointsElement, "http://schemas.microsoft.com/windowsazure", "Vip");
                                Element vipElement = elements22.getLength() > 0 ? ((Element) elements22.item(0)) : null;
                                if (vipElement != null) {
                                    InetAddress vipInstance;
                                    vipInstance = InetAddress.getByName(vipElement.getTextContent());
                                    inputEndpointInstance.setVirtualIPAddress(vipInstance);
                                }
                                
                                NodeList elements23 = XmlUtility.getElementsByTagNameNS(inputEndpointsElement, "http://schemas.microsoft.com/windowsazure", "EnableDirectServerReturn");
                                Element enableDirectServerReturnElement = elements23.getLength() > 0 ? ((Element) elements23.item(0)) : null;
                                if (enableDirectServerReturnElement != null && (enableDirectServerReturnElement.getTextContent() == null || enableDirectServerReturnElement.getTextContent().isEmpty() == true) == false) {
                                    boolean enableDirectServerReturnInstance;
                                    enableDirectServerReturnInstance = DatatypeConverter.parseBoolean(enableDirectServerReturnElement.getTextContent());
                                    inputEndpointInstance.setEnableDirectServerReturn(enableDirectServerReturnInstance);
                                }
                                
                                NodeList elements24 = XmlUtility.getElementsByTagNameNS(inputEndpointsElement, "http://schemas.microsoft.com/windowsazure", "EndpointAcl");
                                Element endpointAclElement = elements24.getLength() > 0 ? ((Element) elements24.item(0)) : null;
                                if (endpointAclElement != null) {
                                    EndpointAcl endpointAclInstance = new EndpointAcl();
                                    inputEndpointInstance.setEndpointAcl(endpointAclInstance);
                                    
                                    NodeList elements25 = XmlUtility.getElementsByTagNameNS(endpointAclElement, "http://schemas.microsoft.com/windowsazure", "Rules");
                                    Element rulesSequenceElement = elements25.getLength() > 0 ? ((Element) elements25.item(0)) : null;
                                    if (rulesSequenceElement != null) {
                                        for (int i3 = 0; i3 < com.microsoft.windowsazure.core.utils.XmlUtility.getElementsByTagNameNS(rulesSequenceElement, "http://schemas.microsoft.com/windowsazure", "Rule").getLength(); i3 = i3 + 1) {
                                            org.w3c.dom.Element rulesElement = ((org.w3c.dom.Element) com.microsoft.windowsazure.core.utils.XmlUtility.getElementsByTagNameNS(rulesSequenceElement, "http://schemas.microsoft.com/windowsazure", "Rule").item(i3));
                                            AccessControlListRule ruleInstance = new AccessControlListRule();
                                            endpointAclInstance.getRules().add(ruleInstance);
                                            
                                            NodeList elements26 = XmlUtility.getElementsByTagNameNS(rulesElement, "http://schemas.microsoft.com/windowsazure", "Order");
                                            Element orderElement = elements26.getLength() > 0 ? ((Element) elements26.item(0)) : null;
                                            if (orderElement != null && (orderElement.getTextContent() == null || orderElement.getTextContent().isEmpty() == true) == false) {
                                                int orderInstance;
                                                orderInstance = DatatypeConverter.parseInt(orderElement.getTextContent());
                                                ruleInstance.setOrder(orderInstance);
                                            }
                                            
                                            NodeList elements27 = XmlUtility.getElementsByTagNameNS(rulesElement, "http://schemas.microsoft.com/windowsazure", "Action");
                                            Element actionElement = elements27.getLength() > 0 ? ((Element) elements27.item(0)) : null;
                                            if (actionElement != null) {
                                                String actionInstance;
                                                actionInstance = actionElement.getTextContent();
                                                ruleInstance.setAction(actionInstance);
                                            }
                                            
                                            NodeList elements28 = XmlUtility.getElementsByTagNameNS(rulesElement, "http://schemas.microsoft.com/windowsazure", "RemoteSubnet");
                                            Element remoteSubnetElement = elements28.getLength() > 0 ? ((Element) elements28.item(0)) : null;
                                            if (remoteSubnetElement != null) {
                                                String remoteSubnetInstance;
                                                remoteSubnetInstance = remoteSubnetElement.getTextContent();
                                                ruleInstance.setRemoteSubnet(remoteSubnetInstance);
                                            }
                                            
                                            NodeList elements29 = XmlUtility.getElementsByTagNameNS(rulesElement, "http://schemas.microsoft.com/windowsazure", "Description");
                                            Element descriptionElement = elements29.getLength() > 0 ? ((Element) elements29.item(0)) : null;
                                            if (descriptionElement != null) {
                                                String descriptionInstance;
                                                descriptionInstance = descriptionElement.getTextContent();
                                                ruleInstance.setDescription(descriptionInstance);
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        
                        NodeList elements30 = XmlUtility.getElementsByTagNameNS(configurationSetsElement, "http://schemas.microsoft.com/windowsazure", "SubnetNames");
                        Element subnetNamesSequenceElement = elements30.getLength() > 0 ? ((Element) elements30.item(0)) : null;
                        if (subnetNamesSequenceElement != null) {
                            for (int i4 = 0; i4 < com.microsoft.windowsazure.core.utils.XmlUtility.getElementsByTagNameNS(subnetNamesSequenceElement, "http://schemas.microsoft.com/windowsazure", "SubnetName").getLength(); i4 = i4 + 1) {
                                org.w3c.dom.Element subnetNamesElement = ((org.w3c.dom.Element) com.microsoft.windowsazure.core.utils.XmlUtility.getElementsByTagNameNS(subnetNamesSequenceElement, "http://schemas.microsoft.com/windowsazure", "SubnetName").item(i4));
                                configurationSetInstance.getSubnetNames().add(subnetNamesElement.getTextContent());
                            }
                        }
                        
                        NodeList elements31 = XmlUtility.getElementsByTagNameNS(configurationSetsElement, "http://schemas.microsoft.com/windowsazure", "StaticVirtualNetworkIPAddress");
                        Element staticVirtualNetworkIPAddressElement = elements31.getLength() > 0 ? ((Element) elements31.item(0)) : null;
                        if (staticVirtualNetworkIPAddressElement != null) {
                            String staticVirtualNetworkIPAddressInstance;
                            staticVirtualNetworkIPAddressInstance = staticVirtualNetworkIPAddressElement.getTextContent();
                            configurationSetInstance.setStaticVirtualNetworkIPAddress(staticVirtualNetworkIPAddressInstance);
                        }
                        
                        NodeList elements32 = XmlUtility.getElementsByTagNameNS(configurationSetsElement, "http://schemas.microsoft.com/windowsazure", "ComputerName");
                        Element computerNameElement = elements32.getLength() > 0 ? ((Element) elements32.item(0)) : null;
                        if (computerNameElement != null) {
                            String computerNameInstance;
                            computerNameInstance = computerNameElement.getTextContent();
                            configurationSetInstance.setComputerName(computerNameInstance);
                        }
                        
                        NodeList elements33 = XmlUtility.getElementsByTagNameNS(configurationSetsElement, "http://schemas.microsoft.com/windowsazure", "AdminPassword");
                        Element adminPasswordElement = elements33.getLength() > 0 ? ((Element) elements33.item(0)) : null;
                        if (adminPasswordElement != null) {
                            String adminPasswordInstance;
                            adminPasswordInstance = adminPasswordElement.getTextContent();
                            configurationSetInstance.setAdminPassword(adminPasswordInstance);
                        }
                        
                        NodeList elements34 = XmlUtility.getElementsByTagNameNS(configurationSetsElement, "http://schemas.microsoft.com/windowsazure", "ResetPasswordOnFirstLogon");
                        Element resetPasswordOnFirstLogonElement = elements34.getLength() > 0 ? ((Element) elements34.item(0)) : null;
                        if (resetPasswordOnFirstLogonElement != null && (resetPasswordOnFirstLogonElement.getTextContent() == null || resetPasswordOnFirstLogonElement.getTextContent().isEmpty() == true) == false) {
                            boolean resetPasswordOnFirstLogonInstance;
                            resetPasswordOnFirstLogonInstance = DatatypeConverter.parseBoolean(resetPasswordOnFirstLogonElement.getTextContent());
                            configurationSetInstance.setResetPasswordOnFirstLogon(resetPasswordOnFirstLogonInstance);
                        }
                        
                        NodeList elements35 = XmlUtility.getElementsByTagNameNS(configurationSetsElement, "http://schemas.microsoft.com/windowsazure", "EnableAutomaticUpdates");
                        Element enableAutomaticUpdatesElement = elements35.getLength() > 0 ? ((Element) elements35.item(0)) : null;
                        if (enableAutomaticUpdatesElement != null && (enableAutomaticUpdatesElement.getTextContent() == null || enableAutomaticUpdatesElement.getTextContent().isEmpty() == true) == false) {
                            boolean enableAutomaticUpdatesInstance;
                            enableAutomaticUpdatesInstance = DatatypeConverter.parseBoolean(enableAutomaticUpdatesElement.getTextContent());
                            configurationSetInstance.setEnableAutomaticUpdates(enableAutomaticUpdatesInstance);
                        }
                        
                        NodeList elements36 = XmlUtility.getElementsByTagNameNS(configurationSetsElement, "http://schemas.microsoft.com/windowsazure", "TimeZone");
                        Element timeZoneElement = elements36.getLength() > 0 ? ((Element) elements36.item(0)) : null;
                        if (timeZoneElement != null) {
                            String timeZoneInstance;
                            timeZoneInstance = timeZoneElement.getTextContent();
                            configurationSetInstance.setTimeZone(timeZoneInstance);
                        }
                        
                        NodeList elements37 = XmlUtility.getElementsByTagNameNS(configurationSetsElement, "http://schemas.microsoft.com/windowsazure", "DomainJoin");
                        Element domainJoinElement = elements37.getLength() > 0 ? ((Element) elements37.item(0)) : null;
                        if (domainJoinElement != null) {
                            DomainJoinSettings domainJoinInstance = new DomainJoinSettings();
                            configurationSetInstance.setDomainJoin(domainJoinInstance);
                            
                            NodeList elements38 = XmlUtility.getElementsByTagNameNS(domainJoinElement, "http://schemas.microsoft.com/windowsazure", "Credentials");
                            Element credentialsElement = elements38.getLength() > 0 ? ((Element) elements38.item(0)) : null;
                            if (credentialsElement != null) {
                                DomainJoinCredentials credentialsInstance = new DomainJoinCredentials();
                                domainJoinInstance.setCredentials(credentialsInstance);
                                
                                NodeList elements39 = XmlUtility.getElementsByTagNameNS(credentialsElement, "http://schemas.microsoft.com/windowsazure", "Domain");
                                Element domainElement = elements39.getLength() > 0 ? ((Element) elements39.item(0)) : null;
                                if (domainElement != null) {
                                    String domainInstance;
                                    domainInstance = domainElement.getTextContent();
                                    credentialsInstance.setDomain(domainInstance);
                                }
                                
                                NodeList elements40 = XmlUtility.getElementsByTagNameNS(credentialsElement, "http://schemas.microsoft.com/windowsazure", "Username");
                                Element usernameElement = elements40.getLength() > 0 ? ((Element) elements40.item(0)) : null;
                                if (usernameElement != null) {
                                    String usernameInstance;
                                    usernameInstance = usernameElement.getTextContent();
                                    credentialsInstance.setUserName(usernameInstance);
                                }
                                
                                NodeList elements41 = XmlUtility.getElementsByTagNameNS(credentialsElement, "http://schemas.microsoft.com/windowsazure", "Password");
                                Element passwordElement = elements41.getLength() > 0 ? ((Element) elements41.item(0)) : null;
                                if (passwordElement != null) {
                                    String passwordInstance;
                                    passwordInstance = passwordElement.getTextContent();
                                    credentialsInstance.setPassword(passwordInstance);
                                }
                            }
                            
                            NodeList elements42 = XmlUtility.getElementsByTagNameNS(domainJoinElement, "http://schemas.microsoft.com/windowsazure", "JoinDomain");
                            Element joinDomainElement = elements42.getLength() > 0 ? ((Element) elements42.item(0)) : null;
                            if (joinDomainElement != null) {
                                String joinDomainInstance;
                                joinDomainInstance = joinDomainElement.getTextContent();
                                domainJoinInstance.setDomainToJoin(joinDomainInstance);
                            }
                            
                            NodeList elements43 = XmlUtility.getElementsByTagNameNS(domainJoinElement, "http://schemas.microsoft.com/windowsazure", "MachineObjectOU");
                            Element machineObjectOUElement = elements43.getLength() > 0 ? ((Element) elements43.item(0)) : null;
                            if (machineObjectOUElement != null) {
                                String machineObjectOUInstance;
                                machineObjectOUInstance = machineObjectOUElement.getTextContent();
                                domainJoinInstance.setLdapMachineObjectOU(machineObjectOUInstance);
                            }
                            
                            NodeList elements44 = XmlUtility.getElementsByTagNameNS(domainJoinElement, "http://schemas.microsoft.com/windowsazure", "Provisioning");
                            Element provisioningElement = elements44.getLength() > 0 ? ((Element) elements44.item(0)) : null;
                            if (provisioningElement != null) {
                                DomainJoinProvisioning provisioningInstance = new DomainJoinProvisioning();
                                domainJoinInstance.setProvisioning(provisioningInstance);
                                
                                NodeList elements45 = XmlUtility.getElementsByTagNameNS(provisioningElement, "http://schemas.microsoft.com/windowsazure", "AccountData");
                                Element accountDataElement = elements45.getLength() > 0 ? ((Element) elements45.item(0)) : null;
                                if (accountDataElement != null) {
                                    String accountDataInstance;
                                    accountDataInstance = accountDataElement.getTextContent();
                                    provisioningInstance.setAccountData(accountDataInstance);
                                }
                            }
                        }
                        
                        NodeList elements46 = XmlUtility.getElementsByTagNameNS(configurationSetsElement, "http://schemas.microsoft.com/windowsazure", "StoredCertificateSettings");
                        Element storedCertificateSettingsSequenceElement = elements46.getLength() > 0 ? ((Element) elements46.item(0)) : null;
                        if (storedCertificateSettingsSequenceElement != null) {
                            for (int i5 = 0; i5 < com.microsoft.windowsazure.core.utils.XmlUtility.getElementsByTagNameNS(storedCertificateSettingsSequenceElement, "http://schemas.microsoft.com/windowsazure", "CertificateSetting").getLength(); i5 = i5 + 1) {
                                org.w3c.dom.Element storedCertificateSettingsElement = ((org.w3c.dom.Element) com.microsoft.windowsazure.core.utils.XmlUtility.getElementsByTagNameNS(storedCertificateSettingsSequenceElement, "http://schemas.microsoft.com/windowsazure", "CertificateSetting").item(i5));
                                StoredCertificateSettings certificateSettingInstance = new StoredCertificateSettings();
                                configurationSetInstance.getStoredCertificateSettings().add(certificateSettingInstance);
                                
                                NodeList elements47 = XmlUtility.getElementsByTagNameNS(storedCertificateSettingsElement, "http://schemas.microsoft.com/windowsazure", "StoreLocation");
                                Element storeLocationElement = elements47.getLength() > 0 ? ((Element) elements47.item(0)) : null;
                                if (storeLocationElement != null) {
                                }
                                
                                NodeList elements48 = XmlUtility.getElementsByTagNameNS(storedCertificateSettingsElement, "http://schemas.microsoft.com/windowsazure", "StoreName");
                                Element storeNameElement = elements48.getLength() > 0 ? ((Element) elements48.item(0)) : null;
                                if (storeNameElement != null) {
                                    String storeNameInstance;
                                    storeNameInstance = storeNameElement.getTextContent();
                                    certificateSettingInstance.setStoreName(storeNameInstance);
                                }
                                
                                NodeList elements49 = XmlUtility.getElementsByTagNameNS(storedCertificateSettingsElement, "http://schemas.microsoft.com/windowsazure", "Thumbprint");
                                Element thumbprintElement = elements49.getLength() > 0 ? ((Element) elements49.item(0)) : null;
                                if (thumbprintElement != null) {
                                    String thumbprintInstance;
                                    thumbprintInstance = thumbprintElement.getTextContent();
                                    certificateSettingInstance.setThumbprint(thumbprintInstance);
                                }
                            }
                        }
                        
                        NodeList elements50 = XmlUtility.getElementsByTagNameNS(configurationSetsElement, "http://schemas.microsoft.com/windowsazure", "WinRM");
                        Element winRMElement = elements50.getLength() > 0 ? ((Element) elements50.item(0)) : null;
                        if (winRMElement != null) {
                            WindowsRemoteManagementSettings winRMInstance = new WindowsRemoteManagementSettings();
                            configurationSetInstance.setWindowsRemoteManagement(winRMInstance);
                            
                            NodeList elements51 = XmlUtility.getElementsByTagNameNS(winRMElement, "http://schemas.microsoft.com/windowsazure", "Listeners");
                            Element listenersSequenceElement = elements51.getLength() > 0 ? ((Element) elements51.item(0)) : null;
                            if (listenersSequenceElement != null) {
                                for (int i6 = 0; i6 < com.microsoft.windowsazure.core.utils.XmlUtility.getElementsByTagNameNS(listenersSequenceElement, "http://schemas.microsoft.com/windowsazure", "Listener").getLength(); i6 = i6 + 1) {
                                    org.w3c.dom.Element listenersElement = ((org.w3c.dom.Element) com.microsoft.windowsazure.core.utils.XmlUtility.getElementsByTagNameNS(listenersSequenceElement, "http://schemas.microsoft.com/windowsazure", "Listener").item(i6));
                                    WindowsRemoteManagementListener listenerInstance = new WindowsRemoteManagementListener();
                                    winRMInstance.getListeners().add(listenerInstance);
                                    
                                    NodeList elements52 = XmlUtility.getElementsByTagNameNS(listenersElement, "http://schemas.microsoft.com/windowsazure", "Protocol");
                                    Element protocolElement3 = elements52.getLength() > 0 ? ((Element) elements52.item(0)) : null;
                                    if (protocolElement3 != null) {
                                        VirtualMachineWindowsRemoteManagementListenerType protocolInstance3;
                                        protocolInstance3 = VirtualMachineWindowsRemoteManagementListenerType.valueOf(protocolElement3.getTextContent());
                                        listenerInstance.setListenerType(protocolInstance3);
                                    }
                                    
                                    NodeList elements53 = XmlUtility.getElementsByTagNameNS(listenersElement, "http://schemas.microsoft.com/windowsazure", "CertificateThumbprint");
                                    Element certificateThumbprintElement = elements53.getLength() > 0 ? ((Element) elements53.item(0)) : null;
                                    if (certificateThumbprintElement != null) {
                                        String certificateThumbprintInstance;
                                        certificateThumbprintInstance = certificateThumbprintElement.getTextContent();
                                        listenerInstance.setCertificateThumbprint(certificateThumbprintInstance);
                                    }
                                }
                            }
                        }
                        
                        NodeList elements54 = XmlUtility.getElementsByTagNameNS(configurationSetsElement, "http://schemas.microsoft.com/windowsazure", "AdminUsername");
                        Element adminUsernameElement = elements54.getLength() > 0 ? ((Element) elements54.item(0)) : null;
                        if (adminUsernameElement != null) {
                            String adminUsernameInstance;
                            adminUsernameInstance = adminUsernameElement.getTextContent();
                            configurationSetInstance.setAdminUserName(adminUsernameInstance);
                        }
                        
                        NodeList elements55 = XmlUtility.getElementsByTagNameNS(configurationSetsElement, "http://schemas.microsoft.com/windowsazure", "HostName");
                        Element hostNameElement = elements55.getLength() > 0 ? ((Element) elements55.item(0)) : null;
                        if (hostNameElement != null) {
                            String hostNameInstance;
                            hostNameInstance = hostNameElement.getTextContent();
                            configurationSetInstance.setHostName(hostNameInstance);
                        }
                        
                        NodeList elements56 = XmlUtility.getElementsByTagNameNS(configurationSetsElement, "http://schemas.microsoft.com/windowsazure", "UserName");
                        Element userNameElement = elements56.getLength() > 0 ? ((Element) elements56.item(0)) : null;
                        if (userNameElement != null) {
                            String userNameInstance;
                            userNameInstance = userNameElement.getTextContent();
                            configurationSetInstance.setUserName(userNameInstance);
                        }
                        
                        NodeList elements57 = XmlUtility.getElementsByTagNameNS(configurationSetsElement, "http://schemas.microsoft.com/windowsazure", "UserPassword");
                        Element userPasswordElement = elements57.getLength() > 0 ? ((Element) elements57.item(0)) : null;
                        if (userPasswordElement != null) {
                            String userPasswordInstance;
                            userPasswordInstance = userPasswordElement.getTextContent();
                            configurationSetInstance.setUserPassword(userPasswordInstance);
                        }
                        
                        NodeList elements58 = XmlUtility.getElementsByTagNameNS(configurationSetsElement, "http://schemas.microsoft.com/windowsazure", "DisableSshPasswordAuthentication");
                        Element disableSshPasswordAuthenticationElement = elements58.getLength() > 0 ? ((Element) elements58.item(0)) : null;
                        if (disableSshPasswordAuthenticationElement != null && (disableSshPasswordAuthenticationElement.getTextContent() == null || disableSshPasswordAuthenticationElement.getTextContent().isEmpty() == true) == false) {
                            boolean disableSshPasswordAuthenticationInstance;
                            disableSshPasswordAuthenticationInstance = DatatypeConverter.parseBoolean(disableSshPasswordAuthenticationElement.getTextContent());
                            configurationSetInstance.setDisableSshPasswordAuthentication(disableSshPasswordAuthenticationInstance);
                        }
                        
                        NodeList elements59 = XmlUtility.getElementsByTagNameNS(configurationSetsElement, "http://schemas.microsoft.com/windowsazure", "SSH");
                        Element sSHElement = elements59.getLength() > 0 ? ((Element) elements59.item(0)) : null;
                        if (sSHElement != null) {
                            SshSettings sSHInstance = new SshSettings();
                            configurationSetInstance.setSshSettings(sSHInstance);
                            
                            NodeList elements60 = XmlUtility.getElementsByTagNameNS(sSHElement, "http://schemas.microsoft.com/windowsazure", "PublicKeys");
                            Element publicKeysSequenceElement = elements60.getLength() > 0 ? ((Element) elements60.item(0)) : null;
                            if (publicKeysSequenceElement != null) {
                                for (int i7 = 0; i7 < com.microsoft.windowsazure.core.utils.XmlUtility.getElementsByTagNameNS(publicKeysSequenceElement, "http://schemas.microsoft.com/windowsazure", "PublicKey").getLength(); i7 = i7 + 1) {
                                    org.w3c.dom.Element publicKeysElement = ((org.w3c.dom.Element) com.microsoft.windowsazure.core.utils.XmlUtility.getElementsByTagNameNS(publicKeysSequenceElement, "http://schemas.microsoft.com/windowsazure", "PublicKey").item(i7));
                                    SshSettingPublicKey publicKeyInstance = new SshSettingPublicKey();
                                    sSHInstance.getPublicKeys().add(publicKeyInstance);
                                    
                                    NodeList elements61 = XmlUtility.getElementsByTagNameNS(publicKeysElement, "http://schemas.microsoft.com/windowsazure", "Fingerprint");
                                    Element fingerprintElement = elements61.getLength() > 0 ? ((Element) elements61.item(0)) : null;
                                    if (fingerprintElement != null) {
                                        String fingerprintInstance;
                                        fingerprintInstance = fingerprintElement.getTextContent();
                                        publicKeyInstance.setFingerprint(fingerprintInstance);
                                    }
                                    
                                    NodeList elements62 = XmlUtility.getElementsByTagNameNS(publicKeysElement, "http://schemas.microsoft.com/windowsazure", "Path");
                                    Element pathElement2 = elements62.getLength() > 0 ? ((Element) elements62.item(0)) : null;
                                    if (pathElement2 != null) {
                                        String pathInstance2;
                                        pathInstance2 = pathElement2.getTextContent();
                                        publicKeyInstance.setPath(pathInstance2);
                                    }
                                }
                            }
                            
                            NodeList elements63 = XmlUtility.getElementsByTagNameNS(sSHElement, "http://schemas.microsoft.com/windowsazure", "KeyPairs");
                            Element keyPairsSequenceElement = elements63.getLength() > 0 ? ((Element) elements63.item(0)) : null;
                            if (keyPairsSequenceElement != null) {
                                for (int i8 = 0; i8 < com.microsoft.windowsazure.core.utils.XmlUtility.getElementsByTagNameNS(keyPairsSequenceElement, "http://schemas.microsoft.com/windowsazure", "KeyPair").getLength(); i8 = i8 + 1) {
                                    org.w3c.dom.Element keyPairsElement = ((org.w3c.dom.Element) com.microsoft.windowsazure.core.utils.XmlUtility.getElementsByTagNameNS(keyPairsSequenceElement, "http://schemas.microsoft.com/windowsazure", "KeyPair").item(i8));
                                    SshSettingKeyPair keyPairInstance = new SshSettingKeyPair();
                                    sSHInstance.getKeyPairs().add(keyPairInstance);
                                    
                                    NodeList elements64 = XmlUtility.getElementsByTagNameNS(keyPairsElement, "http://schemas.microsoft.com/windowsazure", "Fingerprint");
                                    Element fingerprintElement2 = elements64.getLength() > 0 ? ((Element) elements64.item(0)) : null;
                                    if (fingerprintElement2 != null) {
                                        String fingerprintInstance2;
                                        fingerprintInstance2 = fingerprintElement2.getTextContent();
                                        keyPairInstance.setFingerprint(fingerprintInstance2);
                                    }
                                    
                                    NodeList elements65 = XmlUtility.getElementsByTagNameNS(keyPairsElement, "http://schemas.microsoft.com/windowsazure", "Path");
                                    Element pathElement3 = elements65.getLength() > 0 ? ((Element) elements65.item(0)) : null;
                                    if (pathElement3 != null) {
                                        String pathInstance3;
                                        pathInstance3 = pathElement3.getTextContent();
                                        keyPairInstance.setPath(pathInstance3);
                                    }
                                }
                            }
                        }
                    }
                }
                
                NodeList elements66 = XmlUtility.getElementsByTagNameNS(persistentVMRoleElement, "http://schemas.microsoft.com/windowsazure", "DataVirtualHardDisks");
                Element dataVirtualHardDisksSequenceElement = elements66.getLength() > 0 ? ((Element) elements66.item(0)) : null;
                if (dataVirtualHardDisksSequenceElement != null) {
                    for (int i9 = 0; i9 < com.microsoft.windowsazure.core.utils.XmlUtility.getElementsByTagNameNS(dataVirtualHardDisksSequenceElement, "http://schemas.microsoft.com/windowsazure", "DataVirtualHardDisk").getLength(); i9 = i9 + 1) {
                        org.w3c.dom.Element dataVirtualHardDisksElement = ((org.w3c.dom.Element) com.microsoft.windowsazure.core.utils.XmlUtility.getElementsByTagNameNS(dataVirtualHardDisksSequenceElement, "http://schemas.microsoft.com/windowsazure", "DataVirtualHardDisk").item(i9));
                        DataVirtualHardDisk dataVirtualHardDiskInstance = new DataVirtualHardDisk();
                        result.getDataVirtualHardDisks().add(dataVirtualHardDiskInstance);
                        
                        NodeList elements67 = XmlUtility.getElementsByTagNameNS(dataVirtualHardDisksElement, "http://schemas.microsoft.com/windowsazure", "HostCaching");
                        Element hostCachingElement = elements67.getLength() > 0 ? ((Element) elements67.item(0)) : null;
                        if (hostCachingElement != null && (hostCachingElement.getTextContent() == null || hostCachingElement.getTextContent().isEmpty() == true) == false) {
                            VirtualHardDiskHostCaching hostCachingInstance;
                            hostCachingInstance = VirtualHardDiskHostCaching.valueOf(hostCachingElement.getTextContent());
                            dataVirtualHardDiskInstance.setHostCaching(hostCachingInstance);
                        }
                        
                        NodeList elements68 = XmlUtility.getElementsByTagNameNS(dataVirtualHardDisksElement, "http://schemas.microsoft.com/windowsazure", "DiskLabel");
                        Element diskLabelElement = elements68.getLength() > 0 ? ((Element) elements68.item(0)) : null;
                        if (diskLabelElement != null) {
                            String diskLabelInstance;
                            diskLabelInstance = diskLabelElement.getTextContent();
                            dataVirtualHardDiskInstance.setDiskLabel(diskLabelInstance);
                        }
                        
                        NodeList elements69 = XmlUtility.getElementsByTagNameNS(dataVirtualHardDisksElement, "http://schemas.microsoft.com/windowsazure", "DiskName");
                        Element diskNameElement = elements69.getLength() > 0 ? ((Element) elements69.item(0)) : null;
                        if (diskNameElement != null) {
                            String diskNameInstance;
                            diskNameInstance = diskNameElement.getTextContent();
                            dataVirtualHardDiskInstance.setDiskName(diskNameInstance);
                        }
                        
                        NodeList elements70 = XmlUtility.getElementsByTagNameNS(dataVirtualHardDisksElement, "http://schemas.microsoft.com/windowsazure", "Lun");
                        Element lunElement = elements70.getLength() > 0 ? ((Element) elements70.item(0)) : null;
                        if (lunElement != null && (lunElement.getTextContent() == null || lunElement.getTextContent().isEmpty() == true) == false) {
                            int lunInstance;
                            lunInstance = DatatypeConverter.parseInt(lunElement.getTextContent());
                            dataVirtualHardDiskInstance.setLogicalUnitNumber(lunInstance);
                        }
                        
                        NodeList elements71 = XmlUtility.getElementsByTagNameNS(dataVirtualHardDisksElement, "http://schemas.microsoft.com/windowsazure", "LogicalDiskSizeInGB");
                        Element logicalDiskSizeInGBElement = elements71.getLength() > 0 ? ((Element) elements71.item(0)) : null;
                        if (logicalDiskSizeInGBElement != null) {
                            int logicalDiskSizeInGBInstance;
                            logicalDiskSizeInGBInstance = DatatypeConverter.parseInt(logicalDiskSizeInGBElement.getTextContent());
                            dataVirtualHardDiskInstance.setLogicalDiskSizeInGB(logicalDiskSizeInGBInstance);
                        }
                        
                        NodeList elements72 = XmlUtility.getElementsByTagNameNS(dataVirtualHardDisksElement, "http://schemas.microsoft.com/windowsazure", "MediaLink");
                        Element mediaLinkElement = elements72.getLength() > 0 ? ((Element) elements72.item(0)) : null;
                        if (mediaLinkElement != null) {
                            URI mediaLinkInstance;
                            mediaLinkInstance = new URI(mediaLinkElement.getTextContent());
                            dataVirtualHardDiskInstance.setMediaLink(mediaLinkInstance);
                        }
                    }
                }
                
                NodeList elements73 = XmlUtility.getElementsByTagNameNS(persistentVMRoleElement, "http://schemas.microsoft.com/windowsazure", "OSVirtualHardDisk");
                Element oSVirtualHardDiskElement = elements73.getLength() > 0 ? ((Element) elements73.item(0)) : null;
                if (oSVirtualHardDiskElement != null) {
                    OSVirtualHardDisk oSVirtualHardDiskInstance = new OSVirtualHardDisk();
                    result.setOSVirtualHardDisk(oSVirtualHardDiskInstance);
                    
                    NodeList elements74 = XmlUtility.getElementsByTagNameNS(oSVirtualHardDiskElement, "http://schemas.microsoft.com/windowsazure", "HostCaching");
                    Element hostCachingElement2 = elements74.getLength() > 0 ? ((Element) elements74.item(0)) : null;
                    if (hostCachingElement2 != null && (hostCachingElement2.getTextContent() == null || hostCachingElement2.getTextContent().isEmpty() == true) == false) {
                        VirtualHardDiskHostCaching hostCachingInstance2;
                        hostCachingInstance2 = VirtualHardDiskHostCaching.valueOf(hostCachingElement2.getTextContent());
                        oSVirtualHardDiskInstance.setHostCaching(hostCachingInstance2);
                    }
                    
                    NodeList elements75 = XmlUtility.getElementsByTagNameNS(oSVirtualHardDiskElement, "http://schemas.microsoft.com/windowsazure", "DiskLabel");
                    Element diskLabelElement2 = elements75.getLength() > 0 ? ((Element) elements75.item(0)) : null;
                    if (diskLabelElement2 != null) {
                        String diskLabelInstance2;
                        diskLabelInstance2 = diskLabelElement2.getTextContent();
                        oSVirtualHardDiskInstance.setDiskLabel(diskLabelInstance2);
                    }
                    
                    NodeList elements76 = XmlUtility.getElementsByTagNameNS(oSVirtualHardDiskElement, "http://schemas.microsoft.com/windowsazure", "DiskName");
                    Element diskNameElement2 = elements76.getLength() > 0 ? ((Element) elements76.item(0)) : null;
                    if (diskNameElement2 != null) {
                        String diskNameInstance2;
                        diskNameInstance2 = diskNameElement2.getTextContent();
                        oSVirtualHardDiskInstance.setDiskName(diskNameInstance2);
                    }
                    
                    NodeList elements77 = XmlUtility.getElementsByTagNameNS(oSVirtualHardDiskElement, "http://schemas.microsoft.com/windowsazure", "MediaLink");
                    Element mediaLinkElement2 = elements77.getLength() > 0 ? ((Element) elements77.item(0)) : null;
                    if (mediaLinkElement2 != null) {
                        URI mediaLinkInstance2;
                        mediaLinkInstance2 = new URI(mediaLinkElement2.getTextContent());
                        oSVirtualHardDiskInstance.setMediaLink(mediaLinkInstance2);
                    }
                    
                    NodeList elements78 = XmlUtility.getElementsByTagNameNS(oSVirtualHardDiskElement, "http://schemas.microsoft.com/windowsazure", "SourceImageName");
                    Element sourceImageNameElement = elements78.getLength() > 0 ? ((Element) elements78.item(0)) : null;
                    if (sourceImageNameElement != null) {
                        String sourceImageNameInstance;
                        sourceImageNameInstance = sourceImageNameElement.getTextContent();
                        oSVirtualHardDiskInstance.setSourceImageName(sourceImageNameInstance);
                    }
                    
                    NodeList elements79 = XmlUtility.getElementsByTagNameNS(oSVirtualHardDiskElement, "http://schemas.microsoft.com/windowsazure", "OS");
                    Element osElement = elements79.getLength() > 0 ? ((Element) elements79.item(0)) : null;
                    if (osElement != null) {
                        String osInstance;
                        osInstance = osElement.getTextContent();
                        oSVirtualHardDiskInstance.setOperatingSystem(osInstance);
                    }
                }
            }
            
            result.setStatusCode(statusCode);
            if (httpResponse.getHeaders("x-ms-request-id").length > 0) {
                result.setRequestId(httpResponse.getFirstHeader("x-ms-request-id").getValue());
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            return result;
        } finally {
            if (httpResponse != null && httpResponse.getEntity() != null) {
                httpResponse.getEntity().getContent().close();
            }
        }
    }
    
    /**
    * The Download RDP file operation retrieves the Remote Desktop Protocol
    * configuration file from the specified virtual machine.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157183.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine.
    * @return The Download RDP file operation response.
    */
    @Override
    public Future<VirtualMachineGetRemoteDesktopFileResponse> getRemoteDesktopFileAsync(final String serviceName, final String deploymentName, final String virtualMachineName) {
        return this.getClient().getExecutorService().submit(new Callable<VirtualMachineGetRemoteDesktopFileResponse>() { 
            @Override
            public VirtualMachineGetRemoteDesktopFileResponse call() throws Exception {
                return getRemoteDesktopFile(serviceName, deploymentName, virtualMachineName);
            }
         });
    }
    
    /**
    * The Download RDP file operation retrieves the Remote Desktop Protocol
    * configuration file from the specified virtual machine.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157183.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine.
    * @throws IOException Signals that an I/O exception of some sort has
    * occurred. This class is the general class of exceptions produced by
    * failed or interrupted I/O operations.
    * @throws ServiceException Thrown if an unexpected response is found.
    * @return The Download RDP file operation response.
    */
    @Override
    public VirtualMachineGetRemoteDesktopFileResponse getRemoteDesktopFile(String serviceName, String deploymentName, String virtualMachineName) throws IOException, ServiceException {
        // Validate
        if (serviceName == null) {
            throw new NullPointerException("serviceName");
        }
        if (deploymentName == null) {
            throw new NullPointerException("deploymentName");
        }
        if (virtualMachineName == null) {
            throw new NullPointerException("virtualMachineName");
        }
        
        // Tracing
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("deploymentName", deploymentName);
            tracingParameters.put("virtualMachineName", virtualMachineName);
            CloudTracing.enter(invocationId, this, "getRemoteDesktopFileAsync", tracingParameters);
        }
        
        // Construct URL
        String url = this.getClient().getBaseUri() + "/" + this.getClient().getCredentials().getSubscriptionId() + "/services/hostedservices/" + serviceName + "/deployments/" + deploymentName + "/roleinstances/" + virtualMachineName + "/ModelFile" + "?" + "FileType=RDP";
        
        // Create HTTP transport objects
        HttpGet httpRequest = new HttpGet(url);
        
        // Set Headers
        httpRequest.setHeader("x-ms-version", "2013-11-01");
        
        // Send Request
        HttpResponse httpResponse = null;
        try {
            if (shouldTrace) {
                CloudTracing.sendRequest(invocationId, httpRequest);
            }
            httpResponse = this.getClient().getHttpClient().execute(httpRequest);
            if (shouldTrace) {
                CloudTracing.receiveResponse(invocationId, httpResponse);
            }
            int statusCode = httpResponse.getStatusLine().getStatusCode();
            if (statusCode != HttpStatus.SC_OK) {
                ServiceException ex = ServiceException.createFromXml(httpRequest, null, httpResponse, httpResponse.getEntity());
                if (shouldTrace) {
                    CloudTracing.error(invocationId, ex);
                }
                throw ex;
            }
            
            // Create Result
            VirtualMachineGetRemoteDesktopFileResponse result = null;
            // Deserialize Response
            InputStream responseContent = httpResponse.getEntity().getContent();
            result = new VirtualMachineGetRemoteDesktopFileResponse();
            result.setRemoteDesktopFile(StreamUtils.toString(responseContent).getBytes("UTF-8"));
            
            result.setStatusCode(statusCode);
            if (httpResponse.getHeaders("x-ms-request-id").length > 0) {
                result.setRequestId(httpResponse.getFirstHeader("x-ms-request-id").getValue());
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            return result;
        } finally {
            if (httpResponse != null && httpResponse.getEntity() != null) {
                httpResponse.getEntity().getContent().close();
            }
        }
    }
    
    /**
    * The Restart role operation restarts the specified virtual machine.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157197.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine to restart.
    * @return The response body contains the status of the specified
    * asynchronous operation, indicating whether it has succeeded, is
    * inprogress, or has failed. Note that this status is distinct from the
    * HTTP status code returned for the Get Operation Status operation itself.
    * If the asynchronous operation succeeded, the response body includes the
    * HTTP status code for the successful request.  If the asynchronous
    * operation failed, the response body includes the HTTP status code for
    * the failed request, and also includes error information regarding the
    * failure.
    */
    @Override
    public Future<ComputeOperationStatusResponse> restartAsync(final String serviceName, final String deploymentName, final String virtualMachineName) {
        return this.getClient().getExecutorService().submit(new Callable<ComputeOperationStatusResponse>() { 
            @Override
            public ComputeOperationStatusResponse call() throws Exception {
                return restart(serviceName, deploymentName, virtualMachineName);
            }
         });
    }
    
    /**
    * The Restart role operation restarts the specified virtual machine.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157197.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine to restart.
    * @throws InterruptedException Thrown when a thread is waiting, sleeping,
    * or otherwise occupied, and the thread is interrupted, either before or
    * during the activity. Occasionally a method may wish to test whether the
    * current thread has been interrupted, and if so, to immediately throw
    * this exception. The following code can be used to achieve this effect:
    * @throws ExecutionException Thrown when attempting to retrieve the result
    * of a task that aborted by throwing an exception. This exception can be
    * inspected using the Throwable.getCause() method.
    * @throws ServiceException Thrown if the server returned an error for the
    * request.
    * @throws IOException Thrown if there was an error setting up tracing for
    * the request.
    * @return The response body contains the status of the specified
    * asynchronous operation, indicating whether it has succeeded, is
    * inprogress, or has failed. Note that this status is distinct from the
    * HTTP status code returned for the Get Operation Status operation itself.
    * If the asynchronous operation succeeded, the response body includes the
    * HTTP status code for the successful request.  If the asynchronous
    * operation failed, the response body includes the HTTP status code for
    * the failed request, and also includes error information regarding the
    * failure.
    */
    @Override
    public ComputeOperationStatusResponse restart(String serviceName, String deploymentName, String virtualMachineName) throws InterruptedException, ExecutionException, ServiceException, IOException {
        ComputeManagementClient client2 = this.getClient();
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("deploymentName", deploymentName);
            tracingParameters.put("virtualMachineName", virtualMachineName);
            CloudTracing.enter(invocationId, this, "restartAsync", tracingParameters);
        }
        try {
            if (shouldTrace) {
                client2 = this.getClient().withRequestFilterLast(new ClientRequestTrackingHandler(invocationId)).withResponseFilterLast(new ClientRequestTrackingHandler(invocationId));
            }
            
            OperationResponse response = client2.getVirtualMachinesOperations().beginRestartingAsync(serviceName, deploymentName, virtualMachineName).get();
            ComputeOperationStatusResponse result = client2.getOperationStatusAsync(response.getRequestId()).get();
            int delayInSeconds = 30;
            while ((result.getStatus() != OperationStatus.InProgress) == false) {
                Thread.sleep(delayInSeconds * 1000);
                result = client2.getOperationStatusAsync(response.getRequestId()).get();
                delayInSeconds = 30;
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            
            if (result.getStatus() != OperationStatus.Succeeded) {
                if (result.getError() != null) {
                    ServiceException ex = new ServiceException(result.getError().getCode() + " : " + result.getError().getMessage());
                    ex.setErrorCode(result.getError().getCode());
                    ex.setErrorMessage(result.getError().getMessage());
                    if (shouldTrace) {
                        CloudTracing.error(invocationId, ex);
                    }
                    throw ex;
                } else {
                    ServiceException ex = new ServiceException("");
                    if (shouldTrace) {
                        CloudTracing.error(invocationId, ex);
                    }
                    throw ex;
                }
            }
            
            return result;
        } finally {
            if (this.getClient() != null && shouldTrace) {
                this.getClient().close();
            }
        }
    }
    
    /**
    * The Shutdown Role operation shuts down the specified virtual machine.
    * (see http://msdn.microsoft.com/en-us/library/windowsazure/jj157195.aspx
    * for more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine to shutdown.
    * @param parameters The parameters for the shutdown vm operation.
    * @return The response body contains the status of the specified
    * asynchronous operation, indicating whether it has succeeded, is
    * inprogress, or has failed. Note that this status is distinct from the
    * HTTP status code returned for the Get Operation Status operation itself.
    * If the asynchronous operation succeeded, the response body includes the
    * HTTP status code for the successful request.  If the asynchronous
    * operation failed, the response body includes the HTTP status code for
    * the failed request, and also includes error information regarding the
    * failure.
    */
    @Override
    public Future<ComputeOperationStatusResponse> shutdownAsync(final String serviceName, final String deploymentName, final String virtualMachineName, final VirtualMachineShutdownParameters parameters) {
        return this.getClient().getExecutorService().submit(new Callable<ComputeOperationStatusResponse>() { 
            @Override
            public ComputeOperationStatusResponse call() throws Exception {
                return shutdown(serviceName, deploymentName, virtualMachineName, parameters);
            }
         });
    }
    
    /**
    * The Shutdown Role operation shuts down the specified virtual machine.
    * (see http://msdn.microsoft.com/en-us/library/windowsazure/jj157195.aspx
    * for more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine to shutdown.
    * @param parameters The parameters for the shutdown vm operation.
    * @throws InterruptedException Thrown when a thread is waiting, sleeping,
    * or otherwise occupied, and the thread is interrupted, either before or
    * during the activity. Occasionally a method may wish to test whether the
    * current thread has been interrupted, and if so, to immediately throw
    * this exception. The following code can be used to achieve this effect:
    * @throws ExecutionException Thrown when attempting to retrieve the result
    * of a task that aborted by throwing an exception. This exception can be
    * inspected using the Throwable.getCause() method.
    * @throws ServiceException Thrown if the server returned an error for the
    * request.
    * @throws IOException Thrown if there was an error setting up tracing for
    * the request.
    * @return The response body contains the status of the specified
    * asynchronous operation, indicating whether it has succeeded, is
    * inprogress, or has failed. Note that this status is distinct from the
    * HTTP status code returned for the Get Operation Status operation itself.
    * If the asynchronous operation succeeded, the response body includes the
    * HTTP status code for the successful request.  If the asynchronous
    * operation failed, the response body includes the HTTP status code for
    * the failed request, and also includes error information regarding the
    * failure.
    */
    @Override
    public ComputeOperationStatusResponse shutdown(String serviceName, String deploymentName, String virtualMachineName, VirtualMachineShutdownParameters parameters) throws InterruptedException, ExecutionException, ServiceException, IOException {
        ComputeManagementClient client2 = this.getClient();
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("deploymentName", deploymentName);
            tracingParameters.put("virtualMachineName", virtualMachineName);
            tracingParameters.put("parameters", parameters);
            CloudTracing.enter(invocationId, this, "shutdownAsync", tracingParameters);
        }
        try {
            if (shouldTrace) {
                client2 = this.getClient().withRequestFilterLast(new ClientRequestTrackingHandler(invocationId)).withResponseFilterLast(new ClientRequestTrackingHandler(invocationId));
            }
            
            OperationResponse response = client2.getVirtualMachinesOperations().beginShutdownAsync(serviceName, deploymentName, virtualMachineName, parameters).get();
            ComputeOperationStatusResponse result = client2.getOperationStatusAsync(response.getRequestId()).get();
            int delayInSeconds = 30;
            while ((result.getStatus() != OperationStatus.InProgress) == false) {
                Thread.sleep(delayInSeconds * 1000);
                result = client2.getOperationStatusAsync(response.getRequestId()).get();
                delayInSeconds = 30;
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            
            if (result.getStatus() != OperationStatus.Succeeded) {
                if (result.getError() != null) {
                    ServiceException ex = new ServiceException(result.getError().getCode() + " : " + result.getError().getMessage());
                    ex.setErrorCode(result.getError().getCode());
                    ex.setErrorMessage(result.getError().getMessage());
                    if (shouldTrace) {
                        CloudTracing.error(invocationId, ex);
                    }
                    throw ex;
                } else {
                    ServiceException ex = new ServiceException("");
                    if (shouldTrace) {
                        CloudTracing.error(invocationId, ex);
                    }
                    throw ex;
                }
            }
            
            return result;
        } finally {
            if (this.getClient() != null && shouldTrace) {
                this.getClient().close();
            }
        }
    }
    
    /**
    * The Shutdown Roles operation stops the specified set of virtual machines.
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param parameters The set of virtual machine roles to shutdown and their
    * post shutdown state.
    * @return The response body contains the status of the specified
    * asynchronous operation, indicating whether it has succeeded, is
    * inprogress, or has failed. Note that this status is distinct from the
    * HTTP status code returned for the Get Operation Status operation itself.
    * If the asynchronous operation succeeded, the response body includes the
    * HTTP status code for the successful request.  If the asynchronous
    * operation failed, the response body includes the HTTP status code for
    * the failed request, and also includes error information regarding the
    * failure.
    */
    @Override
    public Future<ComputeOperationStatusResponse> shutdownRolesAsync(final String serviceName, final String deploymentName, final VirtualMachineShutdownRolesParameters parameters) {
        return this.getClient().getExecutorService().submit(new Callable<ComputeOperationStatusResponse>() { 
            @Override
            public ComputeOperationStatusResponse call() throws Exception {
                return shutdownRoles(serviceName, deploymentName, parameters);
            }
         });
    }
    
    /**
    * The Shutdown Roles operation stops the specified set of virtual machines.
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param parameters The set of virtual machine roles to shutdown and their
    * post shutdown state.
    * @throws InterruptedException Thrown when a thread is waiting, sleeping,
    * or otherwise occupied, and the thread is interrupted, either before or
    * during the activity. Occasionally a method may wish to test whether the
    * current thread has been interrupted, and if so, to immediately throw
    * this exception. The following code can be used to achieve this effect:
    * @throws ExecutionException Thrown when attempting to retrieve the result
    * of a task that aborted by throwing an exception. This exception can be
    * inspected using the Throwable.getCause() method.
    * @throws ServiceException Thrown if the server returned an error for the
    * request.
    * @throws IOException Thrown if there was an error setting up tracing for
    * the request.
    * @return The response body contains the status of the specified
    * asynchronous operation, indicating whether it has succeeded, is
    * inprogress, or has failed. Note that this status is distinct from the
    * HTTP status code returned for the Get Operation Status operation itself.
    * If the asynchronous operation succeeded, the response body includes the
    * HTTP status code for the successful request.  If the asynchronous
    * operation failed, the response body includes the HTTP status code for
    * the failed request, and also includes error information regarding the
    * failure.
    */
    @Override
    public ComputeOperationStatusResponse shutdownRoles(String serviceName, String deploymentName, VirtualMachineShutdownRolesParameters parameters) throws InterruptedException, ExecutionException, ServiceException, IOException {
        ComputeManagementClient client2 = this.getClient();
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("deploymentName", deploymentName);
            tracingParameters.put("parameters", parameters);
            CloudTracing.enter(invocationId, this, "shutdownRolesAsync", tracingParameters);
        }
        try {
            if (shouldTrace) {
                client2 = this.getClient().withRequestFilterLast(new ClientRequestTrackingHandler(invocationId)).withResponseFilterLast(new ClientRequestTrackingHandler(invocationId));
            }
            
            OperationResponse response = client2.getVirtualMachinesOperations().beginShuttingDownRolesAsync(serviceName, deploymentName, parameters).get();
            ComputeOperationStatusResponse result = client2.getOperationStatusAsync(response.getRequestId()).get();
            int delayInSeconds = 30;
            while ((result.getStatus() != OperationStatus.InProgress) == false) {
                Thread.sleep(delayInSeconds * 1000);
                result = client2.getOperationStatusAsync(response.getRequestId()).get();
                delayInSeconds = 30;
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            
            if (result.getStatus() != OperationStatus.Succeeded) {
                if (result.getError() != null) {
                    ServiceException ex = new ServiceException(result.getError().getCode() + " : " + result.getError().getMessage());
                    ex.setErrorCode(result.getError().getCode());
                    ex.setErrorMessage(result.getError().getMessage());
                    if (shouldTrace) {
                        CloudTracing.error(invocationId, ex);
                    }
                    throw ex;
                } else {
                    ServiceException ex = new ServiceException("");
                    if (shouldTrace) {
                        CloudTracing.error(invocationId, ex);
                    }
                    throw ex;
                }
            }
            
            return result;
        } finally {
            if (this.getClient() != null && shouldTrace) {
                this.getClient().close();
            }
        }
    }
    
    /**
    * The Start Role operation starts the specified virtual machine.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157189.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine to start.
    * @return The response body contains the status of the specified
    * asynchronous operation, indicating whether it has succeeded, is
    * inprogress, or has failed. Note that this status is distinct from the
    * HTTP status code returned for the Get Operation Status operation itself.
    * If the asynchronous operation succeeded, the response body includes the
    * HTTP status code for the successful request.  If the asynchronous
    * operation failed, the response body includes the HTTP status code for
    * the failed request, and also includes error information regarding the
    * failure.
    */
    @Override
    public Future<ComputeOperationStatusResponse> startAsync(final String serviceName, final String deploymentName, final String virtualMachineName) {
        return this.getClient().getExecutorService().submit(new Callable<ComputeOperationStatusResponse>() { 
            @Override
            public ComputeOperationStatusResponse call() throws Exception {
                return start(serviceName, deploymentName, virtualMachineName);
            }
         });
    }
    
    /**
    * The Start Role operation starts the specified virtual machine.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157189.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of the virtual machine to start.
    * @throws InterruptedException Thrown when a thread is waiting, sleeping,
    * or otherwise occupied, and the thread is interrupted, either before or
    * during the activity. Occasionally a method may wish to test whether the
    * current thread has been interrupted, and if so, to immediately throw
    * this exception. The following code can be used to achieve this effect:
    * @throws ExecutionException Thrown when attempting to retrieve the result
    * of a task that aborted by throwing an exception. This exception can be
    * inspected using the Throwable.getCause() method.
    * @throws ServiceException Thrown if the server returned an error for the
    * request.
    * @throws IOException Thrown if there was an error setting up tracing for
    * the request.
    * @return The response body contains the status of the specified
    * asynchronous operation, indicating whether it has succeeded, is
    * inprogress, or has failed. Note that this status is distinct from the
    * HTTP status code returned for the Get Operation Status operation itself.
    * If the asynchronous operation succeeded, the response body includes the
    * HTTP status code for the successful request.  If the asynchronous
    * operation failed, the response body includes the HTTP status code for
    * the failed request, and also includes error information regarding the
    * failure.
    */
    @Override
    public ComputeOperationStatusResponse start(String serviceName, String deploymentName, String virtualMachineName) throws InterruptedException, ExecutionException, ServiceException, IOException {
        ComputeManagementClient client2 = this.getClient();
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("deploymentName", deploymentName);
            tracingParameters.put("virtualMachineName", virtualMachineName);
            CloudTracing.enter(invocationId, this, "startAsync", tracingParameters);
        }
        try {
            if (shouldTrace) {
                client2 = this.getClient().withRequestFilterLast(new ClientRequestTrackingHandler(invocationId)).withResponseFilterLast(new ClientRequestTrackingHandler(invocationId));
            }
            
            OperationResponse response = client2.getVirtualMachinesOperations().beginStartingAsync(serviceName, deploymentName, virtualMachineName).get();
            ComputeOperationStatusResponse result = client2.getOperationStatusAsync(response.getRequestId()).get();
            int delayInSeconds = 30;
            while ((result.getStatus() != OperationStatus.InProgress) == false) {
                Thread.sleep(delayInSeconds * 1000);
                result = client2.getOperationStatusAsync(response.getRequestId()).get();
                delayInSeconds = 30;
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            
            if (result.getStatus() != OperationStatus.Succeeded) {
                if (result.getError() != null) {
                    ServiceException ex = new ServiceException(result.getError().getCode() + " : " + result.getError().getMessage());
                    ex.setErrorCode(result.getError().getCode());
                    ex.setErrorMessage(result.getError().getMessage());
                    if (shouldTrace) {
                        CloudTracing.error(invocationId, ex);
                    }
                    throw ex;
                } else {
                    ServiceException ex = new ServiceException("");
                    if (shouldTrace) {
                        CloudTracing.error(invocationId, ex);
                    }
                    throw ex;
                }
            }
            
            return result;
        } finally {
            if (this.getClient() != null && shouldTrace) {
                this.getClient().close();
            }
        }
    }
    
    /**
    * The Start Roles operation starts the specified set of virtual machines.
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param parameters The set of virtual machine roles to start.
    * @return The response body contains the status of the specified
    * asynchronous operation, indicating whether it has succeeded, is
    * inprogress, or has failed. Note that this status is distinct from the
    * HTTP status code returned for the Get Operation Status operation itself.
    * If the asynchronous operation succeeded, the response body includes the
    * HTTP status code for the successful request.  If the asynchronous
    * operation failed, the response body includes the HTTP status code for
    * the failed request, and also includes error information regarding the
    * failure.
    */
    @Override
    public Future<ComputeOperationStatusResponse> startRolesAsync(final String serviceName, final String deploymentName, final VirtualMachineStartRolesParameters parameters) {
        return this.getClient().getExecutorService().submit(new Callable<ComputeOperationStatusResponse>() { 
            @Override
            public ComputeOperationStatusResponse call() throws Exception {
                return startRoles(serviceName, deploymentName, parameters);
            }
         });
    }
    
    /**
    * The Start Roles operation starts the specified set of virtual machines.
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param parameters The set of virtual machine roles to start.
    * @throws InterruptedException Thrown when a thread is waiting, sleeping,
    * or otherwise occupied, and the thread is interrupted, either before or
    * during the activity. Occasionally a method may wish to test whether the
    * current thread has been interrupted, and if so, to immediately throw
    * this exception. The following code can be used to achieve this effect:
    * @throws ExecutionException Thrown when attempting to retrieve the result
    * of a task that aborted by throwing an exception. This exception can be
    * inspected using the Throwable.getCause() method.
    * @throws ServiceException Thrown if the server returned an error for the
    * request.
    * @throws IOException Thrown if there was an error setting up tracing for
    * the request.
    * @return The response body contains the status of the specified
    * asynchronous operation, indicating whether it has succeeded, is
    * inprogress, or has failed. Note that this status is distinct from the
    * HTTP status code returned for the Get Operation Status operation itself.
    * If the asynchronous operation succeeded, the response body includes the
    * HTTP status code for the successful request.  If the asynchronous
    * operation failed, the response body includes the HTTP status code for
    * the failed request, and also includes error information regarding the
    * failure.
    */
    @Override
    public ComputeOperationStatusResponse startRoles(String serviceName, String deploymentName, VirtualMachineStartRolesParameters parameters) throws InterruptedException, ExecutionException, ServiceException, IOException {
        ComputeManagementClient client2 = this.getClient();
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("deploymentName", deploymentName);
            tracingParameters.put("parameters", parameters);
            CloudTracing.enter(invocationId, this, "startRolesAsync", tracingParameters);
        }
        try {
            if (shouldTrace) {
                client2 = this.getClient().withRequestFilterLast(new ClientRequestTrackingHandler(invocationId)).withResponseFilterLast(new ClientRequestTrackingHandler(invocationId));
            }
            
            OperationResponse response = client2.getVirtualMachinesOperations().beginStartingRolesAsync(serviceName, deploymentName, parameters).get();
            ComputeOperationStatusResponse result = client2.getOperationStatusAsync(response.getRequestId()).get();
            int delayInSeconds = 30;
            while ((result.getStatus() != OperationStatus.InProgress) == false) {
                Thread.sleep(delayInSeconds * 1000);
                result = client2.getOperationStatusAsync(response.getRequestId()).get();
                delayInSeconds = 30;
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            
            if (result.getStatus() != OperationStatus.Succeeded) {
                if (result.getError() != null) {
                    ServiceException ex = new ServiceException(result.getError().getCode() + " : " + result.getError().getMessage());
                    ex.setErrorCode(result.getError().getCode());
                    ex.setErrorMessage(result.getError().getMessage());
                    if (shouldTrace) {
                        CloudTracing.error(invocationId, ex);
                    }
                    throw ex;
                } else {
                    ServiceException ex = new ServiceException("");
                    if (shouldTrace) {
                        CloudTracing.error(invocationId, ex);
                    }
                    throw ex;
                }
            }
            
            return result;
        } finally {
            if (this.getClient() != null && shouldTrace) {
                this.getClient().close();
            }
        }
    }
    
    /**
    * The Update Role operation adds a virtual machine to an existing
    * deployment.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157187.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of your virtual machine.
    * @param parameters Parameters supplied to the Update Virtual Machine
    * operation.
    * @return The response body contains the status of the specified
    * asynchronous operation, indicating whether it has succeeded, is
    * inprogress, or has failed. Note that this status is distinct from the
    * HTTP status code returned for the Get Operation Status operation itself.
    * If the asynchronous operation succeeded, the response body includes the
    * HTTP status code for the successful request.  If the asynchronous
    * operation failed, the response body includes the HTTP status code for
    * the failed request, and also includes error information regarding the
    * failure.
    */
    @Override
    public Future<ComputeOperationStatusResponse> updateAsync(final String serviceName, final String deploymentName, final String virtualMachineName, final VirtualMachineUpdateParameters parameters) {
        return this.getClient().getExecutorService().submit(new Callable<ComputeOperationStatusResponse>() { 
            @Override
            public ComputeOperationStatusResponse call() throws Exception {
                return update(serviceName, deploymentName, virtualMachineName, parameters);
            }
         });
    }
    
    /**
    * The Update Role operation adds a virtual machine to an existing
    * deployment.  (see
    * http://msdn.microsoft.com/en-us/library/windowsazure/jj157187.aspx for
    * more information)
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param virtualMachineName The name of your virtual machine.
    * @param parameters Parameters supplied to the Update Virtual Machine
    * operation.
    * @throws ParserConfigurationException Thrown if there was an error
    * configuring the parser for the response body.
    * @throws SAXException Thrown if there was an error parsing the response
    * body.
    * @throws TransformerException Thrown if there was an error creating the
    * DOM transformer.
    * @throws IOException Signals that an I/O exception of some sort has
    * occurred. This class is the general class of exceptions produced by
    * failed or interrupted I/O operations.
    * @throws ServiceException Thrown if an unexpected response is found.
    * @throws URISyntaxException Thrown if there was an error parsing a URI in
    * the response.
    * @throws InterruptedException Thrown when a thread is waiting, sleeping,
    * or otherwise occupied, and the thread is interrupted, either before or
    * during the activity. Occasionally a method may wish to test whether the
    * current thread has been interrupted, and if so, to immediately throw
    * this exception. The following code can be used to achieve this effect:
    * @throws ExecutionException Thrown when attempting to retrieve the result
    * of a task that aborted by throwing an exception. This exception can be
    * inspected using the Throwable.getCause() method.
    * @throws ServiceException Thrown if the server returned an error for the
    * request.
    * @return The response body contains the status of the specified
    * asynchronous operation, indicating whether it has succeeded, is
    * inprogress, or has failed. Note that this status is distinct from the
    * HTTP status code returned for the Get Operation Status operation itself.
    * If the asynchronous operation succeeded, the response body includes the
    * HTTP status code for the successful request.  If the asynchronous
    * operation failed, the response body includes the HTTP status code for
    * the failed request, and also includes error information regarding the
    * failure.
    */
    @Override
    public ComputeOperationStatusResponse update(String serviceName, String deploymentName, String virtualMachineName, VirtualMachineUpdateParameters parameters) throws ParserConfigurationException, SAXException, TransformerException, IOException, ServiceException, URISyntaxException, InterruptedException, ExecutionException, ServiceException {
        ComputeManagementClient client2 = this.getClient();
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("deploymentName", deploymentName);
            tracingParameters.put("virtualMachineName", virtualMachineName);
            tracingParameters.put("parameters", parameters);
            CloudTracing.enter(invocationId, this, "updateAsync", tracingParameters);
        }
        try {
            if (shouldTrace) {
                client2 = this.getClient().withRequestFilterLast(new ClientRequestTrackingHandler(invocationId)).withResponseFilterLast(new ClientRequestTrackingHandler(invocationId));
            }
            
            OperationResponse response = client2.getVirtualMachinesOperations().beginUpdatingAsync(serviceName, deploymentName, virtualMachineName, parameters).get();
            ComputeOperationStatusResponse result = client2.getOperationStatusAsync(response.getRequestId()).get();
            int delayInSeconds = 30;
            while ((result.getStatus() != OperationStatus.InProgress) == false) {
                Thread.sleep(delayInSeconds * 1000);
                result = client2.getOperationStatusAsync(response.getRequestId()).get();
                delayInSeconds = 30;
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            
            if (result.getStatus() != OperationStatus.Succeeded) {
                if (result.getError() != null) {
                    ServiceException ex = new ServiceException(result.getError().getCode() + " : " + result.getError().getMessage());
                    ex.setErrorCode(result.getError().getCode());
                    ex.setErrorMessage(result.getError().getMessage());
                    if (shouldTrace) {
                        CloudTracing.error(invocationId, ex);
                    }
                    throw ex;
                } else {
                    ServiceException ex = new ServiceException("");
                    if (shouldTrace) {
                        CloudTracing.error(invocationId, ex);
                    }
                    throw ex;
                }
            }
            
            return result;
        } finally {
            if (this.getClient() != null && shouldTrace) {
                this.getClient().close();
            }
        }
    }
    
    /**
    * The UpdateLoadBalancedEndpointSet operation changes the specified
    * load-balanced InputEndpoints on all the roles of an Infrastructure as a
    * Service deployment. Non load-balanced endpoints must be changed using
    * UpdateRole.
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param parameters Parameters supplied to the Update Load Balanced
    * Endpoint Set operation.
    * @return The response body contains the status of the specified
    * asynchronous operation, indicating whether it has succeeded, is
    * inprogress, or has failed. Note that this status is distinct from the
    * HTTP status code returned for the Get Operation Status operation itself.
    * If the asynchronous operation succeeded, the response body includes the
    * HTTP status code for the successful request.  If the asynchronous
    * operation failed, the response body includes the HTTP status code for
    * the failed request, and also includes error information regarding the
    * failure.
    */
    @Override
    public Future<ComputeOperationStatusResponse> updateLoadBalancedEndpointSetAsync(final String serviceName, final String deploymentName, final VirtualMachineUpdateLoadBalancedSetParameters parameters) {
        return this.getClient().getExecutorService().submit(new Callable<ComputeOperationStatusResponse>() { 
            @Override
            public ComputeOperationStatusResponse call() throws Exception {
                return updateLoadBalancedEndpointSet(serviceName, deploymentName, parameters);
            }
         });
    }
    
    /**
    * The UpdateLoadBalancedEndpointSet operation changes the specified
    * load-balanced InputEndpoints on all the roles of an Infrastructure as a
    * Service deployment. Non load-balanced endpoints must be changed using
    * UpdateRole.
    *
    * @param serviceName The name of your service.
    * @param deploymentName The name of your deployment.
    * @param parameters Parameters supplied to the Update Load Balanced
    * Endpoint Set operation.
    * @throws InterruptedException Thrown when a thread is waiting, sleeping,
    * or otherwise occupied, and the thread is interrupted, either before or
    * during the activity. Occasionally a method may wish to test whether the
    * current thread has been interrupted, and if so, to immediately throw
    * this exception. The following code can be used to achieve this effect:
    * @throws ExecutionException Thrown when attempting to retrieve the result
    * of a task that aborted by throwing an exception. This exception can be
    * inspected using the Throwable.getCause() method.
    * @throws ServiceException Thrown if the server returned an error for the
    * request.
    * @throws IOException Thrown if there was an error setting up tracing for
    * the request.
    * @return The response body contains the status of the specified
    * asynchronous operation, indicating whether it has succeeded, is
    * inprogress, or has failed. Note that this status is distinct from the
    * HTTP status code returned for the Get Operation Status operation itself.
    * If the asynchronous operation succeeded, the response body includes the
    * HTTP status code for the successful request.  If the asynchronous
    * operation failed, the response body includes the HTTP status code for
    * the failed request, and also includes error information regarding the
    * failure.
    */
    @Override
    public ComputeOperationStatusResponse updateLoadBalancedEndpointSet(String serviceName, String deploymentName, VirtualMachineUpdateLoadBalancedSetParameters parameters) throws InterruptedException, ExecutionException, ServiceException, IOException {
        ComputeManagementClient client2 = this.getClient();
        boolean shouldTrace = CloudTracing.getIsEnabled();
        String invocationId = null;
        if (shouldTrace) {
            invocationId = Long.toString(CloudTracing.getNextInvocationId());
            HashMap<String, Object> tracingParameters = new HashMap<String, Object>();
            tracingParameters.put("serviceName", serviceName);
            tracingParameters.put("deploymentName", deploymentName);
            tracingParameters.put("parameters", parameters);
            CloudTracing.enter(invocationId, this, "updateLoadBalancedEndpointSetAsync", tracingParameters);
        }
        try {
            if (shouldTrace) {
                client2 = this.getClient().withRequestFilterLast(new ClientRequestTrackingHandler(invocationId)).withResponseFilterLast(new ClientRequestTrackingHandler(invocationId));
            }
            
            OperationResponse response = client2.getVirtualMachinesOperations().beginUpdatingLoadBalancedEndpointSetAsync(serviceName, deploymentName, parameters).get();
            ComputeOperationStatusResponse result = client2.getOperationStatusAsync(response.getRequestId()).get();
            int delayInSeconds = 30;
            while ((result.getStatus() != OperationStatus.InProgress) == false) {
                Thread.sleep(delayInSeconds * 1000);
                result = client2.getOperationStatusAsync(response.getRequestId()).get();
                delayInSeconds = 30;
            }
            
            if (shouldTrace) {
                CloudTracing.exit(invocationId, result);
            }
            
            if (result.getStatus() != OperationStatus.Succeeded) {
                if (result.getError() != null) {
                    ServiceException ex = new ServiceException(result.getError().getCode() + " : " + result.getError().getMessage());
                    ex.setErrorCode(result.getError().getCode());
                    ex.setErrorMessage(result.getError().getMessage());
                    if (shouldTrace) {
                        CloudTracing.error(invocationId, ex);
                    }
                    throw ex;
                } else {
                    ServiceException ex = new ServiceException("");
                    if (shouldTrace) {
                        CloudTracing.error(invocationId, ex);
                    }
                    throw ex;
                }
            }
            
            return result;
        } finally {
            if (this.getClient() != null && shouldTrace) {
                this.getClient().close();
            }
        }
    }
}
