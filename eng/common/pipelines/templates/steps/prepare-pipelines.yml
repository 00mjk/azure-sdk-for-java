parameters:
  - name: Owner
    type: string
    default: Azure
  - name: Repository
    type: string
    default: $(Build.Repository.Name)
  - name: Prefix
    type: string
  - name: CIConventionOptions
    type: string
    default: ''
  - name: UPConventionOptions
    type: string
    default: ''
  - name: TestsConventionOptions
    type: string
    default: ''

steps:
  - template: install-pipeline-generation.yml
  - script: |
      pipeline-generator --organization https://dev.azure.com/azure-sdk --project public --prefix ${{parameters.Prefix}} --path $(System.DefaultWorkingDirectory)/sdk --endpoint Azure --repository ${{parameters.Owner}}/${{parameters.Repository}} --convention ci --agentpool Hosted --branch refs/heads/master --patvar PATVAR --debug ${{parameters.CIConventionOptions}}
    displayName: 'Generate public pipelines for: $(RepositoryName)'
    env:
      PATVAR: $(azuresdk-azure-sdk-devops-pipeline-generation-pat)
  - script: |
      pipeline-generator --organization https://dev.azure.com/azure-sdk --project internal --prefix ${{parameters.Prefix}} --path $(Pipeline.Workspace)/$(RepositoryName)/sdk --endpoint Azure --repository ${{parameters.Owner}}/${{parameters.Repository}} --convention up --agentpool Hosted --branch refs/heads/master --patvar PATVAR --debug ${{parameters.UPConventionOptions}}
    displayName: 'Generate internal pipelines for: $(RepositoryName)'
    env:
      PATVAR: $(azuresdk-azure-sdk-devops-pipeline-generation-pat)
  - script: |
      pipeline-generator --organization https://dev.azure.com/azure-sdk --project internal --prefix ${{parameters.Prefix}} --path $(Pipeline.Workspace)/$(RepositoryName)/sdk --endpoint Azure --repository ${{parameters.Owner}}/${{parameters.Repository}} --convention tests --agentpool Hosted --branch refs/heads/master --patvar PATVAR --debug ${{parameters.TestsConventionOptions}}
    displayName: 'Generate test pipelines for: $(RepositoryName)'
    env:
      PATVAR: $(azuresdk-azure-sdk-devops-pipeline-generation-pat)
